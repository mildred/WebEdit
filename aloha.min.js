/**
 * functions.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor. 
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php 
 */

/**
 * arrays.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * assert.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * maps.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * strings.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 *
 * Reference:
 * http://www.w3.org/TR/html401/struct/text.html
 */

/**
 * dom/attributes.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * misc.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 *
 * Contains miscellaneous utility functions that don't fit anywhere else.
 */

/**
 * dom/nodes.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * dom/classes.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * dom/mutation.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * dom/styles.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/* dom/traversing.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 *
 * @reference:
 * 	http://www.w3.org/TR/DOM-Level-3-Core/glossary.html#dt-document-order
 *	https://en.wikipedia.org/wiki/Tree_traversal#Pre-order
 */

/**
 * browsers.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor. 
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php 
 */

/**
 * dom.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * events.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 *
 * @see
 * http://www.w3.org/TR/DOM-Level-3-Events/#idl-interface-MouseEvent-initializers
 */

/**
 * ranges.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 *
 * @see
 * https://dvcs.w3.org/hg/editing/raw-file/tip/editing.html#deleting-the-selection
 */

/**
 * boundaries.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * html/predicates.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * html/styles.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * cursors.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * html/elements.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
	 * Returns true if the given node is unrendered whitespace, with the caveat
	 * that it only examines the given node and not any siblings.  An additional
	 * check is necessary to determine whether the node occurs after/before a
	 * linebreaking node.
	 *
	 * Taken from
	 * http://code.google.com/p/rangy/source/browse/trunk/src/js/modules/rangy-cssclassapplier.js
	 * under the MIT license.
	 *
	 * @private
	 * @param  {Node} node
	 * @return {boolean}
	 */

/**
 * paths.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * html/traversing.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * mutation.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * content.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 *
 * @todo consider moving this into html/
 */

/**
 * html/mutation.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * html.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 *
 * @see
 * https://en.wikipedia.org/wiki/HTML_element#Content_vs._presentation
 * https://developer.mozilla.org/en-US/docs/Web/HTML/Content_categories
 * http://www.whatwg.org/specs/web-apps/2007-10-26/multipage/section-contenteditable.html
 * http://lists.whatwg.org/htdig.cgi/whatwg-whatwg.org/2011-May/031577.html
 * https://dvcs.w3.org/hg/domcore/raw-file/tip/overview.html#concept-range-bp
 * http://lists.whatwg.org/htdig.cgi/whatwg-whatwg.org/2011-May/031577.html
 */

/**
 * stable-range.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * zippers.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * lists.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * link-util.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * link-create.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * links.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * overrides.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 *
 * Refernces:
 * http://www.w3.org/TR/CSS2/propidx.html
 * https://dvcs.w3.org/hg/editing/raw-file/tip/editing.html
 * https://dvcs.w3.org/hg/editing/raw-file/tip/editing.html#value
 * https://dvcs.w3.org/hg/editing/raw-file/tip/editing.html#state
 * https://dvcs.w3.org/hg/editing/raw-file/tip/editing.html#value-override
 * https://dvcs.w3.org/hg/editing/raw-file/tip/editing.html#state-override
 *
 * https://dvcs.w3.org/hg/editing/raw-file/tip/editing.html#specified-command-value
 * https://dvcs.w3.org/hg/editing/raw-file/tip/editing.html#inline-command-activated-values
 * https://dvcs.w3.org/hg/editing/raw-file/tip/editing.html#equivalent-values
 * https://dvcs.w3.org/hg/editing/raw-file/tip/editing.html#effective-command-value
 *
 * http://www.w3.org/TR/CSS2/propidx.html
 */

/* editing.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 *
 * TODO formatStyle: in the following case the outer "font-family:
 *      arial" span should be removed.  Can be done similar to how
 *      findReusableAncestor() works.
 *      <span style="font-family: arial">
 *         <span style="font-family: times">one</span>
 *         <span style="font-family: helvetica">two<span>
 *      </span>
 * TODO better handling of the last <br/> in a block and generally of
 *      unrendered whitespace. For example formatting
 *      <p>{some<br/>text<br/>}</p>
 *      will result in
 *      <p>{<b>some<br/>text<br/></b>}</p>
 *      while it should probably be
 *      <p>{<b>some</br>text</b>}<br/></p>
 */

/**
 * keys.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 *
 * @see:
 * https://lists.webkit.org/pipermail/webkit-dev/2007-December/002992.html
 *
 * @todo:
 * consider https://github.com/nostrademons/keycode.js/blob/master/keycode.js
 */

/**
 * mouse.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * traversing.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * carets.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * animation.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * selections.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 *
 * @TODO: better climbing
 *        ie support
 */

/**
 * dragdrop.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 *
 * @see
 * http://www.whatwg.org/specs/web-apps/current-work/#dnd
 * http://www.html5rocks.com/en/tutorials/dnd/basics/
 * https://developer.mozilla.org/en-US/docs/Drag_and_drop_events
 * https://developer.mozilla.org/en-US/docs/Web/API/DataTransfer
 */

/* undo.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2013 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * editables.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * blocks.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * colors.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/* image.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * mutation-trees.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * transform/utils.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * transform/html.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * transform/plain.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * transform/ms-word/list.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * transform/ms-word/tables.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * transform/ms-word/toc.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/* transform/ms-word.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 *
 * Refernces:
 * CF_HTML:
 * http://msdn.microsoft.com/en-us/library/windows/desktop/ms649015(v=vs.85).aspx
 */

/**
 * transform.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * paste.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * markers.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * metaview.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 *
 * @reference: cssminimizer.com
 */

/**
 * selection-change.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * searching.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 *
 * @overview
 * Module for searching for strings of token in markup
 */

/**
 * typing.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

/**
 * api.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 *
 * This module exports the Aloha Editor API in a way that will be safe from
 * mungling by the Google Closure Compiler when comipling in advanced
 * compilation mode.
 */

/**
 * autoformat.js is part of Aloha Editor project http://aloha-editor.org
 *
 * Aloha Editor is a WYSIWYG HTML5 inline editing library and editor.
 * Copyright (c) 2010-2014 Gentics Software GmbH, Vienna, Austria.
 * Contributors http://aloha-editor.org/contribution.php
 */

define("aloha/functions",[],function(){function e(e){return e}function n(){}function t(){return!0}function r(){return!1}function o(e){return null==e}function i(e){return function(){return!e.apply(this,arguments)}}function a(e){var n=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,n.concat(Array.prototype.slice.call(arguments,0)))}}function s(e,n){return e===n}function u(){var e=arguments,n=e.length;return function(){var t,r=n;for(r-->0&&(t=e[r].apply(this,arguments));r-->0;)t=e[r].call(this,t);return t}}function l(){var e=arguments,n=e.length;return function(){for(var t=0;n>t;t++)if(!e[t].apply(this,arguments))return!1;return!0}}function d(){var e=arguments,n=e.length;return function(){for(var t=0;n>t;t++)if(e[t].apply(this,arguments))return!0;return!1}}function c(e){return function(){return e}}function f(e){return"function"==typeof e}function p(e){var n=e.length,t=1===n?function(){return e(this)}:2===n?function(n){return e(this,n)}:3===n?function(n,t){return e(this,n,t)}:4===n?function(n,t,r){return e(this,n,t,r)}:function(){var n=Array.prototype.slice.call(arguments,0);return n.unshift(this),e.apply(null,n)};return t}function m(e,n){for(var t in n)n.hasOwnProperty(t)&&(e.prototype[t]=p(n[t]))}return{identity:e,noop:n,returnTrue:t,returnFalse:r,complement:i,partial:a,strictEquals:s,comp:u,and:l,or:d,constantly:c,is:f,isNou:o,asMethod:p,extendType:m}}),define("aloha/arrays",["./functions"],function(e){function n(n,t,r){var o,i=n.length;if(i!==t.length)return!1;for(r=r||e.strictEquals,o=0;i>o;o++)if(!r(n[o],t[o]))return!1;return!0}function t(e,n){return-1!==e.indexOf(n)}function r(e,n){return e.filter(function(e){return t(n,e)})}function o(e,n){return e.filter(function(e){return!t(n,e)})}function i(e){return e.length?e[e.length-1]:null}function a(e){return Array.prototype.slice.call(e)}function s(e,n){return e.reduce(function(e,t){return e.concat(n(t))},[])}function u(e,n){return e.reduce(function(e,t){var r=i(e);return r&&r.length<n?r.push(t):e.push([t]),e},[])}function l(e,n){var t=-1;return e.some(function(e,r){return n(e)?(t=r,!0):void 0}),t}function d(e,n){var t=l(e,n);return-1===t?null:e[t]}function c(e,n){var t=l(e,n);return t=-1===t?e.length:t,[e.slice(0,t),e.slice(t)]}function f(e){var n=[];return e.forEach(function(e){-1===n.indexOf(e)&&n.push(e)}),n}function p(e){for(var n=a(arguments).slice(1),t=0;t<e.length;t++){if(!e[t]||!n[t])return;n[t].length=0,Array.prototype.splice.apply(n[t],[0,0].concat(e[t]))}}return{contains:t,difference:o,equal:n,intersect:r,last:i,coerce:a,mapcat:s,partition:u,some:d,someIndex:l,split:c,unique:f,refill:p}}),define("aloha/assert",[],function(){function e(e){return"✘ Error ("+e+"). See http://www.aloha-editor.org/docs/errors/"+e}function n(n){throw Error(n?e(n):"assertion failed")}function t(e,t){e||n(t)}function r(){n(a)}function o(e){t(null!=e,s)}function i(e){t(null==e,u)}var a=0,s=1,u=2,l=15;return{assert:t,error:n,notImplemented:r,assertNou:i,assertNotNou:o,NOT_IMPLEMENTED:a,NOU:s,NOT_NOU:u,ASSERT_TYPE_NOU:l,READ_FROM_DISCARDED_TRANSIENT:3,PERSISTENT_WRITE_TO_TRANSIENT:4,TRANSIENT_WRITE_TO_PERSISTENT:5,RECORD_WRONG_TYPE:16,STYLE_NOT_AS_ATTR:8,EXPECT_ELEMENT:9,EXPECT_TEXT_NODE:10,ELEMENT_NOT_ATTACHED:11,MISSING_SYMBOL:12,GETTER_AT_LEAST_1_ARG:13,SETTER_1_MORE_THAN_GETTER:14}}),define("aloha/maps",["./arrays","./assert"],function(e,n){function t(e){var n;for(n in e)if(e.hasOwnProperty(n))return!1;return!0}function r(e,n,t){for(var r=n.length;r--;)e[n[r]]=t;return e}function o(e,n){var t;for(t in e)e.hasOwnProperty(t)&&n(e[t],t,e)}function i(e,n,t){return n.map(function(n){return e.hasOwnProperty(n)?e[n]:t})}function a(e,n){var t={};return o(e,function(r,o){n(r,o,e)&&(t[o]=r)}),t}function s(e){var n=[];return o(e,function(e,t){n.push(t)}),n}function u(e){return i(e,s(e))}function l(e){var n;for(n=1;n<arguments.length;n++){var t=arguments[n];t&&o(t,function(n,t){e[t]=n})}return e}function d(){return l.apply(null,[{}].concat(e.coerce(arguments)))}function c(e){return n.assertNotNou(e),l({},e)}function f(e,n,t){return e=c(e),e[n]=t,e}function p(e,n){return e=c(e),delete e[n],e}function m(e){return!(!e||!e.constructor||"[object Object]"!==Object.prototype.toString.call(e))}function h(){return Object.create(null)}function v(e){var n={};return e.forEach(function(e){n[e[0]]=e[1]}),n}return{isEmpty:t,fillKeys:r,keys:s,vals:u,selectVals:i,filter:a,forEach:o,extend:l,merge:d,isMap:m,clone:c,cloneSet:f,cloneDelete:p,create:h,mapTuples:v}}),define("aloha/strings",["./arrays"],function(e){function n(e){return e=e.trim().replace(A,""),r(e)?[]:e.split(/\s+/g)}function t(e,n){for(var t,r=[],o=0;null!=(t=n.exec(e));)o<t.index&&(r.push(e.substring(o,t.index)),o=t.index),o+=t[0].length,r.push(t[0]);return o<e.length&&r.push(e.substring(o,e.length)),r}function r(e){return""===e||null==e}function o(e){return y.test(e)}function i(n){for(var t=n.split(p),r=e.coerce(arguments).slice(1),o=[],i=0;i<t.length;i++)t[i]&&o.push(t[i]);for(i=0;i<r.length;i++)r[i]&&o.push(r[i]);return o.join(" ")}function a(n){var t=n.split(p),r=e.coerce(arguments).slice(1);return e.difference(t,r).join(" ")}function s(n){return e.unique(n.split(p)).join(" ")}var u=["\\u200B","\\u200C","\\u200D","\\uFEFF"],l=["\\u00A0","\\u202F"],d=["\\u0009","\\u000A","\\u000B","\\u000C","\\u000D","\\u0020","\\u0085","\\u00A0","\\u1680","\\u180E","\\u2000","\\u2001","\\u2002","\\u2003","\\u2004","\\u2005","\\u2006","\\u2007","\\u2008","\\u2009","\\u200A","\\u2028","\\u2029","\\u202F","\\u205F","\\u3000"],c=["A-","Z","a-","z","ª","µ","º","À-","Ö","Ø-","ö","ø-","ˁ","ˆ-","ˑ","ˠ-","ˤ","ˬ","ˮ","Ͱ-","ʹ","Ͷ","ͷ","ͺ-","ͽ","Ά","Έ-","Ί","Ό","Ύ-","Ρ","Σ-","ϵ","Ϸ-","ҁ","Ҋ-","ԥ","Ա-","Ֆ","ՙ","ա-","և","א-","ת","װ-","ײ","ء-","ي","ٮ","ٯ","ٱ-","ۓ","ە","ۥ","ۦ","ۮ","ۯ","ۺ-","ۼ","ۿ","ܐ","ܒ-","ܯ","ݍ-","ޥ","ޱ","ߊ-","ߪ","ߴ","ߵ","ߺ","ࠀ-","ࠕ","ࠚ","ࠤ","ࠨ","ऄ-","ह","ऽ","ॐ","क़-","ॡ","ॱ","ॲ","ॹ-","ॿ","অ-","ঌ","এ","ঐ","ও-","ন","প-","র","ল","শ-","হ","ঽ","ৎ","ড়","ঢ়","য়-","ৡ","ৰ","ৱ","ਅ-","ਊ","ਏ","ਐ","ਓ-","ਨ","ਪ-","ਰ","ਲ","ਲ਼","ਵ","ਸ਼","ਸ","ਹ","ਖ਼-","ੜ","ਫ਼","ੲ-","ੴ","અ-","ઍ","એ-","ઑ","ઓ-","ન","પ-","ર","લ","ળ","વ-","હ","ઽ","ૐ","ૠ","ૡ","ଅ-","ଌ","ଏ","ଐ","ଓ-","ନ","ପ-","ର","ଲ","ଳ","ଵ-","ହ","ଽ","ଡ଼","ଢ଼","ୟ-","ୡ","ୱ","ஃ","அ-","ஊ","எ-","ஐ","ஒ-","க","ங","ச","ஜ","ஞ","ட","ண","த","ந-","ப","ம-","ஹ","ௐ","అ-","ఌ","ఎ-","ఐ","ఒ-","న","ప-","ళ","వ-","హ","ఽ","ౘ","ౙ","ౠ","ౡ","ಅ-","ಌ","ಎ-","ಐ","ಒ-","ನ","ಪ-","ಳ","ವ-","ಹ","ಽ","ೞ","ೠ","ೡ","അ-","ഌ","എ-","ഐ","ഒ-","ന","പ-","ഹ","ഽ","ൠ","ൡ","ൺ-","ൿ","අ-","ඖ","ක-","න","ඳ-","ර","ල","ව-","ෆ","ก-","ะ","า","ำ","เ-","ๆ","ກ","ຂ","ຄ","ງ","ຈ","ຊ","ຍ","ດ-","ທ","ນ-","ຟ","ມ-","ຣ","ລ","ວ","ສ","ຫ","ອ-","ະ","າ","ຳ","ຽ","ເ-","ໄ","ໆ","ໜ","ໝ","ༀ","ཀ-","ཇ","ཉ-","ཬ","ྈ-","ྋ","က-","ဪ","ဿ","ၐ-","ၕ","ၚ-","ၝ","ၡ","ၥ","ၦ","ၮ-","ၰ","ၵ-","ႁ","ႎ","Ⴀ-","Ⴥ","ა-","ჺ","ჼ","ᄀ-","ቈ","ቊ-","ቍ","ቐ-","ቖ","ቘ","ቚ-","ቝ","በ-","ኈ","ኊ-","ኍ","ነ-","ኰ","ኲ-","ኵ","ኸ-","ኾ","ዀ","ዂ-","ዅ","ወ-","ዖ","ዘ-","ጐ","ጒ-","ጕ","ጘ-","ፚ","ᎀ-","ᎏ","Ꭰ-","Ᏼ","ᐁ-","ᙬ","ᙯ-","ᙿ","ᚁ-","ᚚ","ᚠ-","ᛪ","ᜀ-","ᜌ","ᜎ-","ᜑ","ᜠ-","ᜱ","ᝀ-","ᝑ","ᝠ-","ᝬ","ᝮ-","ᝰ","ក-","ឳ","ៗ","ៜ","ᠠ-","ᡷ","ᢀ-","ᢨ","ᢪ","ᢰ-","ᣵ","ᤀ-","ᤜ","ᥐ-","ᥭ","ᥰ-","ᥴ","ᦀ-","ᦫ","ᧁ-","ᧇ","ᨀ-","ᨖ","ᨠ-","ᩔ","ᪧ","ᬅ-","ᬳ","ᭅ-","ᭋ","ᮃ-","ᮠ","ᮮ","ᮯ","ᰀ-","ᰣ","ᱍ-","ᱏ","ᱚ-","ᱽ","ᳩ-","ᳬ","ᳮ-","ᳱ","ᴀ-","ᶿ","Ḁ-","ἕ","Ἐ-","Ἕ","ἠ-","ὅ","Ὀ-","Ὅ","ὐ-","ὗ","Ὑ","Ὓ","Ὕ","Ὗ-","ώ","ᾀ-","ᾴ","ᾶ-","ᾼ","ι","ῂ-","ῄ","ῆ-","ῌ","ῐ-","ΐ","ῖ-","Ί","ῠ-","Ῥ","ῲ-","ῴ","ῶ-","ῼ","ⁱ","ⁿ","ₐ-","ₔ","ℂ","ℇ","ℊ-","ℓ","ℕ","ℙ-","ℝ","ℤ","Ω","ℨ","K-","ℭ","ℯ-","ℹ","ℼ-","ℿ","ⅅ-","ⅉ","ⅎ","Ↄ","ↄ","Ⰰ-","Ⱞ","ⰰ-","ⱞ","Ⱡ-","ⳤ","Ⳬ-","ⳮ","ⴀ-","ⴥ","ⴰ-","ⵥ","ⵯ","ⶀ-","ⶖ","ⶠ-","ⶦ","ⶨ-","ⶮ","ⶰ-","ⶶ","ⶸ-","ⶾ","ⷀ-","ⷆ","ⷈ-","ⷎ","ⷐ-","ⷖ","ⷘ-","ⷞ","ⸯ","々","〆","〱-","〵","〻","〼","ぁ-","ゖ","ゝ-","ゟ","ァ-","ヺ","ー-","ヿ","ㄅ-","ㄭ","ㄱ-","ㆎ","ㆠ-","ㆷ","ㇰ-","ㇿ","㐀-","䶵","一-","鿋","ꀀ-","ꒌ","ꓐ-","ꓽ","ꔀ-","ꘌ","ꘐ-","ꘟ","ꘪ","ꘫ","Ꙁ-","ꙟ","Ꙣ-","ꙮ","ꙿ-","ꚗ","ꚠ-","ꛥ","ꜗ-","ꜟ","Ꜣ-","ꞈ","Ꞌ","ꞌ","ꟻ-","ꠁ","ꠃ-","ꠅ","ꠇ-","ꠊ","ꠌ-","ꠢ","ꡀ-","ꡳ","ꢂ-","ꢳ","ꣲ-","ꣷ","ꣻ","ꤊ-","ꤥ","ꤰ-","ꥆ","ꥠ-","ꥼ","ꦄ-","ꦲ","ꧏ","ꨀ-","ꨨ","ꩀ-","ꩂ","ꩄ-","ꩋ","ꩠ-","ꩶ","ꩺ","ꪀ-","ꪯ","ꪱ","ꪵ","ꪶ","ꪹ-","ꪽ","ꫀ","ꫂ","ꫛ-","ꫝ","ꯀ-","ꯢ","가-","힣","ힰ-","ퟆ","ퟋ-","ퟻ","豈-","鶴","侮-","舘","並-","龎","ﬀ-","ﬆ","ﬓ-","ﬗ","יִ","ײַ-","ﬨ","שׁ-","זּ","טּ-","לּ","מּ","נּ","סּ","ףּ","פּ","צּ-","ﮱ","ﯓ-","ﴽ","ﵐ-","ﶏ","ﶒ-","ﷇ","ﷰ-","ﷻ","ﹰ-","ﹴ","ﹶ-","ﻼ","Ａ-","Ｚ","ａ-","ｚ","ｦ-","ﾾ","ￂ-","ￇ","ￊ-","ￏ","ￒ-","ￗ","ￚ-","ￜ"],f=new RegExp("["+d.join("")+"]"),p=new RegExp("["+d.join("")+"]+"),m=new RegExp("["+u.join("")+"]"),h=new RegExp("["+l.join("")+"]"),v=d.join(""),g=new RegExp("["+v+u.join("")+l.join("")+"]"),N=new RegExp("[^"+v+u.join("")+l.join("")+"]"),E=c.join(""),b=new RegExp("["+E+"]"),S=new RegExp("[^"+E+"]"),T=new RegExp("[^"+E+"]["+E+"]*$"),y=/[\x00-\x1f\x7f-\x9f]/,A=new RegExp("^["+v+"]+|["+v+"]+$"),_=function(){var e=/[\-]([a-z])/gi,n=function(e,n){return n.toUpperCase()};return function(t){return t.replace(e,n)}}(),x=function(){var e=/[A-Z]/g,n=function(e){return"-"+e.toLowerCase()};return function(t){return t.replace(e,n)}}();return{addToList:i,removeFromList:a,uniqueList:s,words:n,splitIncl:t,dashesToCamelCase:_,camelCaseToDashes:x,isEmpty:r,isControlCharacter:o,CONTROL_CHARACTER:y,SPACE:g,NOT_SPACE:N,WHITE_SPACE:f,WHITE_SPACES:p,ZERO_WIDTH_SPACE:m,NON_BREAKING_SPACE:h,WORD_BOUNDARY:S,WORD_BOUNDARY_FROM_END:T,WORD_BREAKING_CHARACTER:b,TERMINAL_WHITE_SPACES:A,ZERO_WIDTH_CHARACTERS:u,WHITE_SPACE_CHARACTERS:d,WORD_BREAKING_CHARACTERS:c,NON_BREAKING_SPACE_CHARACTERS:l}}),define("aloha/dom/attributes",["../maps","../strings","../functions"],function(e,n,t){function r(e){for(var n={},t=e.attributes,r=0,o=t.length;o>r;r++){var i=t[r];("undefined"==typeof i.specified||i.specified)&&(n[i.name]=i.value)}return n}function o(e,n){e.removeAttribute(n)}function i(n){e.keys(r(n)).forEach(t.partial(o,n))}function a(e,n,t){null==t?o(e,n):e.setAttribute(n,t)}function s(e,n){return e.getAttribute(n)}function u(e,n,t){return e.getAttributeNS(n,t)}function l(e,n,t){null!=n?e.removeAttributeNS(n,t):o(e,t)}function d(e,n,t,r){null!=n?e.setAttributeNS(n,t,r):a(e,t,r)}function c(t){return!e.vals(r(t)).every(n.isEmpty)}return{attrs:r,get:s,getNS:u,has:c,remove:o,removeAll:i,removeNS:l,set:a,setNS:d}}),define("aloha/misc",[],function(){function e(e,n){var t,r;for(t=0,r=e.length;r>t;t++)if(e[t].test(n))return!0;return!1}function n(e){return"undefined"!=typeof e}function t(e){if(!e)return e;var n,t={};for(n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}return{anyRx:e,defined:n,copy:t}}),define("aloha/dom/nodes",["../misc","../arrays"],function(e,n){function t(e){return w.TEXT===e.nodeType}function r(e){return w.ELEMENT===e.nodeType}function o(e){return w.DOCUMENT_FRAGMENT===e.nodeType}function i(e){return e.childNodes.length}function a(e){return n.coerce(e.childNodes)}function s(e){for(var n=0;e=e.previousSibling;)n++;return n}function u(e){return r(e)||o(e)?i(e):t(e)?e.length:0}function l(e){return i(e)>0}function d(e,n){return e.childNodes[n]}function c(e,n){return r(e)&&n<u(e)?e=d(e,n):t(e)&&n===e.length&&(e=e.nextSibling||e.parentNode),e}function f(e){return t(e)&&0===u(e)}function p(e,n){return e===n}function m(e,n,r){for(var o=0,i=0,a=e.firstChild;;){if(i>=n)return o;if(o>=r)return i;if(!a)break;if(t(a)){for(var s=-1;a&&t(a);)f(a)||(s=o),a=a.nextSibling,o+=1;if(-1!==s){if(s>=r)return i;i+=1}}else a=a.nextSibling,o+=1,i+=1}throw Error()}function h(e,n){return m(e,n,Number.POSITIVE_INFINITY)}function v(e,n){return m(e,Number.POSITIVE_INFINITY,n)}function g(e){return v(e,i(e))}function N(e){return v(e.parentNode,s(e))}function E(e,n){return d(e,h(e,n))}function b(e,n){return r(e)?e.compareDocumentPosition?!!(16&e.compareDocumentPosition(n)):e!==n&&(r(n)?e.contains(n):n.parentNode&&(e===n.parentNode||e.contains(n.parentNode))):!1}function S(e,n){return!!(4&e.compareDocumentPosition(n))}function T(n){if(!e.defined(n.getBoundingClientRect))return{top:0,left:0};var t=n.getBoundingClientRect();return{top:t.top+window.pageYOffset-n.ownerDocument.body.clientTop,left:t.left+window.pageXOffset-n.ownerDocument.body.clientLeft}}function y(e){return e.textContent}function A(e){return y(e).trim().length>0}function _(e,n){return e.isEqualNode(n)}function x(e,n){return e.cloneNode("boolean"==typeof n?n:!0)}function R(e){return e.cloneNode(!1)}function C(e){var n=e.ownerDocument.createElement("div");return n.appendChild(e.cloneNode(!0)),n.innerHTML}var w={ELEMENT:1,ATTR:2,TEXT:3,CDATA_SECTION:4,ENTITY_REFERENCE:5,ENTITY:6,PROCESSING_INSTRUCTION:7,COMMENT:8,DOCUMENT:9,DOCUMENTTYPE:10,DOCUMENT_FRAGMENT:11,NOTATION:12};return{Nodes:w,offset:T,children:a,nodeAtOffset:c,nthChild:d,numChildren:i,nodeIndex:s,nodeLength:u,hasChildren:l,normalizedNthChild:E,normalizedNodeIndex:N,realFromNormalizedIndex:h,normalizedNumChildren:g,isTextNode:t,isElementNode:r,isFragmentNode:o,isEmptyTextNode:f,isSameNode:p,text:y,hasText:A,equals:_,contains:b,followedBy:S,clone:x,cloneShallow:R,outerHtml:C}}),define("aloha/dom/classes",["./nodes","../arrays","../strings"],function(e,n,t){function r(e,n,r){e.className=t.uniqueList(n.apply(null,[e.className].concat(r)))}function o(e){r(e,t.addToList,n.coerce(arguments).slice(1))}function i(e){r(e,t.removeFromList,n.coerce(arguments).slice(1))}function a(n,r){return e.isElementNode(n)&&n.className.trim().split(t.WHITE_SPACES).indexOf(r)>=0}return{has:a,add:o,remove:i}}),define("aloha/dom/mutation",["./nodes","../functions","../arrays"],function(e,n,t){function r(e,n,t){t?n.appendChild(e):n.parentNode.insertBefore(e,n)}function o(e,n){r(e,n.nextSibling||n.parentNode,!n.nextSibling)}function i(e,n,t){for(var r;n;)r=n.nextSibling,e.insertBefore(n,t),n=r}function a(e,n){r(e,n,!0)}function s(e,r,o){var i=t.split(e,o||n.returnFalse);return i[0].forEach(r),i[1]}function u(e,n,t){return s(e,function(e){a(e,n)},t)}function l(n,t,r){return s(n,function(n){a(e.clone(n),t)},r)}function d(e,n,t){return s(e,function(e){r(e,n,!1)},t)}function c(e,n,t){return s(e,function(e){o(e,n),n=e},t)}function f(e,n){return e.parentNode.replaceChild(n,e)}function p(n,t){return u(e.children(n),t),f(n,t)}function m(e){e.parentNode.removeChild(e)}function h(n){d(e.children(n),n),m(n)}function v(e,n){a(f(e,n),n)}function g(e,n){var t=e.ownerDocument.createElement(n);return v(e,t),t}function N(n){e.children(n).forEach(m)}function E(n,t){for(var r;n&&t&&n.nodeName===t.nodeName;){if(e.isTextNode(n))return;if(r=t.firstChild,i(n,r,null),m(t),!r)return;t=r,n=t.previousSibling}}return{append:a,merge:E,moveNextAll:i,moveAfter:c,moveBefore:d,move:u,copy:l,wrap:v,wrapWith:g,insert:r,insertAfter:o,replace:f,replaceShallow:p,remove:m,removeShallow:h,removeChildren:N}}),define("aloha/dom/style",["../strings"],function(e){function n(n,t,r){t=e.dashesToCamelCase(t);var o=n.style;t in o&&(o[t]=r)}function t(n,t){return t=e.dashesToCamelCase(t),n.style[t]}function r(e,n){var t={},r=e.ownerDocument;if(r&&r.defaultView&&r.defaultView.getComputedStyle){var o=r.defaultView.getComputedStyle(e,null);o&&n.forEach(function(e){t[e]=o[e]||o.getPropertyValue(e)})}else e.currentStyle&&n.forEach(function(n){t[n]=e.currentStyle[n]});return t}function o(n,t){var r=n.ownerDocument;if(r&&r.defaultView&&r.defaultView.getComputedStyle){var o=r.defaultView.getComputedStyle(n,null);if(o)return o[t]||o.getPropertyValue(t)}return n.currentStyle?(t=e.dashesToCamelCase(t),n.currentStyle[t]):null}function i(n,t){n.style.removeProperty(t),e.isEmpty(n.getAttribute("style"))&&n.removeAttribute("style")}return{set:n,get:t,remove:i,getComputedStyle:o,getComputedStyles:r}}),define("aloha/dom/traversing",["./nodes","../functions","../arrays"],function(e,n,t){function r(e){if(e.firstChild)return e.firstChild;for(var n=e;n&&!n.nextSibling;)n=n.parentNode;return n&&n.nextSibling}function o(e){for(var n=e.previousSibling;n&&n.lastChild;)n=n.lastChild;return n||e.parentNode}function i(e,t,r,o){if((r=r||n.returnFalse)(e))return null;do{if(e=o(e),!e||r(e))return null;if(t(e))return e}while(e);return null}function a(e,n,t){return i(e,n,t,r)}function s(e,n,t){return i(e,n,t,o)}function u(e,n){var t=!0;do!t&&e.lastChild?e=e.lastChild:e.previousSibling?(e=e.previousSibling,t=!1):(e=e.parentNode,t=!0);while(!n(e,t));return e}function l(e,n){var t=!1;do!t&&e.firstChild?e=e.firstChild:e.nextSibling?(e=e.nextSibling,t=!1):(e=e.parentNode,t=!0);while(!n(e,t));return e}function d(e){return e.nextSibling}function c(e){return e.previousSibling}function f(e){return e.parentNode}function p(e,n,t,r){for(;e&&t(e,r);)e=n(e,r);return e}function m(e,n,t,r,o){return p(e,function(e){var r=t(e);return n(e,o),r},r,o)}function h(e,t,r,o,i){return m(e,t,r,n.complement(o),i)}function v(e,n,t){return p(e,d,n,t)}function g(e,n,t){return p(e,c,n,t)}function N(e,n){return p(e,f,n)}function E(e,n,t,r){h(e,n,d,t,r)}function b(e,n,t,r){h(e,n,c,t,r)}function S(e,n,t,r){h(e,n,f,t,r)}function T(e,t,r){E(e,t,n.returnFalse,r)}function y(n,t,r){e.isElementNode(n)&&T(n.firstChild,function(e){y(e,t,r)}),t(n,r)}function A(e,n,t,r){E(e,n,function(e){return e===t},r)}function _(e,n){for(var t=[],r=e.parentNode;r&&!n(r);)t.push(r),r=r.parentNode;return t}function x(e,n){var t=_(e,n),r=t.length?t[t.length-1]:e;return r.parentNode&&t.push(r.parentNode),t}function R(e,n){if(n(e))return[];var t=_(e,n);return t.unshift(e),t}function C(e,n){if(n(e))return[e];var t=x(e,n);return t.unshift(e),t}function w(e,n){return R(e,function(e){return e===n})}function O(e,n){return C(e,function(e){return e===n})}function I(e,t,r,o){r=r||n.returnTrue,o=o||n.returnFalse;for(var i,a=e;a;)if(i=t?a.previousSibling:a.nextSibling){if(o(i))return null;if(r(i))return i;a=i}else{if(!a.parentNode||o(a.parentNode))return null;a=a.parentNode}}function L(e,n){return t.coerce(n.querySelectorAll(e))}function B(e,t){if(!e.previousSibling)return[];var r=[];return b(e.previousSibling,function(e){r.push(e)},t||n.returnFalse),r.reverse()}function k(e,t){if(!e.nextSibling)return[];var r=[];return E(e.nextSibling,function(e){r.push(e)},t||n.returnFalse),r}function D(e,n){return n&&n(e)?[]:B(e,n).concat(e)}function P(e,n){return n&&n(e)?[]:[e].concat(k(e,n))}return{query:L,nextNonAncestor:I,nextUntil:E,nextWhile:v,nextSibling:d,nextSiblings:k,prevUntil:b,prevWhile:g,prevSibling:c,prevSiblings:B,nodeAndPrevSiblings:D,nodeAndNextSiblings:P,walk:T,walkRec:y,walkUntilNode:A,forward:r,backward:o,findForward:a,findBackward:s,upWhile:N,climbUntil:S,childAndParentsUntil:R,childAndParentsUntilIncl:C,childAndParentsUntilNode:w,childAndParentsUntilInclNode:O,parentsUntil:_,parentsUntilIncl:x,forwardPreorderBacktraceUntil:l,backwardPreorderBacktraceUntil:u}}),define("aloha/browsers",[],function(){for(var e="",n=document.createElement("div"),t=["","-webkit-","-moz-","-ms-","-o-"],r=n.style,o=0;o<t.length;o++)r.hasOwnProperty(t[o]+"transform")&&(e=t[o]);var i,a,s,u,l,d,c=navigator.userAgent.toLowerCase(),f=/(chrome)[ \/]([\w.]+)/.exec(c)||/(webkit)[ \/]([\w.]+)/.exec(c)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(c)||/(msie) ([\w.]+)/.exec(c)||c.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(c);s=u=l=d=!1,f&&(i=f[1],a=f[2],s="msie"===a&&parseInt(a,10)<8,"chrome"===i?d=!0:"webkit"===i&&(l=!0));var p={ie7:s,chrome:u,webkit:d,safari:l,vendor:i,version:a,VENDOR_PREFIX:e};return f&&(p[i]=!0),p}),define("aloha/dom",["./functions","./dom/attributes","./dom/classes","./dom/mutation","./dom/nodes","./dom/style","./dom/traversing","./browsers"],function(e,n,t,r,o,i,a,s){function u(e){if(!o.isElementNode(e))return!1;if("true"===e.getAttribute("contentEditable"))return!0;if(t.has(e,"aloha-editable"))return!0;var n=e.paretNode;return n?n.nodeType===o.Nodes.DOCUMENT&&"on"===n.designMode?!0:void 0:!1}function l(e){return o.isElementNode(e)&&"true"===e.contentEditable}function d(e){if(!o.isElementNode(e))return!1;var n=e.getAttribute("contentEditable");if("true"===n||""===n)return!0;if("false"===n)return!1;if(t.has(e,"aloha-editable"))return!0;var r=e.parentNode;return r?r.nodeType===o.Nodes.DOCUMENT&&"on"===r.designMode?!0:d(r):!1}function c(e){return d(o.isTextNode(e)?e.parentNode:e)}function f(e){if(u(e))return e;if(!c(e))return null;for(var n=e.parentNode;n&&!u(n);)n=n.parentNode;return n}function p(e){for(var n=e.parentNode;n&&!d(n);)n=n.parentNode;return n}function m(e){return A.serializeToString(e)}function h(e){return e[x]=e[x]||++_}function v(e){e.removeAttribute("unselectable","on"),i.set(e,s.VENDOR_PREFIX+"user-select","all"),e.onselectstart=null}function g(n){n.removeAttribute("unselectable","on"),i.set(n,s.VENDOR_PREFIX+"user-select","none"),n.onselectstart=e.returnFalse}function N(e){return e.defaultView||e.parentWindow}function E(n){var t=N(n);if(!e.isNou(t.pageYOffset))return t.pageYOffset;var r=n.documentElement,o=r.clientHeight?r:n.body;return o.scrollTop}function b(n){var t=N(n);if(!e.isNou(t.pageXOffset))return t.pageXOffset;var r=n.documentElement,o=r.clientWidth?r:n.body;return o.scrollLeft}function S(e,n){for(var t=e[n],r=e.offsetParent;r;)t+=r[n],r=r.offsetParent;return t}function T(e){return S(e,"offsetTop")}function y(e){return S(e,"offsetLeft")}var A=window.XMLSerializer&&new window.XMLSerializer,_=0,x="!aloha-expando-node-id";return{Nodes:o.Nodes,offset:o.offset,cloneShallow:o.cloneShallow,clone:o.clone,text:o.text,children:o.children,nthChild:o.nthChild,numChildren:o.numChildren,nodeIndex:o.nodeIndex,nodeLength:o.nodeLength,hasChildren:o.hasChildren,nodeAtOffset:o.nodeAtOffset,normalizedNthChild:o.normalizedNthChild,normalizedNodeIndex:o.normalizedNodeIndex,realFromNormalizedIndex:o.realFromNormalizedIndex,normalizedNumChildren:o.normalizedNumChildren,isTextNode:o.isTextNode,isElementNode:o.isElementNode,isFragmentNode:o.isFragmentNode,isEmptyTextNode:o.isEmptyTextNode,isSameNode:o.isSameNode,equals:o.equals,contains:o.contains,followedBy:o.followedBy,hasText:o.hasText,outerHtml:o.outerHtml,append:r.append,merge:r.merge,moveNextAll:r.moveNextAll,moveBefore:r.moveBefore,moveAfter:r.moveAfter,move:r.move,copy:r.copy,wrap:r.wrap,wrapWith:r.wrapWith,insert:r.insert,insertAfter:r.insertAfter,replace:r.replace,replaceShallow:r.replaceShallow,remove:r.remove,removeShallow:r.removeShallow,removeChildren:r.removeChildren,addClass:t.add,removeClass:t.remove,hasClass:t.has,attrs:n.attrs,getAttr:n.get,getAttrNS:n.getNS,hasAttrs:n.has,removeAttr:n.remove,removeAttrNS:n.removeNS,removeAttrs:n.removeAll,setAttr:n.set,setAttrNS:n.setNS,removeStyle:i.remove,setStyle:i.set,getStyle:i.get,getComputedStyle:i.getComputedStyle,getComputedStyles:i.getComputedStyles,query:a.query,nextNonAncestor:a.nextNonAncestor,nextWhile:a.nextWhile,nextUntil:a.nextUntil,nextSibling:a.nextSibling,nextSiblings:a.nextSiblings,prevWhile:a.prevWhile,prevUntil:a.prevUntil,prevSibling:a.prevSibling,prevSiblings:a.prevSiblings,nodeAndNextSiblings:a.nodeAndNextSiblings,nodeAndPrevSiblings:a.nodeAndPrevSiblings,walk:a.walk,walkRec:a.walkRec,walkUntilNode:a.walkUntilNode,forward:a.forward,backward:a.backward,findForward:a.findForward,findBackward:a.findBackward,upWhile:a.upWhile,climbUntil:a.climbUntil,childAndParentsUntil:a.childAndParentsUntil,childAndParentsUntilIncl:a.childAndParentsUntilIncl,childAndParentsUntilNode:a.childAndParentsUntilNode,childAndParentsUntilInclNode:a.childAndParentsUntilInclNode,parentsUntil:a.parentsUntil,parentsUntilIncl:a.parentsUntilIncl,forwardPreorderBacktraceUntil:a.forwardPreorderBacktraceUntil,backwardPreorderBacktraceUntil:a.backwardPreorderBacktraceUntil,serialize:m,ensureExpandoId:h,enableSelection:v,disableSelection:g,isEditable:d,isEditableNode:c,isEditingHost:u,isContentEditable:l,documentWindow:N,editingHost:f,editableParent:p,scrollTop:E,scrollLeft:b,absoluteTop:T,absoluteLeft:y}}),define("aloha/events",["./misc","./assert"],function(e,n){function t(e,t,r,o){var i=!!o;e.addEventListener?e.addEventListener(t,r,i):e.attachEvent?e.attachEvent("on"+t,r):n.error()}function r(e,t,r,o){var i=!!o;e.removeEventListener?e.removeEventListener(t,r,i):e.detachEvent?e.detachEvent("on"+t,r):n.error()}function o(e,t,r){var o;t.dispatchEvent?(o=e.createEvent("Event"),o.initEvent(r,!0,!0),t.dispatchEvent(o)):t.fireEvent?(o=e.createEventObject(),o.type=r,t.fireEvent("on"+r,o)):n.error()}function i(e,n){return e.meta.indexOf(n)>-1}function a(e){setTimeout(e,4)}function s(e,n){t(e,"resize",n),t(e,"keyup",n),t(e,"keydown",n),t(e,"keypress",n),t(e,"click",n),t(e,"mouseup",n),t(e,"mousedown",n),t(e,"mousemove",n),t(e,"dblclick",n),t(e,"dragstart",n),t(e,"drag",n),t(e,"dragenter",n),t(e,"dragexit",n),t(e,"dragleave",n),t(e,"dragover",n),t(e,"drop",n),t(e,"dragend",n),t(e,"paste",n)}function u(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function l(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function d(e){l(e),u(e)}return{add:t,remove:r,setup:s,hasKeyModifier:i,dispatch:o,nextTick:a,preventDefault:u,stopPropagation:l,suppress:d}}),define("aloha/ranges",["./dom","./arrays"],function(e,n){function t(e,n,t,r){var o=e.ownerDocument.createRange();return o.setStart(e,n||0),t?o.setEnd(t,r||0):o.setEnd(e,n||0),o}function r(e,n,r){if(0>e||0>n)return null;if(r.caretRangeFromPoint)return r.caretRangeFromPoint(e,n);if(r.caretPositionFromPoint){var o=r.caretPositionFromPoint(e,n);return t(o.offsetNode,o.offset)}if(r.elementFromPoint)return u(e,n,r);throw"fromPoint() unimplemented for this browser"}function o(e,n,t){return n<t.bottom&&e>=t.left&&e<=t.right}function i(e,t){var r=n.last(e.getClientRects());return r?{left:t||r.left,right:r.right,bottom:r.bottom}:null}function a(e,n,t,r,s,u){n.setStart(e,t),n.setEnd(e,t);var l=i(n,u);return l&&o(r,s,l)?(l.right-r>r-l.left&&t--,{node:e,index:t}):t<e.length?a(e,n,++t,r,s,l?l.left:null):null}function s(t,r,i,u){if(e.isTextNode(t)){var l=a(t,r,0,i,u);if(l)return l}else{r.setEndAfter(t);var d=n.last(r.getClientRects());if(d&&o(i,u,d))return{node:t.parentNode,index:e.nodeIndex(t)}}return t.nextSibling?s(t.nextSibling,r,i,u):{node:t.parentNode,index:e.nodeIndex(t)}}function u(n,r,o){var i=o.elementFromPoint(n,r),a=o.createRange(),u={node:i.firstChild,index:-1};return a.selectNodeContents(i),a.collapse(!0),u=u.node?s(u.node,a,n,r):{node:i.parentNode,index:e.nodeIndex(i)},t(u.node,u.index)}function l(n){var t=e.isEditable(n)?e.editingHost(n):n,r=e.upWhile(t,function(n){return n.parentNode&&!e.isEditable(n.parentNode)});return e.Nodes.DOCUMENT===r.nodeType?null:r}function d(n,o,i){var a=r(n,o,i);if(!a)return null;if(e.isEditableNode(a.commonAncestorContainer))return a;var s=l(a.commonAncestorContainer);if(!s||!s.parentNode)return null;var u=i.body,d=e.offset(s),c=e.nodeIndex(s),f=n+u.scrollLeft,p=d.left+u.scrollLeft+s.offsetWidth;return f>p&&(c+=1),t(s.parentNode,c)}function c(e,n){return e.startContainer===n.startContainer&&e.startOffset===n.startOffset&&e.endContainer===n.endContainer&&e.endOffset===n.endOffset}return{equals:c,create:t,fromPosition:d}}),define("aloha/boundaries",["./dom","./ranges","./arrays","./assert"],function(e,n,t,r){function o(e,n){return[e,n]}function i(e){return e[0]}function a(e){return e[1]}function s(e){return i(e).ownerDocument}function u(n){return o(n.parentNode,e.nodeIndex(n))}function l(n){return o(n.parentNode,e.nodeIndex(n)+1)}function d(e){return o(e,0)}function c(n){return o(n,e.nodeLength(n))}function f(n){var t=i(n);if(e.isTextNode(t)){r.assertNotNou(t.parentNode);var o=a(n);if(0===o)return u(t);if(o>=e.nodeLength(t))return l(t)}return n}function p(e,n){return r.assert(n>-1,"Boundaries.create(): Offset must be 0 or greater"),f(o(e,n))}function m(e,n){return i(e)===i(n)&&a(e)===a(n)}function h(e,n){n=f(n),e.setStart(i(n),a(n))}function v(e,n){n=f(n),e.setEnd(i(n),a(n))}function g(e,n,t){h(e,n),v(e,t)}function N(e,n){t.partition(n,2).forEach(function(n,t){g(e[t],n[0],n[1])})}function E(e){return p(e.startContainer,e.startOffset)}function b(e){return p(e.endContainer,e.endOffset)}function S(e){return[E(e),b(e)]}function T(e){return e=e||[],t.mapcat(e,S)}function y(e){return 0===a(f(e))}function A(n){return n=f(n),a(n)===e.nodeLength(i(n))}function _(e){return 0===a(e)}function x(n){return a(n)===e.nodeLength(i(n))}function R(n){return e.isTextNode(i(n))}function C(e){return!R(e)}function w(n){return n=f(n),A(n)?null:e.nthChild(i(n),a(n))}function O(n){return n=f(n),y(n)?null:e.nthChild(i(n),a(n)-1)}function I(e){return e=f(e),w(e)||i(e)}function L(e){return e=f(e),O(e)||i(e)}function B(e){return l(I(e))}function k(n){n=f(n);var t=i(n);return e.isTextNode(t)||y(n)?u(t):(t=e.nthChild(t,a(n)-1),e.isTextNode(t)?u(t):c(t))}function D(n){n=f(n);var t=i(n),r=a(n);if(e.isTextNode(t)||A(n))return B(n);var o=e.nthChild(t,r);return e.isTextNode(o)?l(o):d(o)}function P(n){var t=i(n);return _(n)?u(t):R(n)?d(t):(t=e.nthChild(t,a(n)-1),c(t))}function H(n){var t=i(n);return x(n)?l(t):R(n)?c(t):d(e.nthChild(t,a(n)))}function M(e,n,t){for(var r=e;n(r);)r=t(r);return r}function F(e,n){return M(e,n,D)}function U(e,n){return M(e,n,k)}function W(e,n,t,r){for(var o=e;o&&n(o);)r(o),o=t(o)}function G(e){var n=e.getSelection();return n.rangeCount>0?S(n.getRangeAt(0)):null}function z(e,t){return n.create(i(e),a(e),i(t),a(t))}function V(e,n){n||(n=e);var t=z(e,n),r=t.commonAncestorContainer.ownerDocument,o=r.getSelection();o.removeAllRanges(),o.addRange(t)}function q(e,n){return z(e,n).commonAncestorContainer}function Y(e,t,r){var o=n.fromPosition(e,t,r);return o&&S(o)}return{get:G,select:V,raw:o,create:p,normalize:f,equals:m,container:i,offset:a,document:s,range:z,fromRange:S,fromRanges:T,fromRangeStart:E,fromRangeEnd:b,fromFrontOfNode:u,fromBehindOfNode:l,fromStartOfNode:d,fromEndOfNode:c,fromPosition:Y,setRange:g,setRanges:N,setRangeStart:h,setRangeEnd:v,isAtStart:y,isAtEnd:A,isAtRawStart:_,isAtRawEnd:x,isTextBoundary:R,isNodeBoundary:C,next:D,prev:k,nextRawBoundary:H,prevRawBoundary:P,jumpOver:B,nextWhile:F,prevWhile:U,stepWhile:M,walkWhile:W,nextNode:I,prevNode:L,nodeAfter:w,nodeBefore:O,commonContainer:q}}),define("aloha/html/predicates",[],function(){function e(e){return h[e.nodeName]}function n(e){return!!v[e.nodeName]}function t(e){return!!m[e.nodeName]}function r(e){return!!p[e.nodeName]}function o(e){return"TABLE"===e.nodeName}function i(e){return!!d[e.nodeName]}function a(e){return!!c[e.nodeName]}function s(e){return!a(e)}function u(e){return!!f[e.nodeName]}function l(e){return!!g[e.nodeName]}var d={AREA:!0,BASE:!0,BR:!0,COL:!0,COMMAND:!0,EMBED:!0,HR:!0,IMG:!0,INPUT:!0,KEYGEN:!0,LINK:!0,META:!0,PARAM:!0,SOURCE:!0,TRACK:!0,WBR:!0},c={ADDRESS:!0,ARTICLE:!0,ASIDE:!0,AUDIO:!0,BLOCKQUOTE:!0,CANVAS:!0,DD:!0,DIV:!0,DL:!0,FIELDSET:!0,FIGCAPTION:!0,FIGURE:!0,FOOTER:!0,FORM:!0,H1:!0,H2:!0,H3:!0,H4:!0,H5:!0,H6:!0,HEADER:!0,HGROUP:!0,HR:!0,NOSCRIPT:!0,OL:!0,OUTPUT:!0,P:!0,PRE:!0,SECTION:!0,TABLE:!0,TFOOT:!0,UL:!0,VIDEO:!0},f={A:!0,ABBR:!0,B:!0,BDI:!0,BDO:!0,BR:!0,CITE:!0,CODE:!0,DATA:!0,DFN:!0,EM:!0,I:!0,KBD:!0,MARK:!0,Q:!0,RP:!0,RT:!0,RUBY:!0,S:!0,SAMP:!0,SMALL:!0,SPAN:!0,STRONG:!0,SUB:!0,SUP:!0,TIME:!0,U:!0,VAR:!0,WBR:!0},p={OL:!0,UL:!0,DL:!0,MENU:!0},m={LI:!0,DT:!0,DD:!0},h={FIELDSET:!0,OBJECT:!0,FIGURE:!0,AUDIO:!0,SELECT:!0,COLGROUP:!0,HGROUP:!0,TABLE:!0,TBODY:!0,TR:!0,OL:!0,UL:!0,DL:!0,MENU:!0},v={LI:["OL","UL","DL"],DT:["DL"],DD:["DL"],TBODY:["TABLE"],TR:["TABLE","TBODY"],TH:["TABLE","TBODY"],TD:["TR","TH"]},g={H1:!0,H2:!0,H3:!0,H4:!0,H5:!0,H6:!0};return{isBlockNode:a,isGroupContainer:e,isGroupedElement:n,isHeading:l,isInlineNode:s,isListContainer:r,isListItem:t,isTableContainer:o,isTextLevelSemanticNode:u,isVoidNode:i}}),define("aloha/html/styles",["../dom","./predicates"],function(e,n){function t(t){if(!t)return!1;switch(t.nodeType){case e.Nodes.DOCUMENT:case e.Nodes.DOCUMENT_FRAGMENT:return!0;case e.Nodes.ELEMENT:var r=e.getComputedStyle(t,"display");return r?!l[r]:n.isBlockNode(t);default:return!1}}function r(e){return!t(e)}function o(e){return s[e.nodeName]||u[e.nodeName]||t(e)}function i(e){return"pre"===e||"pre-wrap"===e||"-moz-pre-wrap"===e}function a(e){return!d[e]}var s={BR:!0,HR:!0,IMG:!0},u={LI:!0,DT:!0,DD:!0},l={inline:!0,"inline-block":!0,"inline-table":!0,none:!0},d={"background-color":!0,underline:!0};return{isStyleInherited:a,isWhiteSpacePreserveStyle:i,hasBlockStyle:t,hasInlineStyle:r,hasLinebreakingStyle:o}}),define("aloha/cursors",["./dom","./boundaries"],function(e,n){function t(e,n){this.node=e,this.atEnd=n
}function r(e,n){return new t(e,n)}function o(t,o){return r(e.nodeAtOffset(t,o),n.isAtEnd(n.raw(t,o)))}function i(n,t){return t.atEnd?n.setStart(t.node,e.nodeLength(t.node)):n.setStart(t.node.parentNode,e.nodeIndex(t.node)),n}function a(n,t){return t.atEnd?n.setEnd(t.node,e.nodeLength(t.node)):n.setEnd(t.node.parentNode,e.nodeIndex(t.node)),n}function s(t){return t.atEnd?n.create(t.node,e.nodeLength(t.node)):n.create(t.node.parentNode,e.nodeIndex(t.node))}function u(e,n,t){return n&&i(e,n),t&&a(e,t),e}return t.prototype.next=function(){var n,t=this.node;if(this.atEnd||!e.isElementNode(t)){if(n=t.nextSibling)this.atEnd=!1;else{if(n=t.parentNode,!n)return!1;this.atEnd=!0}this.node=n}else n=t.firstChild,n?this.node=n:this.atEnd=!0;return!0},t.prototype.prev=function(){var n,t=this.node;if(this.atEnd)n=t.lastChild,n?(this.node=n,e.isElementNode(n)||(this.atEnd=!1)):this.atEnd=!1;else{if(n=t.previousSibling)e.isElementNode(n)&&(this.atEnd=!0);else if(n=t.parentNode,!n)return!1;this.node=n}return!0},t.prototype.skipPrev=function(){var e=this.prevSibling();return e?(this.node=e,this.atEnd=!1,!0):this.prev()},t.prototype.skipNext=function(){return this.atEnd?this.next():(this.atEnd=!0,this.next())},t.prototype.nextWhile=function(e){for(;e(this);)if(!this.next())return!1;return!0},t.prototype.prevWhile=function(e){for(;e(this);)if(!this.prev())return!1;return!0},t.prototype.parent=function(){return this.atEnd?this.node:this.node.parentNode},t.prototype.prevSibling=function(){return this.atEnd?this.node.lastChild:this.node.previousSibling},t.prototype.nextSibling=function(){return this.atEnd?null:this.node.nextSibling},t.prototype.equals=function(e){return e.node===this.node&&e.atEnd===this.atEnd},t.prototype.setFrom=function(e){this.node=e.node,this.atEnd=e.atEnd},t.prototype.clone=function(){return r(this.node,this.atEnd)},t.prototype.insert=function(n){return e.insert(n,this.node,this.atEnd)},t.prototype.next=t.prototype.next,t.prototype.prev=t.prototype.prev,t.prototype.skipPrev=t.prototype.skipPrev,t.prototype.skipNext=t.prototype.skipNext,t.prototype.nextWhile=t.prototype.nextWhile,t.prototype.prevWhile=t.prototype.prevWhile,t.prototype.parent=t.prototype.parent,t.prototype.prevSibling=t.prototype.prevSibling,t.prototype.nextSibling=t.prototype.nextSibling,t.prototype.equals=t.prototype.equals,t.prototype.setFrom=t.prototype.setFrom,t.prototype.clone=t.prototype.clone,t.prototype.insert=t.prototype.insert,{cursor:r,cursorFromBoundaryPoint:o,create:r,createFromBoundary:o,setToRange:u,setRangeStart:i,setRangeEnd:a,toBoundary:s}}),define("aloha/html/elements",["./styles","./predicates","../dom","../arrays","../cursors","../strings"],function(e,n,t,r,o,i){function a(e){return n.isVoidNode(e)||!t.isEditableNode(e)}function s(n){if(!t.isTextNode(n))return!1;if(!n.length)return!0;if(i.NOT_SPACE.test(n.nodeValue)||i.NON_BREAKING_SPACE.test(n.nodeValue))return!1;var r;return n.parentNode&&(r=t.getComputedStyle(n.parentNode,"white-space"),e.isWhiteSpacePreserveStyle(r))?!1:"pre-line"===r&&/[\r\n]/.test(n.data)?!1:!0}function u(n){return s(n.node)||t.isElementNode(n.node)&&e.hasInlineStyle(n.node)&&!N[n.node]}function l(n){var t=n.clone();return t.nextWhile(u),e.hasLinebreakingStyle(t.node)?(n.setFrom(t),!0):!1}function d(n){var t=n.clone();if(t.prev(),t.prevWhile(u),!e.hasLinebreakingStyle(t.node))return!1;var r="BR"===t.node.nodeName;if(t.next(),r){var o=n.clone();if(l(o)&&o.atEnd){if(t.skipPrev(),t.prevWhile(u),!e.hasLinebreakingStyle(t.node))return!1;t.next()}}return n.setFrom(t),!0}function c(e){return s(e)?l(o.cursor(e,!1))||d(o.cursor(e,!1)):!1}function f(e){var n=e.parentNode;return n&&(e===n.firstChild||e===n.lastChild)}function p(e){return e.previousSibling&&n.isBlockNode(e.previousSibling)||e.nextSibling&&n.isBlockNode(e.nextSibling)}function m(r){if(!n.isVoidNode(r)&&!n.isListItem(r)&&0===t.nodeLength(r))return!0;if(r.firstChild&&!t.nextWhile(r.firstChild,m))return!0;var i=s(r);if(!i){if("BR"===r.nodeName&&f(r)&&e.hasLinebreakingStyle(r.parentNode)){if(r.nextSibling&&"BR"===r.nextSibling.nodeName)return!0;if(r.previousSibling&&"BR"===r.previousSibling.nodeName)return!0;if(r.nextSibling&&t.nextWhile(r.nextSibling,m))return!0;if(r.previousSibling&&t.prevWhile(r.previousSibling,m))return!0}return!1}if(f(r)){if(!t.isTextNode(r))return!1;var a=t.nextNonAncestor(r,!1,function(e){return n.isInlineNode(e)&&!m(e)},function(n){return e.hasLinebreakingStyle(n)||t.isEditingHost(n)});return!a}return p(r)||l(o.create(r,!1))||d(o.create(r,!1))}function h(e){return!m(e)}function v(e,n){var o=n.createElement("DIV");o.innerHTML=e;var i=r.coerce(o.childNodes);return i.forEach(t.remove),i}function g(n){var r=n.parentNode;if("BR"!==n.nodeName||!r)return!1;if(!e.hasLinebreakingStyle(r))return!1;var o=t.children(r).filter(h);return 1===o.length&&n===o[0]}var N={BR:!0,HR:!0,IMG:!0};return{parse:v,isVoidType:a,isRendered:h,isUnrendered:m,isUnrenderedWhitespace:c,isUnrenderedWhitespaceNoBlockCheck:s,isProppingBr:g,skipUnrenderedToEndOfLine:l,skipUnrenderedToStartOfLine:d}}),define("aloha/paths",["./dom","./arrays","./boundaries"],function(e,n,t){function r(n,r){var o=t.offset(r),i=t.container(r);if(i===n)return[o];var a=e.childAndParentsUntilNode(i,n),s=a.reduce(function(n,t){return n.concat(e.nodeIndex(t))},[o]);return s.reverse(),s}function o(e,r){var o=r.slice(0,-1).reduce(function(e,n){return e.childNodes[n]||e},e);return t.raw(o,n.last(r)||0)}return{toBoundary:o,fromBoundary:r}}),define("aloha/html/traversing",["./elements","./styles","./predicates","../dom","../paths","../arrays","../boundaries","../strings"],function(e,n,t,r,o,i,a,s){function u(e,n,t){return r.nextNonAncestor(e,!0,n,t||r.isEditingHost)}function l(e,n,t){return r.nextNonAncestor(e,!1,n,t||r.isEditingHost)}function d(o){var i=a.container(o),s=a.offset(o),d=r.isTextNode(i);return d&&i.data.substr(0,s).search(z)>-1?!1:0===s?!!u(i,function(n){return t.isInlineNode(n)&&e.isRendered(n)},function(e){return n.hasLinebreakingStyle(e)||r.isEditingHost(e)}):d&&0!==i.data.substr(s).search(z)?!0:!!l(i,function(n){return t.isInlineNode(n)&&e.isRendered(n)},function(e){return n.hasLinebreakingStyle(e)||r.isEditingHost(e)})}function c(e){var n=a.container(e),t=a.offset(e),r=n.data.substr(0,t);if(!q.test(r))return d(a.raw(n,0))?1:-1;var o=r.match(V)[0].length-1;if(t=2>o?t:t-o+1,0===t)return 0;var i=a.raw(n,t-1),s=!q.test(r.charAt(t-1)),u=!s||d(i);return u?t:c(i)}function f(e){var n=a.container(e),t=a.offset(e),r=n.data.substr(t).search(d(e)?Y:q);return-1===r?-1:t+r}function p(e){if(a.isNodeBoundary(e))return null;var n=f(e);return-1===n?null:a.create(a.container(e),n+1)}function m(e){if(a.isNodeBoundary(e))return null;var n=c(e);return-1===n?null:a.create(a.container(e),n-1)}function h(n,o,i,s,u){return a.normalize(o(n,function(n){var o=i(n);return e.isUnrendered(o)?!0:u(n)?r.isEditingHost(o)?!1:t.isListItem(o)&&s(n)?!1:!0:!r.isTextNode(o)&&!e.isVoidType(o)}))}function v(e,n){return a.stepWhile(e,n,S)}function g(e,n){return a.stepWhile(e,n,T)}function N(e){return h(e,g,a.prevNode,a.isAtEnd,a.isAtStart)}function E(e){return h(e,v,a.nextNode,a.isAtStart,a.isAtEnd)}function b(t,o){if(a.isTextBoundary(t)){var i=o.nextCharacter(t);if(i)return i}var s=o.nodeAt(t);if(r.isEditingHost(s))return t;if(r.isTextNode(s)||e.isUnrendered(s))return b(o.stepBoundary(t),o);if(n.hasLinebreakingStyle(s))return o.expand(o.stepBoundary(t));for(;;){if(e.isRendered(s)&&(r.isTextNode(s)||n.hasLinebreakingStyle(s)||r.isEditingHost(s)))break;t=o.stepBoundary(t),s=o.nodeAt(t)}return b(t,o)}function S(n){if(a.isNodeBoundary(n)){var t=a.nodeAfter(n);if(t&&e.isVoidType(t))return a.jumpOver(n)}return a.nextRawBoundary(n)}function T(n){if(a.isNodeBoundary(n)){var t=a.nodeBefore(n);if(t&&e.isVoidType(t))return a.fromFrontOfNode(t)}return a.prevRawBoundary(n)}function y(e){return!U[e.nodeName]}function A(e){return b(e,K)}function _(e){return b(e,j)}function x(n){var t,o=n;if(a.isTextBoundary(o)){var i=f(o);return-1===i?(t=a.nodeAfter(o),t&&e.isUnrendered(t)?x(a.jumpOver(o)):t&&e.isVoidType(t)?o:x(a.next(o))):a.offset(o)===i?o:(o=a.create(a.container(o),i),x(o))}if(t=a.nextNode(o),r.isTextNode(t))return x(a.nextRawBoundary(o));for(;!r.isEditingHost(t)&&e.isUnrendered(t);)o=a.next(o),t=a.nextNode(o);return o}function R(t,o){var i,s;for(t=x(a.normalize(t)),o=x(a.normalize(o));t&&!a.equals(t,o);){if(i=a.nextNode(t),r.isEditingHost(i))return!1;if(s=r.isTextNode(i)||e.isVoidType(i)||n.hasLinebreakingStyle(i),s&&e.isRendered(i))return!1;t=x(a.next(t))}return!0}function C(t){var o,i=t;if(a.isTextBoundary(i)){var s=c(i);if(-1===s){for(var u=a.prev(i);R(u,i)&&!n.hasLinebreakingStyle(a.prevNode(u));)u=a.prev(u);return C(u)}return a.offset(i)===s?i:(i=a.create(a.container(i),s),C(i))}if(o=a.prevNode(i),r.isTextNode(o))return C(a.prevRawBoundary(i));for(;!r.isEditingHost(o)&&e.isUnrendered(o);)i=a.prev(i),o=a.prevNode(i);return i}function w(e){var n=a.container(e),t=a.offset(e),r=n.data.substr(t),o=r.search(s.WORD_BOUNDARY);return-1===o?-1:t+o}function O(e){var n=a.container(e),t=a.offset(e),r=n.data.substr(0,t),o=r.search(s.WORD_BOUNDARY_FROM_END);return-1===o?-1:o+1}function I(e){var n,t;if(a.isNodeBoundary(e))return n=a.nextNode(e),t=a.nextRawBoundary(e),y(n)?e:I(t);var r=w(e);return-1===r?(t=a.next(e),n=a.nextNode(t),y(n)?t:I(t)):r===a.offset(e)?e:a.raw(a.container(e),r)}function L(e){var n,t;if(a.isNodeBoundary(e))return n=a.prevNode(e),t=a.prevRawBoundary(e),y(n)?e:L(t);var r=O(e);return-1===r?(t=a.prev(e),n=a.prevNode(t),y(n)?t:L(t)):r===a.offset(e)?e:a.raw(a.container(e),r)}function B(e,n){if("node"===n)return a.next(e);e=x(a.normalize(e));var t;switch(n){case"char":t=p(e);break;case"word":t=I(e),R(e,t)&&(t=A(e));break;case"boundary":t=S(e);break;default:t=A(e)}return t}function k(e,n){if("node"===n)return a.prev(e);e=C(a.normalize(e));var t;switch(n){case"char":t=m(e);break;case"word":t=L(e),R(t,e)&&(t=_(e));break;case"boundary":t=T(e);break;default:t=_(e)}return t&&C(t)}function D(n){if(a.isAtEnd(n))return!0;if(a.isTextBoundary(n))return!q.test(a.container(n).data.substr(a.offset(n)));var t=a.nodeAfter(n);return!r.nextWhile(t,e.isUnrendered)}function P(n){if(a.isAtStart(n))return!0;if(a.isTextBoundary(n))return!q.test(a.container(n).data.substr(0,a.offset(n)));var t=a.nodeBefore(n);return!r.prevWhile(t,e.isUnrendered)}function H(e){return D(e)?a.container(e):a.nodeAfter(e)}function M(e){return D(e)?a.container(e):a.nodeBefore(e)}function F(e,n,t){var s=a.commonContainer(e,n),u=o.fromBoundary(s,e).reverse(),l=o.fromBoundary(s,n),d=a.container(e),c=r.children(d);return t(c.slice(u[0],d===s?l[0]:c.length)),u.slice(1,-1).reduce(function(e,n){var o=r.children(e);return t(o.slice(n+1,o.length)),e.parentNode},d.parentNode),u.length>1&&t(r.children(s).slice(i.last(u)+1,l[0])),l.slice(1).reduce(function(e,n){var o=r.children(e);return t(o.slice(0,n)),o[n]},r.children(s)[l[0]]),[e,n]}var U={A:!0,ABBR:!0,B:!0,CITE:!0,CODE:!0,DEL:!0,EM:!0,I:!0,INS:!0,S:!0,SMALL:!0,SPAN:!0,STRONG:!0,SUB:!0,SUP:!0,U:!0,"#text":!0},W=s.ZERO_WIDTH_CHARACTERS.join(""),G=i.difference(s.WHITE_SPACE_CHARACTERS,s.NON_BREAKING_SPACE_CHARACTERS).join(""),z=new RegExp("["+G+"]+["+W+"]*$"),V=new RegExp("[^"+G+"]["+G+W+"]*$"),q=new RegExp("[^"+G+W+"]"),Y=new RegExp("[^"+W+"]"),K={nextCharacter:p,stepBoundary:S,expand:E,adjacentNode:a.nodeAfter,nodeAt:a.nextNode,followingSibling:function(e){return e.nextSibling},stepVisualBoundary:function(e){return A(a.raw(e,0))}},j={nextCharacter:m,stepBoundary:T,expand:N,adjacentNode:a.nodeBefore,nodeAt:a.prevNode,followingSibling:function(e){return e.previousSibling},stepVisualBoundary:function(e){return _(a.raw(e,r.nodeLength(e)))}};return{prev:k,next:B,prevNode:M,nextNode:H,prevSignificantOffset:c,nextSignificantOffset:f,prevSignificantBoundary:C,nextSignificantBoundary:x,stepForward:S,stepBackward:T,isAtStart:P,isAtEnd:D,isBoundariesEqual:R,expandBackward:N,expandForward:E,walkBetween:F}}),define("aloha/mutation",["./dom","./boundaries","./html/traversing"],function(e,n,t){function r(e,n){return n>0&&n<e.nodeValue.length}function o(e,n){if(!r(e,n))return e;var t=e.parentNode,o=e.nodeValue,i=t.ownerDocument,a=i.createTextNode(o.substring(0,n)),s=i.createTextNode(o.substring(n,o.length));return t.insertBefore(a,e),t.insertBefore(s,e),t.removeChild(e),a}function i(n,t,r,o){var i=n[0],a=n[1];if(i===t)r>=a||!r?i=o:(i=o.nextSibling,a-=r);else if(i===o.parentNode){var s=e.nodeIndex(o);a>s&&(a+=1)}return[i,a]}function a(e,n,t,r,o,i,a,s){var u=e[0],l=e[1];return u===n?(u=r,l+=s?o:0):u===r?l+=s?0:t:u===i&&(l===a?(u=r,l=s?o:0):s||l!==a+1?l>a&&(l-=1):(u=r,l=t)),[u,l]}function s(n,t,r,o){var i=n[0],a=n[1];return i===t||e.contains(t,i)?(i=r,a=o):i===r&&a>o&&(a-=1),[i,a]}function u(e,n,t,r,o){var i=e[0],a=e[1];return n===i&&(o?a>=t:a>t)&&(e=[i,a+r]),e}function l(t,r,o,i,a){t=n.normalize(t);var s=t[0],l=t[1];if(!e.isTextNode(s)){var d=l<e.numChildren(s)?e.nthChild(s,l):null,c=l>0?e.nthChild(s,l-1):null;d===r?t=[d,0]:c===r&&(t=[c,e.nodeLength(c)])}return n.normalize(u(t,r,o,i,a))}function d(t,r,o){return t=n.normalize(t),u(t,r.parentNode,e.nodeIndex(r),1,o)}function c(e,n){var t=Array.prototype.slice.call(arguments,2);return n.map(function(n){return e.apply(null,[n].concat(t))})}function f(t,a){var s=t[0],u=t[1];if(e.isTextNode(s)&&r(s,u)){var l=n.fromRanges(a);l.push(t);var d=o(s,u),f=c(i,l,s,u,d);t=f.pop(),n.setRanges(a,f)}return t}function p(r,o){if(r=n.normalize(r),o&&o(r))return r;if(n.isTextBoundary(r))return p(f(r),o);var i=n.container(r);if(O[i.nodeName])return r;var a=e.cloneShallow(i),s=n.nodeAfter(r);return s&&e.move(e.nodeAndNextSiblings(s),a),e.insertAfter(a,i),p(t.stepForward(r),o)}function m(e){f(n.fromRangeStart(e),[e]),f(n.fromRangeEnd(e),[e])}function h(t,r,o,i){if(!r||!e.isTextNode(r))return t;var s=n.fromRanges(o),u=t.parentNode,l=e.nodeIndex(t),d=t.length,f=r.length;return r.insertData(i?f:0,t.data),u.removeChild(t),s=c(a,s,t,d,r,f,u,l,i),n.setRanges(o,s),r}function v(n,t){e.isTextNode(n)&&(n=h(n,n.previousSibling,t,!0),h(n,n.nextSibling,t,!1))}function g(e,n){v(e,[n])}function N(e,t,r,o,i,a){i.push([e,t]),i=c(l,i,e,t,r,o);var s=i.pop();return n.setRanges(a,i),s}function E(t,r,o,i){o.push([t.parentNode,e.nodeIndex(t)]),o=c(d,o,t,r);var a=o.pop();return n.setRanges(i,o),a}function b(t,r,o,i){var a=n.fromRanges(i);if(!t.length)return r;var s=r[0],u=r[1];if(e.isTextNode(s)&&u<e.nodeLength(s))return s.insertData(u,t),N(s,u,t.length,o,a,i);var l=e.nodeAtOffset(s,u),d=n.isAtEnd(n.raw(s,u));if(e.isTextNode(l))return l.insertData(0,t),N(l,0,t.length,o,a,i);var c=d?l.lastChild:l.previousSibling;if(c&&e.isTextNode(c)){var f=e.nodeLength(c);return c.insertData(f,t),N(c,f,t.length,o,a,i)}var p=l.ownerDocument.createTextNode(t);return e.insert(p,l,d),E(p,o,a,i)}function S(t,r,o,i){var a=n.fromRanges(i);r=f(r,i);var s=n.nextNode(r),u=n.isAtEnd(r);return e.insert(t,s,u),E(t,o,a,i)}function T(t,r){var o=n.fromRanges(r),i=t.parentNode,a=e.nodeIndex(t);i.removeChild(t);var u=c(s,o,t,i,a);n.setRanges(r,u)}function y(e,n){T(e,[n])}function A(e){var t=n.container(e),r=t.ownerDocument.createRange(),o=n.offset(e);return r.setStart(t,o),r.setEnd(t,o),r}function _(e){return n.fromRange(e)[0]}function x(e,n){var t=n.map(A);return T(e,t),t.map(_)}function R(e,n){n.node===e&&(n.node.firstChild?n.next():n.skipNext())}function C(n,t){t.forEach(function(e){R(n,e)}),e.removeShallow(n)}function w(t,r,o){var i=e.replaceShallow(t,r);return o.reduce(function(e,t){return e.concat(i===n.container(t)?[n.create(r,n.offset(t))]:[t])},[])}var O={BODY:!0,HTML:!0,STYLE:!0,SCRIPT:!0,AREA:!0,BASE:!0,BR:!0,COL:!0,COMMAND:!0,EMBED:!0,HR:!0,IMG:!0,INPUT:!0,KEYGEN:!0,LINK:!0,META:!0,PARAM:!0,SOURCE:!0,TRACK:!0,WBR:!0};return{removeNode:x,removePreservingRange:y,removePreservingRanges:T,removeShallowPreservingCursors:C,replaceShallowPreservingBoundaries:w,insertTextAtBoundary:b,insertNodeAtBoundary:S,splitTextNode:o,splitTextContainers:m,joinTextNodeAdjustRange:g,joinTextNode:v,splitBoundary:f,splitBoundaryUntil:p}}),define("aloha/content",["./maps","./arrays"],function(e,n){function t(n){return e.merge({},_,n)}function r(n){return e.merge({},A,n)}function o(e){return n.unique(x.concat(e))}function i(n){return e.merge({},R,n)}function a(e,n){var t;e=e.toUpperCase(),n=n.toUpperCase();var r=N[e];if(!r)return!1;if("string"==typeof r){if(r===n)return!0;if(t=y[n],t&&t[r])return!0}else{if(r[n])return!0;t=y[n];var o;for(o in t)if(t.hasOwnProperty(o)&&r[o])return!0}return!1}var s={CAPTION:!0,COLGROUP:!0,THEAD:!0,TBODY:!0,TFOOT:!0,TR:!0},u={TH:!0,TD:!0},l={OPTION:!0,OPTGROUP:!0},d={_PHRASING_:!0,RT:!0,RP:!0},c={LI:!0,_FLOW_:!0},f={H1:!0,H2:!0,H3:!0,H4:!0,H5:!0,H6:!0},p={FIGCAPTION:!0,_FLOW_:!0},m={LEGEND:!0,_FLOW_:!0},h={DT:!0,DD:!0},v={SUMMARY:!0,_FLOW_:!0},g={_PHRASING_:!0,OPTION:!0},N={A:"_PHRASING_",ABBR:"_PHRASING_",ADDRESS:"_FLOW_",AREA:"_EMPTY_",ARTICLE:"_FLOW_",ASIDE:"_FLOW_",AUDIO:"SOURCE",B:"_PHRASING_",BASE:"_EMPTY_",BDO:"_PHRASING_",BLOCKQUOTE:"_PHRASING_",BODY:"_FLOW_",BR:"_EMPTY_",BUTTON:"_PHRASING_",CANVAS:"_PHRASING_",CAPTION:"_FLOW_",CITE:"_PHRASING_",CODE:"_PHRASING_",COL:"_EMPTY_",COLGROUP:"COL",COMMAND:"_EMPTY_",DATALIST:g,DD:"_FLOW_",DEL:"_PHRASING_",DIV:"_FLOW_",DETAILS:v,DFN:"_FLOW_",DL:h,DT:"_PHRASING_",EM:"_PHRASING_",EMBED:"_EMPTY_",FIELDSET:m,FIGCAPTION:"_FLOW_",FIGURE:p,FONT:"_PHRASING_",FOOTER:"_FLOW_",FORM:"_FLOW_",H1:"_PHRASING_",H2:"_PHRASING_",H3:"_PHRASING_",H4:"_PHRASING_",H5:"_PHRASING_",H6:"_PHRASING_",HEAD:"_META_DATA_",HEADER:"_FLOW_",HGROUP:f,HR:"_EMPTY_",I:"_PHRASING_",IFRAME:"#TEXT",IMG:"_EMPTY_",INPUT:"_EMPTY_",INS:"_PHRASING_",KBD:"_PHRASING_",KEYGEN:"_EMPTY_",LABEL:"_PHRASING_",LEGEND:"_PHRASING_",LI:"_FLOW_",LINK:"_EMPTY_",MAP:"AREA",MARK:"_PHRASING_",MENU:c,META:"_EMPTY_",METER:"_PHRASING_",NAV:"_FLOW_",NOSCRIPT:"_PHRASING_",OBJECT:"PARAM",OL:"LI",OPTGROUP:"OPTION",OPTION:"#TEXT",OUTPUT:"_PHRASING_",P:"_PHRASING_",PARAM:"_EMPTY_",PRE:"_PHRASING_",PROGRESS:"_PHRASING_",Q:"_PHRASING_",RP:"_PHRASING_",RT:"_PHRASING_",RUBY:d,S:"_PHRASING_",SAMP:"pharsing",SCRIPT:"#script",SECTION:"_FLOW_",SELECT:l,SMALL:"_PHRASING_",SOURCE:"_EMPTY_",SPAN:"_PHRASING_",STRONG:"_PHRASING_",STYLE:"_PHRASING_",SUB:"_PHRASING_",SUMMARY:"_PHRASING_",SUP:"_PHRASING_",TABLE:s,TBODY:"TR",TD:"_FLOW_",TEXTAREA:"#TEXT",TFOOT:"TR",TH:"_PHRASING_",THEAD:"TR",TIME:"_PHRASING_",TITLE:"#TEXT",TR:u,TRACK:"_EMPTY_",U:"_PHRASING_",UL:"LI",VAR:"_PHRASING_",VIDEO:"SOURCE",WBR:"_EMPTY_","#DOCUMENT-FRAGMENT":"_FLOW_"},E={_FLOW_:!0,_PHRASING_:!0},b={_FLOW_:!0,_PHRASING_:!0},S={_FLOW_:!0,_HEADER_:!0},T={_FLOW_:!0},y={A:{_FLOW_:!0,_INTERACTIVE_:!0,_PHRASING_:!0},ABBR:E,ADDRESS:T,AREA:E,ARTICLE:b,ASIDE:b,AUDIO:{_EMBEDDED_:!0,_FLOW_:!0,_INTERACTIVE_:!0,_PHRASING_:!0},B:E,BASE:{_META_DATA_:!0},BDI:E,BDO:E,BLOCKQUOTE:{_FLOW_:!0,_SECTIONING_ROOT_:!0},BODY:{_SECTIONING_ROOT_:!0},BR:E,BUTTON:{_EMBEDDED_:!0,_FLOW_:!0,_INTERACTIVE_:!0,_PHRASING_:!0,_LISTED_:!0,_LABELABLE_:!0,_SUBMITTABLE_:!0,_REASSOCIATABLE_:!0,_FORM_ASSOCIATED_:!0},CANVAS:{_EMBEDDED_:!0,_FLOW_:!0,_PHRASING_:!0},CAPTION:{},CITE:E,CODE:E,COL:{},COLGROUP:{},COMMAND:{},DATALIST:E,DD:{},DEL:E,DETAILS:{_FLOW_:!0,_SECTIONING_ROOT_:!0,_INTERACTIVE_:!0},DFN:E,DIV:T,DL:T,DT:{},EM:E,EMBED:{_EMBEDDED_:!0,_FLOW_:!0,_INTERACTIVE_:!0,_PHRASING_:!0},FIELDSET:{_FLOW_:!0,_FORM_ASSOCIATED_:!0,_LISTED_:!0,_REASSOCIATABLE_:!0,_SECTIONING_ROOT_:!0},FIGCAPTION:{},FIGURE:{_FLOW_:!0,_SECTIONING_ROOT_:!0},FONT:E,FOOTER:T,FORM:T,H1:S,H2:S,H3:S,H4:S,H5:S,H6:S,HEADER:T,HGROUP:S,HR:T,I:E,IFRAME:{_EMBEDDED_:!0,_FLOW_:!0,_INTERACTIVE_:!0,_PHRASING_:!0},IMG:{_EMBEDDED_:!0,_FLOW_:!0,_FORM_ASSOCIATED_:!0,_INTERACTIVE_:!0,_PHRASING_:!0},INPUT:{_FLOW_:!0,_FORM_ASSOCIATED_:!0,_INTERACTIVE_:!0,_LABELABLE_:!0,_LISTED_:!0,_PHRASING_:!0,_REASSOCIATABLE_:!0,_RESETTABLE_:!0,_SUBMITTABLE_:!0},INS:E,KBD:E,KEYGEN:{_FLOW_:!0,_FORM_ASSOCIATED_:!0,_INTERACTIVE_:!0,_LABELABLE_:!0,_LISTED_:!0,_PHRASING_:!0,_REASSOCIATABLE_:!0,_RESETTABLE_:!0,_SUBMITTABLE_:!0},LABEL:{_FLOW_:!0,_FORM_ASSOCIATED_:!0,_INTERACTIVE_:!0,_PHRASING_:!0,_REASSOCIATABLE_:!0},LEGEND:{},LI:{},LINK:{_FLOW_:!0,_METADATA_:!0,_PHRASING_:!0},MAIN:T,MAP:E,MARK:E,MENU:T,MENUITEM:T,META:{_FLOW_:!0,_METADATA_:!0,_PHRASING_:!0},METER:{_FLOW_:!0,_LABELABLE_:!0,_PHRASING_:!0},NAV:{_FLOW_:!0,_SECTIONING_:!0},NOSCRIPT:{_FLOW_:!0,_METADATA_:!0,_PHRASING_:!0},OBJECT:{_FLOW_:!0,_EMBEDDABLE_:!0,_FORM_ASSOCIATED_:!0,_INTERACTIVE_:!0,_LISTED_:!0,_PHRASING_:!0,_REASSOCIATABLE_:!0,_SUBMITTABLE_:!0},OL:T,OPTGROUP:{},OPTION:{},OUTPUT:{_FLOW_:!0,_PHRASING_:!0,_LISTED_:!0,_LABELABLE_:!0,_RESETTALBE_:!0,_REASSOCIATABLE_:!0,_FORM_ASSOCIATED_:!0},P:T,PARAM:{},PRE:T,PROGRESS:{_FLOW_:!0,_PHRASING_:!0,_LABELABLE_:!0},Q:E,RP:{},RT:{},RUBY:E,S:E,SAMP:E,SCRIPT:{_FLOW_:!0,_PHRASING_:!0,_METADATA_:!0,_SCRIPT_SUPPORTING_:!0},SECTION:{_FLOW_:!0,_SECTIONING_:!0},SELECT:{_FLOW_:!0,_PHRASING_:!0,_INTERACTIVE_:!0,_LISTED_:!0,_LABELABLE_:!0,_SUBMITTALBE_:!0,_RESETTALBE_:!0,_REASSOCIATABLE_:!0,_FORM_ASSOCIATED_:!0},SMALL:E,SOURCE:{},SPAN:E,STRONG:E,STYLE:{_FLOW_:!0,_METADATA_:!0},SUB:E,SUMMARY:{},SUP:E,TABLE:T,TBODY:{},TD:{_SECTIONING_ROOT_:!0},TEMPLATE:{_FLOW_:!0,_METADATA_:!0,_PHRASING_:!0,_SCRIPT_SUPPORTING_:!0},TEXTAREA:{_FLOW_:!0,_PHRASING_:!0,_INTERACTIVE_:!0,_LISTED_:!0,_LABELABLE_:!0,_SUBMITTALBE_:!0,_RESETTALBE_:!0,_REASSOCIATABLE_:!0,_FORM_ASSOCIATED_:!0},TFOOT:{},TH:{},THEAD:{},TIME:E,TITLE:{_METADATA_:!0},TR:{},TRACK:{},U:E,UL:T,VAR:E,VIDEO:{_FLOW_:!0,_PHRASING_:!0,_EMBEDDED_:!0,_INTERACTIVE_:!0},WBR:E,"#TEXT":E},A={IMG:["alt","src"],A:["href","name","_target"],TD:["colspan","rowspan"],TH:["colspan","rowspan"],OL:["start","type"],"*":["xstyle"]},_={TABLE:["width"],IMG:["width","height"],"*":["color","font-family","font-size","font-weight","font-stlye","font-decoration","background","background-image","background-color"]},x=["AUDIO","COMMAND","COLGROUP","IFRAME","INPUT","INS","KBD","KEYGEN","LINK","META","NOSCRIPT","OUTPUT","Q","RUBY","SAMP","SCRIPT","SELECT","STYLE","TEMPLATE","TEXTAREA","TITLE","WBR"],R={FONT:"SPAN"};return{allowsNesting:a,allowedStyles:t,allowedAttributes:r,disallowedNodes:o,nodeTranslations:i}}),define("aloha/html/mutation",["./elements","./styles","./traversing","./predicates","../dom","../mutation","../arrays","../content","../boundaries","../functions","../browsers"],function(e,n,t,r,o,i,a,s,u,l,d){function c(e){return o.upWhile(e,l.complement(o.isContentEditable))}function f(n){!r.isBlockNode(n)||d.msie&&c(n)||n.firstChild&&o.nextWhile(n.firstChild,e.isUnrenderedWhitespace)||o.insert(n.ownerDocument.createElement("br"),n,!0)}function p(e,t){return u.nextWhile(e,function(e){return u.equals(e,t)?!1:n.hasLinebreakingStyle(u.nextNode(e))?!1:u.isAtEnd(e)?!o.isEditingHost(u.container(e)):!0})}function m(n,t){var i=!1;return u.prevWhile(t,function(t){if(u.equals(n,t))return i=!0,!1;if(u.offset(t)>0){var a=o.nodeAtOffset(u.container(t),u.offset(t)-1);if((o.isTextNode(a)||r.isVoidNode(a))&&e.isRendered(a))return i=!1,!1}return!0}),i}function h(n){if(o.isTextNode(n))return e.isRendered(n);var t=o.children(n).filter(function(n){return r.isListItem(n)||e.isRendered(n)});return t.length>0}function v(t,a){if(!m(t,a))return[t,a];var s=u.nextNode(a),l=u.container(t),d=p(t,a),c=function(n){return l===n?!0:e.isProppingBr(n)?!1:r.isListItem(n)?h(n):e.isRendered(n)};if(u.equals(d,a))return o.climbUntil(s,o.remove,c),[t,t];var f=s.parentNode,v=o.nodeAndNextSiblings(s,n.hasLinebreakingStyle);return 0===v.length&&(f=s),v.reduce(function(e,n){return i.insertNodeAtBoundary(n,e,!0)},d),f&&o.climbUntil(f,o.remove,c),[t,t]}function g(i){if("BR"!==i.nodeName)return!1;var a=function(n){return"BR"!==n.nodeName&&e.isUnrendered(n)},s=i.previousSibling&&o.prevWhile(i.previousSibling,a),l=i.nextSibling&&o.nextWhile(i.nextSibling,a);if(s&&l&&r.isInlineNode(i.parentNode))return!0;if(!(!s||"BR"!==s.nodeName&&n.hasLinebreakingStyle(s)||!l||"BR"!==l.nodeName&&n.hasLinebreakingStyle(l)))return!0;if(s&&"BR"===s.nodeName||l&&"BR"===l.nodeName)return!0;for(var d=u.fromFrontOfNode(i);t.isAtStart(d);){if(n.hasLinebreakingStyle(u.container(d)))return!0;d=u.prev(d)}for(d=u.jumpOver(u.fromFrontOfNode(i));t.isAtEnd(d);){if(n.hasLinebreakingStyle(u.container(d)))return!1;d=u.next(d)}return!n.hasLinebreakingStyle(t.nextNode(d))}function N(e){var n=u.container(e).ownerDocument,t=n.createElement("br");return e=i.insertNodeAtBoundary(t,e,!0),g(t)?e:i.insertNodeAtBoundary(n.createElement("br"),e)}function E(e,n){var t=u.container(e);if(!s.allowsNesting(t.nodeName,n))return N(e);var r=t.ownerDocument.createElement(n);return i.insertNodeAtBoundary(r,e),u.create(r,0)}function b(t){return!e.isVoidType(t)&&(n.hasLinebreakingStyle(t)||o.isEditingHost(t))}function S(e){return i.splitBoundaryUntil(e,function(e){return b(u.container(e))})}function T(t,r){return o.climbUntil(u.container(t),function(e){r=i.removeNode(e,r)},function(t){return n.hasLinebreakingStyle(t)||o.isEditingHost(t)||e.isRendered(t)}),r}function y(e){var n=u.nodeBefore(e),t=u.nodeAfter(e);return n&&g(n)?n:t&&g(t)?t:null}function A(e){var n=o.prevSiblings(e).filter(r.isListItem),t=o.nextSiblings(e).filter(r.isListItem),i=e.parentNode;if(n.length>0){var a=o.cloneShallow(i);o.moveBefore([a],i),o.move(n,a)}if(t.length>0){var s=o.cloneShallow(i);o.moveAfter([s],i),o.move(t,s)}}function _(t){A(t),o.removeShallow(t.parentNode);for(var r,i,s=t.ownerDocument,u=o.children(t).filter(e.isRendered),l=[];u.length>0;)n.hasLinebreakingStyle(u[0])?l.push(u.shift()):(r=a.split(u,n.hasLinebreakingStyle),i=s.createElement("p"),o.move(r[0],i),l.push(i),u=r[1]);return o.moveAfter(l,t),o.remove(t),l}function x(n,t){A(n);var a=n.ownerDocument,s=n.parentNode;if(!r.isListItem(s.parentNode)){var l=a.createElement(t);return o.removeShallow(s),o.replaceShallow(n,l),f(l),u.create(l,0)}var d=i.splitBoundaryUntil(u.fromFrontOfNode(s),function(e){return r.isListContainer(u.container(e))});o.remove(s);var c=u.nextNode(d);return o.children(c).filter(e.isRendered).length?(n=a.createElement("li"),f(n),i.insertNodeAtBoundary(n,d,!0),u.create(n,0)):u.create(c,0)}function R(n,t){var a=y(n);a&&(n=i.insertNodeAtBoundary(a.ownerDocument.createElement("br"),n,!0));var s=u.container(n);if(r.isListItem(s)&&!s.firstChild)return x(s,t);var l=S(n),d=u.nodeAfter(l),c=d?o.nodeAndNextSiblings(d):[];if(s=u.container(l),d&&b(d))l=E(l,t);else if(o.isEditingHost(s)){l=E(l,t);var p=u.container(l),m=o.move(c,p,b);o.moveAfter(m,p)}else l=i.splitBoundaryUntil(l,function(e){return u.container(e)===s.parentNode});var h=u.prevWhile(l,function(n){var t=u.prevNode(n);return!(u.isAtStart(n)||e.isVoidType(t)||o.isTextNode(t))}),v=u.nextWhile(l,function(n){var t=u.nextNode(n);return!(u.isAtEnd(n)||e.isVoidType(t)||o.isTextNode(t))}),N=[h,v];N=T(N[0],N),N=T(N[1],N),s=u.container(N[1]),!s.firstChild&&r.isHeading(s)&&(N=i.replaceShallowPreservingBoundaries(s,s.ownerDocument.createElement(t),N)),h=N[0],v=N[1],f(u.container(h)),f(u.container(v));var A=u.nodeAfter(v),_=A&&o.nextWhile(A,function(n){return!g(n)&&e.isUnrendered(n)});return _&&b(_)?i.insertNodeAtBoundary(_.ownerDocument.createElement("br"),v):v}return{prop:f,removeBreak:v,insertBreak:R,insertLineBreak:N,nextLineBreak:p,isRenderedBr:g,isVisuallyAdjacent:m,unwrapListItem:_,separateListItem:A}}),define("aloha/html",["./html/styles","./html/elements","./html/mutation","./html/traversing","./html/predicates","./browsers","./cursors"],function(e,n,t,r,o){return{isRendered:n.isRendered,isUnrendered:n.isUnrendered,isUnrenderedWhitespace:n.isUnrenderedWhitespace,parse:n.parse,isVoidType:n.isVoidType,isStyleInherited:e.isStyleInherited,isWhiteSpacePreserveStyle:e.isWhiteSpacePreserveStyle,hasBlockStyle:e.hasBlockStyle,hasInlineStyle:e.hasInlineStyle,hasLinebreakingStyle:e.hasLinebreakingStyle,prop:t.prop,insertBreak:t.insertBreak,removeBreak:t.removeBreak,insertLineBreak:t.insertLineBreak,isRenderedBr:t.isRenderedBr,nextLineBreak:t.nextLineBreak,isVisuallyAdjacent:t.isVisuallyAdjacent,prev:r.prev,next:r.next,prevNode:r.prevNode,nextNode:r.nextNode,prevSignificantOffset:r.prevSignificantOffset,nextSignificantOffset:r.nextSignificantOffset,prevSignificantBoundary:r.prevSignificantBoundary,nextSignificantBoundary:r.nextSignificantBoundary,isAtStart:r.isAtStart,isAtEnd:r.isAtEnd,isBoundariesEqual:r.isBoundariesEqual,expandBackward:r.expandBackward,expandForward:r.expandForward,stepForward:r.stepForward,stepBackward:r.stepBackward,walkBetween:r.walkBetween,isBlockNode:o.isBlockNode,isGroupContainer:o.isGroupContainer,isGroupedElement:o.isGroupedElement,isHeading:o.isHeading,isInlineNode:o.isInlineNode,isListContainer:o.isListContainer,isListItem:o.isListItem,isTableContainer:o.isTableContainer,isTextLevelSemanticNode:o.isTextLevelSemanticNode,isVoidNode:o.isVoidNode}}),define("aloha/stable-range",["./dom","./arrays","./functions"],function(e,n,t){function r(e){return this instanceof r?(e=e||{},this.startContainer=e.startContainer,this.startOffset=e.startOffset,this.endContainer=e.endContainer,this.endOffset=e.endOffset,this.commonAncestorContainer=e.commonAncestorContainer,void(this.collapsed=e.collapsed)):new r(e)}function o(r,o){var i,a=r;for(i=0;4>i;i++)a=a.parentNode||a;var s=e.childAndParentsUntilInclNode(r,a),u=e.childAndParentsUntilInclNode(o,a);return a!==n.last(u)&&(s=e.childAndParentsUntil(r,t.returnFalse),u=e.childAndParentsUntil(o,t.returnFalse)),n.intersect(s,u)[0]}return r.prototype.update=function(){var e=this.startContainer,n=this.endContainer,t=this.startOffset,r=this.endOffset;e&&n&&(this.collapsed=e===n&&t===r,this.commonAncestorContainer=o(e,n))},r.prototype.setStart=function(e,n){this.startContainer=e,this.startOffset=n,this.update()},r.prototype.setEnd=function(e,n){this.endContainer=e,this.endOffset=n,this.update()},r}),define("aloha/accessor",["./functions","./assert"],function(e,n){function t(e,t){var r=e.length,o=t.length;return n.assert(r>=1,n.GETTER_AT_LEAST_1_ARG),n.assert(o>=2,n.SETTER_1_MORE_THAN_GETTER),n.assert(r===o-1,n.SETTER_1_MORE_THAN_GETTER),r}function r(e,n,t){return function(){return arguments.length-t>0?n.apply(null,arguments):e.apply(null,arguments)}}function o(e,n){var o=t(e,n),i=1===o?function(t,r){return arguments.length>1?n(t,r):e(t)}:2===o?function(t,r,o){return arguments.length>2?n(t,r,o):e(t,r)}:r(e,n,o);return i.get=e,i.set=n,i}function i(n){var o=n.get,i=n.set,a=t(o,i),s=1===a?function(e){return arguments.length?i(this,e):o(this)}:2===a?function(e,n){return arguments.length>1?i(this,e,n):o(this,e)}:e.asMethod(r(o,i,a));return s.get=o,s.set=i,s}function a(e){return o(function(n){return n[e]},function(n,t){return n[e]=t,n})}function s(e){for(var t in e)if(e.hasOwnProperty(t))return a(t);n.error(n.MISSING_SYMBOL)}return o.fromString=a,o.fromSymbol=s,o.asMethod=i,o}),define("aloha/record",["./functions","./maps","./accessor","./assert"],function(e,n,t,r){function o(e,n){var t=e._record_values,r=t.length;return r<n.length&&(t=t.concat(n.slice(r)),e._record_values=t),t}function i(e,n){var t=e.constructor;return new t(n,I)}function a(e){return i(e,e._record_values.slice(0))}function s(e,n){r.assert(!n||e.constructor===n,r.RECORD_WRONG_TYPE);var t=e._record_transience;r.assert(t===C||t===O,r.READ_FROM_DISCARDED_TRANSIENT)}function u(e,n){r.assert(!n||e.constructor===n,r.RECORD_WRONG_TYPE),r.assert(e._record_transience===C,r.PERSISTENT_WRITE_TO_TRANSIENT)}function l(e,n){r.assert(!n||e.constructor===n,r.RECORD_WRONG_TYPE),r.assert(e._record_transience===O,r.TRANSIENT_WRITE_TO_PERSISTENT)}function d(e){return l(e),e._record_transience=w,i(e,e._record_values)}function c(e){var n=d(e);return n._record_transience=O,n}function f(e){s(e);var n=a(e);return n._record_transience=O,n}function p(e,n,t){var r=o(e,t);return r[n]}function m(e,n,t,r){var i=a(e),s=o(i,r);return s[t]=n,i}function h(e,n,t,r){var i=c(e),a=o(i,r);return a[t]=n,i}function v(e){return Array.isArray(e)&&e[0]===I}function g(e){var n;return e.length>3?n=e[3]:(n=e[1](e[2]),e[3]=n),n}function N(e,n){function r(n){s(n,e);var t=p(n,c,d);if(v(t)){t=g(t);var r=o(n,d);r[c]=t}return t}function i(n,t){return u(n,e),m(n,t,c,d)}function a(n,t){return l(n,e),h(n,t,c,d)}var d=e._record_defaults,c=e._record_defaults.length;
return d.push(n),i.setT=a,t(r,i)}function E(e,n,t){return n.set(e,t)}function b(e,n){return n.get(e)}function S(e,n,t){return n.set.setT(e,t)}function T(e,n,t,r){return E(e,n,[I,t,r])}function y(e,n,t,r){return S(e,n,[I,t,r])}function A(e,r){n.forEach(r,function(n,r){var o=N(e,n);e.prototype[r]=t.asMethod(o)})}function _(n,t){function r(e,n){return n!==I?t(new r(o,I),e):(this._record_values=e,void(this._record_transience=C))}e.is(n)&&(t=n,n=null),t=t||e.identity;var o=[];return e.extendType(r,{asTransient:f,asPersistent:d,get:b,set:E,setT:S,delay:T,delayT:y}),r.addField=e.partial(N,r),r.extend=e.partial(A,r),r._record_defaults=o,n&&A(r,n),r}function x(e,n,r){var o=e.set,i=o.setT;r=r||function(e){return n(e.asPersistent()).asTransient()};var a=t(e.get,function(e,t){return e=o(e,t),e=n(e)});return a.set.setT=function(e,n){return e=i(e,n),e=r(e)},a}function R(e,n,t,r){return x(e,function(e){return n.set(e,t(e))},r?function(e){return n.set.setT(e,r(e))}:null)}var C=0,w=1,O=2,I={};return{define:_,hookSetter:x,hookSetterRecompute:R}}),define("aloha/delayed-map",["./functions","./maps","./assert"],function(e,n,t){function r(e,n,t){return t!==S?new r(e,n,S):(this._map_data=null,this._map_source=n,this._map_opts=e,void(this._map_realized=v))}function o(e){var n=e._map_data=e._map_data||{};return n}function i(e){var n=e._map_realized;if(n&N)return e._map_data;var t=e._map_opts,r=t.realize(e._map_source);return e._map_data=r,e._map_realized=n|g|N,e._map_source=null,r}function a(e){return!!(e._map_realized&N)}function s(e){var t=o(e),r=e._map_realized;if(r&g)return n.keys(t).filter(function(e){return t[e]!==b});var a,s=e._map_opts;return s.keys?(a=s.keys(e._map_source),a.forEach(function(e){t.hasOwnProperty(e)||(t[e]=E)}),e._map_realized=r|g):a=n.keys(i(e)),a}function u(e,n,t){var r=o(e);if(r.hasOwnProperty(n))return r[n];if(e._map_realized&g)return b;var i=r[n]=t(e,n);return i}function l(e,n){var t=e._map_opts,r=!1;return r=t.has?t.has(e._map_source,n):b!==u(e,n,d),r?E:b}function d(e,n){var t=e._map_opts;return t.get(e._map_source,n,b)}function c(e,n){return b!==u(e,n,l)}function f(e,n,r){var i=u(e,n,d);if(b===i)i=r;else if(E===i){var a=o(e);i=a[n]=d(e,n),t.asserT(i!==b)}return i}function p(e){var n=r(T,e);return n.realize(),n}function m(e,n){return function(t,r,o){var i=e(t,r);return n(i)?o:i}}function h(e,t,o){return!o||e._map_opts!==y||e._map_realized&N||(t=n.merge(e._map_source.obj,t),e=e._map_source.map),r(y,{map:e,obj:t})}var v=0,g=1,N=2,E={},b={},S={},T={realize:e.identity,get:t.error},y={realize:function(e){return n.merge(e.map.realize(),e.obj)},get:function(e,n,t){var r=e.map,o=e.obj;return o.hasOwnProperty(n)?o[n]:r.get(n,t)}};return e.extendType(r,{keys:s,realize:i,isRealized:a,get:f,has:c,mergeObject:h}),r.realized=p,r.makeGetWithDefault=m,r}),define("aloha/boromir",["./functions","./maps","./accessor","./record","./delayed-map","./dom","./strings","./assert"],function(e,n,t,r,o,i,a,s){function u(){return++$}function l(e){return e.nodeType}function d(e){for(var n=e.childNodes,t=[],r=0,o=n.length;o>r;r++)t.push(Nn(n[r]));return t}function c(e){return e.nodeName}function f(e){return e.data}function p(e,n){var t=o(vn,n),r=o(gn,n);e=e.setT(e.domNode,n),e=e.delayT(e.type,l,n),e=e.delayT(e.name,c,n),e=e.delayT(e.text,f,n),e=e.delayT(e.children,d,n),e=e.setT(Tn,t),e=e.setT(yn,r);var i=e.asPersistent();return e=i.asTransient().delayT(En,Y,i)}function m(e,n){s.assertNou(n.name),s.assertNou(n.nodeType);var t=n.affinity||an;return e=e.setT(e.domNode,n.domNode),e=e.setT(e.type,hn),e=e.setT(e.text,n.text),e=e.setT(e.affinity,t)}function h(n,t){s.assertNou(t.text),s.assertNou(t.nodeType);var r=t.name,i=t.attrs||{},a=t.styles||{},u=t.children||[],l=t.affinity||an;return s.assert(e.isNou(i.style),s.STYLE_NOT_AS_ATTR),n=n.setT(n.domNode,t.domNode),n=n.setT(n.type,mn),n=n.setT(n.name,r),n=n.setT(n.children,u),n=n.setT(n.affinity,l),n=n.setT(Tn,o.realized(i)),n=n.setT(yn,o.realized(a))}function v(n,t){return t?(t.nodeType?n=p(n,t):e.isNou(t.text)?e.isNou(t.name)?s.error(s.INVALID_ARGUMENT):n=h(n,t):n=m(n,t),n):n}function g(e,n,t){var r=xn.get(e);return r&sn&&n!==(r&n)&&(r|=n,e=t(e,r)),e}function N(e,n){return r.hookSetter(e,function(e){return g(e,n,xn.set)},function(e){return g(e,n,xn.set.setT)})}function E(e){s.assert(mn===e.type.get(e),s.EXPECT_ELEMENT)}function b(e,n,t,r){var o=e.get(t);if(o&&o.hasOwnProperty(r))return o[r];var i=n.get(t);return i.get(r)}function S(e,t,r,o,i){var a=e.get(r);return a=n.cloneSet(a||{},o,i),r=r.asTransient(),r=r.setT(e,a),r=g(r,t,xn.set.setT),r.asPersistent()}function T(e,n){return E(e),s.assert("style"!==n,s.STYLE_NOT_AS_ATTR),b(An,Tn,e,n)}function y(e){return n.fillKeys({},a.words(e),!0)}function A(e,n,t){return E(e),s.assert("style"!==n,s.STYLE_NOT_AS_ATTR),e=S(An,dn,e,n,t),"class"===n&&(e=K(e)),e}function _(e,n){return E(e),b(_n,yn,e,n)}function x(e,n,t){return E(e),S(_n,cn,e,n,t)}function R(t){E(t);var r=Tn.get(t),o=An.get(t),i=r.realize();return i=n.extend({},i,o),i=n.filter(i,e.complement(e.isNou)),delete i.style,i}function C(t,r){E(t),s.assert(e.isNou(r.style),s.STYLE_NOT_AS_ATTR);var o=Tn.get(t),i=n.fillKeys({},o.keys(),null),a=n.extend(i,r);return delete a.style,t=t.asTransient(),t=g(t,dn,xn.set.setT),t=t.setT(An,a),t.asPersistent()}function w(e,n,t,r){var o=bn.get(e);return o=n.set(o,t),r(e,o)}function O(e,n){var t=bn.get(e);return n.get(t)}function I(){s.notImplemented()}function L(e){var n=e.text.get(e),t=e.domNode.get(e);return t.data=n,w(e,e.text,n,bn.set)}function B(e,t,r){n.forEach(t,function(n,t){r(e,t,n)})}function k(e,n,t,r){var o=e.get(r);if(!o)return r;var i=r.domNode.get(r);B(i,o,t);var a=n.get(r).mergeObject(o,!0);return r=r.asTransient(),r=r.setT(e,null),r=r.setT(n,a),r.asPersistent()}function D(e,n){var t=e.name.get(e),r=e.attrs.get(e),o=n.createElement(t);B(o,r,i.setAttr);var a=Tn.get(e);i.setAttr(o,"style",a.get("style"));var s=_n.get(e);return B(o,s,i.setStyle),o}function P(e,n){return n.createTextNode(e.text.get(e))}function H(e,n){var t=e.type.get(e);return mn===t?D(e,n):hn===t?P(e,n):void s.notImplemented()}function M(e,n,t,r,o,i){var a=r<n.length?n[r]:null,s=H(t,o);return e.insertBefore(s,a),t=t.asTransient(),t=t.setT(t.domNode,s),t=t.setT(Sn,u()),t=w(t,t.children,[],bn.set.setT),t=t.setT(xn,xn.get(t)|fn),t=t.asPersistent(),t=z(t,o,i)}function F(e,n,t){e.removeChild(n[t])}function U(e,n,t){return e.forEach(function(e){n[Sn.get(e)]=t}),n}function W(e,n){if(n===e)return null;for(var t,r,o=null,i=0,a=0,s=e.length,u=n.length,l=[],d=!1;s>i&&u>a;){t=e[i],r=n[a];var c,f=Sn.get(t),p=Sn.get(r);f===p?(t===r?c=J:(d=!0,c=tn),i+=1,a+=1):(o=o||U(n,{},!0),o[f]?(d=!0,c=en,a+=1):(d=!0,c=nn,i+=1)),l.push(c)}for(;s>i;i++)t=e[i],d=!0,l.push(nn);for(;u>a;a++)r=n[a],d=!0,l.push(en);return d?l:null}function G(e,n,t){var r=e.children.get(e),o=O(e,e.children),i=W(o,r);if(!i)return e;var a=e.domNode.get(e),s=a.childNodes,u=[],l=0,d=0,c=0;return i.forEach(function(i){var f;i&en?(f=r[d],d+=1):i&nn?(f=o[l],l+=1):(f=r[d],d+=1,l+=1);var p=f.affinity.get(f),m=O(e,e.affinity);(p&rn)!==(m&rn)?p&rn&&!(i&nn)?(f=M(a,s,f,c,n,t),c+=1):i&en||F(a,s,c):p&rn&&(i&en?(f=M(a,s,f,c,n,t),c+=1):i&nn?F(a,s,c):(i&tn&&(f=z(f,n,t)),c+=1)),i&nn||u.push(f)}),e=e.set(e.children,u),e=w(e,e.children,u,bn.set)}function z(e,n,t){var r=e.type.get(e),o=xn.get(e);return mn===r?(o&un&&(e=I(e)),o&dn&&(e=Rn(e)),o&cn&&(e=Cn(e)),o&fn&&(e=G(e,n,t))):hn===r&&o&ln&&(e=L(e)),e}function V(e){var n=e.domNode.get(e),t=n.ownerDocument;return s.assert(t,s.ELEMENT_NOT_ATTACHED),z(e,t,{})}function q(e,n){var t;return mn===e.type()?(t=D(e,n),e.children().forEach(function(e){t.appendChild(q(e,n))})):hn===e.type()?t=P(e,n):s.notImplemented(),t}function Y(n){var t=T(n,"class");return e.isNou(t)?{}:y(t)}function K(e){return e.set(En,Y(e))}function j(e){var t=n.keys(e.get(e.classes)).join(" ");return S(An,dn,e,"class",t)}function X(e,n){return e.get(e.classes)[n]}function Z(e,t){var r=e.get(e.classes);return r[t]?e:(r=n.cloneSet(r,t,!0),e=e.set(e.classes,r))}function Q(e,t){var r=e.get(e.classes);return r[t]?(r=n.cloneDelete(r,t),e=e.set(e.classes,r)):e}var $=0,J=0,en=1,nn=2,tn=4,rn=1,on=2,an=rn|on,sn=1,un=2,ln=4,dn=8,cn=16,fn=32,pn=64,mn=1,hn=3,vn={realize:i.attrs,get:o.makeGetWithDefault(i.getAttr,e.isNou)},gn={realize:s.notImplemented,get:o.makeGetWithDefault(i.getStyle,e.isNou)},Nn=r.define({domNode:null,type:null,name:null,text:null,classes:{},children:null,affinity:an},function(e,n){var t=e.asTransient();return t=v(t,n),t=t.setT(Sn,u()),t=t.setT(xn,sn),e=t.asPersistent(),e=bn.set(e,e)}),En=Nn.prototype.classes,bn=Nn.addField(),Sn=Nn.addField(),Tn=Nn.addField(),yn=Nn.addField(),An=Nn.addField(),_n=Nn.addField(),xn=Nn.addField(),Rn=e.partial(k,An,Tn,i.setAttr),Cn=e.partial(k,_n,yn,i.setStyle),wn=N(Nn.prototype.name,un),On=N(Nn.prototype.text,ln),In=N(Nn.prototype.children,fn),Ln=N(Nn.prototype.affinity,pn);return n.extend(Nn.prototype,{name:t.asMethod(wn),text:t.asMethod(On),children:t.asMethod(In),affinity:t.asMethod(Ln),attrs:t.asMethod(t(R,C)),attr:t.asMethod(t(T,A)),style:t.asMethod(t(_,x)),updateDom:e.asMethod(V),asDom:e.asMethod(q),create:Nn,hasClass:e.asMethod(X),addClass:e.asMethod(Z),removeClass:e.asMethod(Q)}),Nn.prototype.attrs=t.asMethod(r.hookSetterRecompute(Nn.prototype.attrs,En,Y,Y)),Nn.prototype.classes=t.asMethod(r.hookSetter(En,j,j)),Nn.CHANGE_INSERT=en,Nn.CHANGE_REMOVE=nn,Nn.CHANGE_REF=tn,Nn.CHANGE_NONE=J,Nn.AFFINITY_DOM=rn,Nn.AFFINITY_MODEL=on,Nn.AFFINITY_DEFAULT=an,Nn.childrenChangedInParent=W,Nn.ELEMENT=mn,Nn.TEXT=hn,Nn}),define("aloha/zippers",["./dom","./maps","./html","./paths","./arrays","./record","./boromir","./boundaries","./functions"],function(e,n,t,r,o,i,a,s,u){function l(e){return"#text"===e.name()}function d(e,n){return e=arguments[0],1===arguments.length?l(e)?e.text():e.children():l(e)?e.text(n.join("")):e.children(n)}function c(e,n,t){return{lefts:e,rights:n,frames:t}}function f(e){return o.last(e.frames)}function p(e){return o.last(e.lefts)}function m(e){return e.rights[0]}function h(e,n){return n="number"==typeof n?n:1,0===n?e:c(e.lefts.slice(0,-n),e.lefts.slice(-n).concat(e.rights),e.frames.concat())}function v(e,n){return n="number"==typeof n?n:1,0===n?e:c(e.lefts.concat(e.rights.slice(0,n)),e.rights.slice(n),e.frames.concat())}function g(e){return c([],d(m(e)),e.frames.concat(e))}function N(e){var n=e.lefts.concat(e.rights),t=o.last(e.frames),r=d(m(t),n);return c(t.lefts.concat(),[r].concat(t.rights.slice(1)),e.frames.slice(0,-1))}function E(e){return e.frames.reduce(N,e)}function b(e){return c([],[a(e)],[])}function S(e){return"string"==typeof m(e)}function T(e){return e.reduce(function(e,n){return e+n.text().length},0)}function y(e,n){e=E(e);for(var t,r,o=[];;)if(J(e)){if(e=N(e),Z(e))break;o=o.slice(0,-1),t=n(m(e),o),e=v(F(e,t),t.length)}else Q(e)?(r=G(m(N(e)))?T(e.lefts.filter(l)):e.lefts.length,t=n(m(e),o.concat(r)),e=v(F(e,t),t.length)):(Z(e)||o.push(e.lefts.length),e=g(e));return e}function A(e,n){for(n=n||u.returnTrue,e=E(e);n(e);)if(J(e)){do{if(Z(e))return e;e=N(e)}while(J(e));e=v(e)}else e=Q(e)?v(e):g(e);return e}function _(e){var n=e.children().filter(l).reduce(function(e,n){return e.concat(n.text())},[]).join("");return e.original&&e.original.text()===n?e.original:j("#text",[n])}function x(e){var n=[];e=y(e,function(e,t){return V(e)?(e.marker&&n.push({name:e.marker,path:t}),[]):[G(e)?_(e):e]});var t=m(e).updateDom().domNode();return n.reduce(function(e,n){return e[n.name]=r.toBoundary(t,n.path),e},{})}function R(e){return"string"==typeof e?"“"+e+"”":l(e)?e.text():e.domNode().outerHTML}function C(e){return e.lefts.map(R).concat("▓",e.rights.map(R)).join("")}function w(e,n){return n+e.children().slice(0,n).filter(V).length}function O(e,n){if(0===n)return[0];for(var t,r,o=e.children(),i=o.length,a=n,s=0;i>s;)if(r=o[s],V(r))s++;else{if(t=a-r.text().length,0===t)return[s+1];if(0>t)return[s,a];s++,a=t}throw"Text offset out of bounds"}function I(e,n){return[e.substr(0,n),e.substr(n)]}function L(e,n){var t=I(d(m(e)),n);return c([t[0]],[t[1]],e.frames.concat(e))}function B(e,n){return v(g(e),w(m(e),n))}function k(e,n){var t=m(e),r=O(t,n),o=v(g(e),r[0]);if(1===r.length)return o;var i=I(d(m(o)),r[1]);return v(H(o,1,[d(j("#text"),[i[0]]),d(j("#text"),[i[1]])]))}function D(e,n){for(var t,r=n.concat().reverse();r.length;){for(;V(m(e));)e=v(e);if(t=r.pop(),l(m(e)))return L(e,t);e=G(m(e))?k(e,t):B(e,t)}return e}function P(e,n){for(var t=0;t<e.length;t++)if(n[t]!==e[t])return[];return n.slice(t)}function H(e,n,t){return t=t?t.constructor===a||t.constructor===i?[t]:t:[],c(e.lefts.concat(),t.concat(e.rights.slice(n)),e.frames.concat())}function M(e,n){return H(e,0,n)}function F(e,n){return H(e,1,n)}function U(e){return H(e,1)}function W(e){var n=N(e),t=a(document.createElement("q"));return t.isFragmentedText=!0,t.original=m(n),c([d(j("#text"),e.lefts)],[d(j("#text"),e.rights)],g(F(n,t)).frames.concat())}function G(e){return!0===e.isFragmentedText}function z(e){var n=document.createElement("code");n.innerHTML=++on;var t=a(n);return t.isMarker=!0,t.marker=e,t}function V(e){return!0===e.isMarker}function q(e,t){var r={};return n.forEach(t,function(n,t){var o=K(e,n,t);r[t]=o.marker,e=o.loc}),{loc:e,markers:r}}function Y(e,n){return q(b(e),n)}function K(e,n,t){e=E(e);var o=m(e).domNode(),i=o.ownerDocument.body,a=r.fromBoundary(i,s.fromFrontOfNode(o)),u=r.fromBoundary(i,n),l=P(a,u);if(0===l.length)return{loc:e,marker:null};var d=z(t);return e=D(e,l),e=M(S(e)?W(e):e,d),{loc:e,marker:d}}function j(e,n){var t="#text"===e?document.createTextNode(""):document.createElement(e);return"undefined"==typeof n?a(t):d(a(t),n)}function X(n){return a(e.cloneShallow(n.domNode()))}function Z(e){return 0===e.frames.length}function Q(e){var n=m(e);return"#text"===n.name()||V(n)||t.isVoidNode(n.domNode())}function $(e){return 0===e.lefts.length}function J(e){return 0===e.rights.length}function en(e,n){if(n=n||u.returnFalse,Z(f(e))||n(e))return e;var t,r,o=N(e);return S(e)?(t=j("#text"),r=j("#text")):(t=X(m(o)),r=X(m(o))),t=d(t,e.lefts),r=d(r,e.rights),e=c(o.lefts.concat(t),[r].concat(o.rights.slice(1)),o.frames.concat()),en(e,n)}function nn(e,n){return e=A(E(e),function(e){var t=m(e);return!(t&&V(t)&&t===n)}),Z(e)?null:e}function tn(e,n,t){return en(nn(e,n),t)}function rn(e,n,t){return M(nn(e,n),t)}var on=0;return{go:nn,hint:C,update:x,before:p,after:m,prev:h,next:v,up:N,down:g,root:E,peek:f,split:en,splice:H,insert:M,replace:F,remove:U,zipper:Y,isAtStart:$,isAtEnd:J,splitAt:tn,insertAt:rn,isMarker:V,createMarker:z}}),define("aloha/lists",["./functions","./dom","./html","./arrays","./assert","./boromir","./zippers","./strings","./content","./mutation","./boundaries"],function(e,n,t,r,o,i,a,s,u,l,d){function c(e){return!(t.hasLinebreakingStyle(e)||e.parentNode&&n.isEditingHost(e.parentNode))}function f(e,r){e=e.concat();var o=r.filter(t.isRendered);if(o.length>0){var i=o[0].ownerDocument.createElement("li");n.move(o,i),e.push(i)}return e}function p(e){var r=[];n.climbUntil(e,function(e){r=l.removeNode(e,r)},function(e){return t.isListItem(e)&&0===n.children(e).length?!1:!e.parentNode||n.isEditingHost(e)||t.isRendered(e)})}function m(e){return!t.isListItem(e)&&t.hasLinebreakingStyle(e)}function h(e,t){var r=n.prevSiblings(e,m).concat(e);return e!==t&&(r=r.concat(n.nextSiblings(e,function(e){return e===t}),t)),r.concat(n.nextSiblings(t,m))}function v(e){for(var o,i,a,s=[],u=[],l=e.concat();l.length>0;){a=l.shift();var d=!t.isGroupContainer(a)&&!t.isVoidType(a)&&!t.isHeading(a);t.hasLinebreakingStyle(a)&&d?(o=n.children(a),u.push(a)):(o=[a],u.push(a.parentNode)),i=r.split(l,t.hasLinebreakingStyle),o=o.concat(i[0]),l=i[1],o.length>0&&s.push(o)}return{groups:s,parents:u}}function g(e,r){if(0!==r.length){var i=n.upWhile(r[0],c);t.isListItem(i)&&!n.prevSibling(i)&&(i=i.parentNode),o.assert(u.allowsNesting(i.parentNode.nodeName,e),"Lists.format#Cannot create "+e+" inside of a "+i.parentNode.nodeName);var a=i.ownerDocument.createElement(e),s=v(r);n.insert(a,i),n.move(s.groups.reduce(f,[]),a),s.parents.forEach(p)}}function N(e,r,i){o.assert(t.isListContainer({nodeName:e.toUpperCase()}),"Lists.format#"+e+" is not a valid list container");var a;if(t.isBoundariesEqual(r,i))return a=n.upWhile(d.nextNode(r),function(e){return!t.hasLinebreakingStyle(e)&&!n.isEditingHost(e.parentNode)}),g(e,h(a,a)),[r,i];var s=d.commonContainer(r,i);if(!t.hasLinebreakingStyle(s))return a=n.upWhile(s,function(e){return e.parentNode&&!m(e.parentNode)&&!n.isEditingHost(e.parentNode)}),g(e,h(a,a)),[r,i];var u=n.upWhile(d.nextNode(r),function(e){return!m(e)&&!n.isEditingHost(e.parentNode)}),l=n.upWhile(d.prevNode(i),function(e){return!m(e.parentNode)&&!n.isEditingHost(e.parentNode)});return g(e,h(u,l)),[r,i]}function E(e){return e.filter(t.isListItem).reduce(function(e,n){return e.concat(t.unwrapListItem(n))},[])}function b(e,r){var o,i=function(e){return!t.isListItem(e)&&!n.isEditingHost(e.parentNode)},a=d.container(e),s=d.offset(e),u=d.container(r),l=d.offset(r),c=n.upWhile(a,i),f=n.upWhile(u,i);return t.isListItem(c)&&(o=E(n.nodeAndNextSiblings(c)),t.isListItem(a)&&(a=o[0],s=0)),a===u?[d.create(a,s),r]:(t.isListItem(f)&&(o=E(n.nodeAndNextSiblings(f)),t.isListItem(u)&&(u=o[0],l=0)),[d.create(a,s),d.create(u,l)])}function S(e,r,o){var i=d.container(r),a=d.container(o),s=n.upWhile(i,t.isListItem),u=n.upWhile(a,t.isListItem);return t.isListItem(s)&&t.isListItem(u)&&s.parentNode===u.parentNode&&s.parentNode.nodeName.toLowerCase()===e?b(r,o):N(e,r,o)}function T(e,t){return n.upWhile(e,function(e){return!(t(e)||e.parentNode&&n.isEditingHost(e.parentNode))})}function y(e){var r=d.prevNode(e);if(n.isTextNode(r)){var o=r.data,i=d.offset(e),a=o.substr(0,i),u=s.NOT_SPACE.test(a)||s.NON_BREAKING_SPACE.test(a);if(u)return!1;r=r.previousSibling||r.parentNode}var l=T(r,t.isListItem);if(!t.isListItem(l))return!1;var c=d.fromFrontOfNode(l),f=0;return t.walkBetween(c,e,function(e){f+=e.filter(t.isRendered).length}),0===f}function A(e,n){for(var t=[];n--;)t.push(a.after(e)),e=a.remove(e);return{loc:e,records:t}}function _(e){return t.isRendered(e.domNode())}function x(e){var n=r.someIndex(e.lefts.concat().reverse(),_);return-1===n?null:a.prev(e,n+1)}function R(e){var n=r.someIndex(e.rights,_);return-1===n?null:a.next(e,n)}function C(e){return a.after(e).domNode()}function w(e){return e=R(e),e&&t.isListItem(C(e))?(e=R(a.down(e)),e&&t.isListContainer(C(e))?e:null):null}function O(e){if(e=x(e),!e||!t.isListItem(C(e)))return null;var n=a.next(a.down(e),e.rights.length);return e=x(n),e&&t.isListContainer(C(e))?(e=a.down(e),a.next(e,e.rights.length)):n}function I(e,n){return t.isListContainer(C(a.up(e)))||(e=a.down(a.insert(e,i(document.createElement("UL"))))),a.insert(e,n)}function L(e,o){var s=T(d.prevNode(e),t.isListItem),u=T(d.nextNode(o),t.isListItem);if(!t.isListItem(s)||!t.isListItem(u))return[e,o];e=d.fromFrontOfNode(s),o=d.fromBehindOfNode(u);var l=d.commonContainer(e,o),c=a.zipper(n.editingHost(s),{start:e,end:o}),f=function(e){return C(a.up(e))===l},p=c.loc;p=a.splitAt(p,c.markers.start,f),p=a.splitAt(p,c.markers.end,f);var m,h=w(a.next(a.go(p,c.markers.end))),v=[];h&&(p=a.down(h),m=A(p,p.rights.length),v=v.concat(m.records),p=a.remove(a.up(a.up(m.loc)))),p=a.go(p,c.markers.start),m=A(p,r.someIndex(p.rights.slice(1),a.isMarker)+2),v=m.records.concat(v),p=O(m.loc)||a.down(a.insert(m.loc,i(document.createElement("LI"))));var g=a.update(a.root(I(p,v)));return[d.next(g.start),d.prev(g.end)]}function B(e,n){var r=T(d.prevNode(e),t.isListItem);if(!t.isListItem(r))return!1;var o=T(d.nextNode(n),t.isListItem);return t.isListItem(o)?r!==o||y(e):!1}return{indent:L,format:N,unformat:b,toggle:S,isIndentationRange:B}}),define("aloha/links/link-util",["../dom","../html","../boundaries"],function(e,n,t){function r(e){return"A"===e.nodeName}function o(e){return!n.isGroupContainer(e)&&!n.isGroupedElement(e)}function i(n){var t=e.upWhile(n,function(n){return!r(n)&&o(n)&&!e.isEditingHost(n)});return r(t)?t:null}function a(t){return e.nextWhile(t,n.isUnrendered)}function s(t){return e.prevWhile(t,n.isUnrendered)}function u(e){var n=t.container(e),r=t.offset(e);t.isNodeBoundary(e)&&(n=n.childNodes[r],r=0);var o=a(n);return t.create(i(o)||o,r)}return{isLinkable:o,linkableBoundary:u,nextRenderedNode:a,prevRenderedNode:s}}),define("aloha/links/link-selection",["../dom","../html","../arrays","../mutation","../boundaries","./link-util"],function(e,n,t,r,o,i){function a(n,t){var r=e.cloneShallow(n);return n.insertBefore(r,t),r.appendChild(t),r}function s(n,t,o){if(h(n,t))return{after:n.nextSibling,before:n};if(m(n,t))return{after:n,before:n.previousSibling};var s=r.splitTextNode(n,t),u=s.nextSibling;if(u&&!u.nextSibling&&i.isLinkable(u.parentNode)&&!e.isSameNode(n,o)){var l=s.parentNode;do u=a(l,u),s=a(l,s),e.removeShallow(l),l=s.parentNode;while(l&&!e.isSameNode(l,o)&&i.isLinkable(l))}else if(!u){for(u=s;u.parentNode&&!u.nextSibling&&!e.isSameNode(u.parentNode,o);)u=u.parentNode;u=u.nextSibling}return{after:u,before:s}}function u(n,t,r){var o=e.cloneShallow(n);return n.parentNode.insertBefore(o,r),o.appendChild(t),o}function l(t,r){if(n.hasBlockStyle(t.parentNode))return t;t=t.parentNode;for(var o=t,a=t.parentNode;a&&!e.isSameNode(a,r)&&i.isLinkable(a);)o=u(a,t,a.nextSibling),t=a,a=a.parentNode;return o}function d(e){for(;!i.isLinkable(e);)e=e.lastChild;return e}function c(n,t){n=n.parentNode;for(var r=n,o=n.parentNode;o&&!e.isSameNode(o,t)&&i.isLinkable(o);)r=u(o,n,o),n=o,o=o.parentNode;if(!E(r)){var a=i.prevRenderedNode(r);e.remove(r),r=d(a)}return r}function f(n,t){var r=o.container(n),a=o.offset(n);return e.isTextNode(r)?s(r,a,t).after:e.isSameNode(r.parentNode,t)||!i.isLinkable(r.parentNode)?r:l(r,t)}function p(n,t){return e.isTextNode(n)&&t>0}function m(n,t){return e.isTextNode(n)&&0===t}function h(n,t){return e.isTextNode(n)&&n.length===t}function v(e,n){var t=o.container(e),r=o.offset(e);return p(t,r)?s(t,r,n).before:m(t,r)&&t.previousSibling?d(t.previousSibling):i.isLinkable(t.parentNode)?c(t,n):t}function g(e){return O.indexOf(e.nodeName)>=0}function N(n){return!e.isTextNode(n)||n.textContent.trim().length>0?!1:n.previousElementSibling&&g(n.previousElementSibling)&&n.nextElementSibling&&g(n.nextElementSibling)?!0:n.previousElementSibling&&g(n.previousElementSibling)&&!n.nextElementSibling?!0:!n.previousElementSibling&&n.nextElementSibling&&g(n.nextElementSibling)?!0:!1}function E(e){return n.isRendered(e)&&!N(e)}function b(n,t){if(!E(n))return n;if("A"===n.nodeName){var r=n.firstChild;e.children(n).forEach(function(e){t.push(e)}),e.removeShallow(n),n=r}else t.push(n);return n}function S(e,n){return e.length>0&&n.push(e),[]}function T(e){for(var n=!1;e&&!e.nextSibling&&e.parentNode;)e=e.parentNode,i.isLinkable(e)||(n=!0);return{next:e,createLinkable:n}}function y(n,t){for(var r=[],o=[];n&&!e.isSameNode(n,t);)if(i.isLinkable(n)){n=b(n,o);var a=T(n);n=a.next.nextSibling,a.createLinkable&&(o=S(o,r))}else o=S(o,r),n=n.firstChild;return i.isLinkable(t)&&b(t,o),o.length>0&&r.push(o),r}function A(n,t,r){var i=o.container(n),a=o.container(t),s=o.offset(n),u=o.offset(t),l=e.isTextNode(i)&&e.isSameNode(i,a),d=f(n,r);return l&&(t=o.raw(d,u-s),r=d),{startNode:d,endNode:v(t,r)}}function _(n,t){var r=o.container(n),i=o.container(t);return e.isTextNode(r)&&e.isSameNode(r,i)}function x(e,n){var t=o.container(e),r=o.offset(e),i=o.offset(n);return _(e,n)&&0===r&&t.length===i}function R(e,n){var t=i.linkableBoundary(e),r=i.linkableBoundary(n);if(x(t,r))return[[o.container(t)]];var a=A(t,r,o.commonContainer(e,n));return _(t,r)?[[a.endNode]]:y(a.startNode,a.endNode)}function C(){}function w(e,n){var t=r.splitBoundaryUntil(e,o.isNodeBoundary),i=r.splitBoundaryUntil(n,o.isNodeBoundary),a=o.nextNode(t),s=o.prevNode(i),u=C(a,s);return console.log(u),[t,i]}var O=["LI","TD","TR","TBODY","DD","DT"];return window.collectLinkable=w,{collectLinkableNodeGroups:R}}),define("aloha/links",["./dom","./html","./events","./ranges","./arrays","./mutation","./boundaries","./links/link-util","./links/link-selection"],function(e,n,t,r,o,i,a,s,u){function l(n,t){var r=a.document(n),o=u.collectLinkableNodeGroups(n,t);return o.reduce(function(n,t){var o=r.createElement("a");return e.insert(o,t[0]),e.move(t,o),n.concat(o)},[])}function d(t,r,s,u){var d;if(n.isBoundariesEqual(r,s)){var c=a.document(r).createElement("a");c.innerHTML=t,i.insertNodeAtBoundary(c,r,!0),d=[c]}else d=l(r,s);return d.forEach(function(n){e.setAttr(n,"href",t)}),u&&d.reduce(function(e,n){return e.push(n),e},u),[a.fromFrontOfNode(d[0]),a.fromBehindOfNode(o.last(d))]}function c(n,t){return e.cloneShallow(n).isEqualNode(e.cloneShallow(t))}function f(n,t){return!e.isTextNode(n)&&c(n,t)}function p(n,t){for(var r;n&&t&&f(n,t);)r=s.nextRenderedNode(n.firstChild),t.appendChild(r),e.remove(n),n=r,t=t.firstChild}function m(n){if(s.isAnchorNode(n)){var t=s.nextRenderedNode(n.firstChild),r=s.prevRenderedNode(n.previousSibling);p(t,r);var o=s.prevRenderedNode(n.lastChild),i=s.nextRenderedNode(n.nextSibling);p(i,o),e.removeShallow(n)}}function h(n){e.isElementNode(n)&&o.coerce(n.querySelectorAll("a")).forEach(m)}function v(e){for(var n;!e.nextSibling&&e.parentNode;)n=e.parentNode,m(e),e=n;var t=e.nextSibling;return m(e),t}function g(n,t){var r=s.boundaryLinkable(a.container(n),a.offset(n)),o=s.boundaryLinkable(a.container(t),a.offset(t)),i=a.container(r),u=a.container(o);h(i),h(u);for(var l=i;l&&!e.isSameNode(l,u);)l=v(l),l&&h(l);for(;u&&u.parentNode&&s.isLinkable(u);)m(u),u=u.parentNode}function N(e){return"A"!==e.nodeName}function E(n){if("click"!==n.type)return n;var r=a.commonContainer(n.selection.boundaries[0],n.selection.boundaries[1]),o=e.upWhile(r,N);return o&&t.preventDefault(n.nativeEvent),n}return{handleLinks:E,create:d,remove:g}}),define("aloha/overrides",["./dom","./misc","./maps","./html","./arrays","./mutation","./boundaries"],function(e,n,t,r,o,i,a){function s(n){var r=[];return t.forEach(E,function(t,o){var i=e.getStyle(n,t[0]);i&&(t[2]?i===t[2]?r.push([o,!1]):i===t[1]&&r.push([o,!0]):r.push([o,i===t[1]]))}),r}function u(n){if(e.isTextNode(n))return[];var t=g[n.nodeName];return(t?[[t,!0]]:[]).concat(s(n))}function l(n){return e.isTextNode(n)?[]:b.reduce(function(t,r){var o=e.getStyle(n,r);return o?t.concat([[r,o]]):t},[])}function d(t,r){for(var o,i,a,s,d,c=e.childAndParentsUntil(t,r||e.isEditingHost),f=[],p={},m=c.length;m--;){for(a=u(c[m]),o=0,i=a.length;i>o;o++)s=a[o],d=p[s[0]],n.defined(d)&&f.splice(d-1,1,null),p[s[0]]=f.push(s);f=f.concat(l(c[m]))}return f.reduce(function(e,n){return n?e.concat([n]):e},[])}function c(n,t){for(var o,s,u=a.container(t),l=e.childAndParentsUntil(u,e.isEditingHost),c=N[n],p=E[n],m=p[0],h=p[1],v=l.length;v--;)if(s=l[v],e.isElementNode(s)&&(c===s.nodeName||e.getStyle(s,m)===h)){o=s.parentNode;break}if(!o)return t;var g=d(u,function(e){return e==o}).reduce(function(e,t){return n===t[0]?e:e.concat([t])},[]);t=i.splitBoundaryUntil(t,function(e){return a.container(e)===o});var b=[t],S=a.prevNode(b[0]);r.isUnrendered(S)&&(b=i.removeNode(S,b));var T=a.nextNode(b[0]);return r.isUnrendered(T)&&(b=i.removeNode(T,b)),f(b[0],g)}function f(n,r){var o,s=a.document(n);return t.forEach(t.mapTuples(r),function(t,r){if(N[r])if(t){var u=s.createElement(N[r]);o?e.wrap(o,u):(i.insertNodeAtBoundary(u,n),n=a.create(u,0)),o=u}else n=c(r,n);else o||(o=s.createElement("span"),i.insertNodeAtBoundary(o,n),n=a.create(o,0)),e.setStyle(o,r,t)}),n}function p(e,n){for(var t=0;t<e.length;t++)if(n===e[t][0])return t;return-1}function m(e,n,t){var r=p(e,n);if(-1===r)return e.concat([[n,t]]);var o=e.concat();return o[r][1]="boolean"==typeof o[r][1]?!o[r][1]:t,o}function h(e){for(var n,r=[],o=t.create(),i=e.length;i--;)n=e[i],o[n[0]]||(o[n[0]]=!0,r.push(n));return r.reverse()}function v(){return h(Array.prototype.concat.apply([],o.coerce(arguments)))}var g={A:"link",U:"underline",B:"bold",STRONG:"bold",I:"italic",EM:"italic",STRIKE:"strikethrough",SUB:"subscript",SUP:"superscript"},N={link:"A",underline:"U",bold:"B",italic:"I",strikethrough:"STRIKE",subscript:"SUB",superscript:"SUP"},E={bold:["fontWeight","bold",null],italic:["fontStyle","italic",null],underline:["textDecoration","underline","none"],strikethrough:["textDecoration","line-through","none"]},b=["textTransform","backgroundColor","color","fontSize","fontFamily","border","borderColor","borderStyle","borderWidth","borderTop","borderTopColor","borderTopStyle","borderTopWidth","borderBottom","borderBottomColor","borderBottomStyle","borderBottomWidth","borderLeft","borderLeftColor","borderLeftStyle","borderLeftWidth","borderRight","borderRightColor","borderRightStyle","borderRightWidth"];return{indexOf:p,unique:h,toggle:m,consume:f,harvest:d,joinToSet:v,nodeToState:g,stateToNode:N}}),define("aloha/editing",["./dom","./mutation","./boundaries","./arrays","./maps","./strings","./functions","./html","./html/elements","./stable-range","./cursors","./content","./lists","./links","./overrides"],function(e,n,t,r,o,i,a,s,u,l,d,c,f,p,m){function h(n,t,r,o,i,a){var s=r;e.walk(n.firstChild,function(e){e!==t?s(e,a):(s=i,o(e,a))})}function v(n,t,r,o,i,a,s){var u,l=[];for(u=n.length;u--;){var d=r(n[u],s);null!=d&&(s=d),l.push(s)}for(l.reverse(),n.length&&t&&e.walk(n[0].firstChild,o,l[0]),u=0;u<n.length-1;u++){var c=n[u],f=n[u+1];h(f,c,o,i,a,l[u+1])}}function g(e,n,t,r){return function(o,i){o!==e||n?r(o,i):t(o,i)}}function N(n,o,i,a,s,u,l,d,c){var f=n.commonAncestorContainer;e.isTextNode(f)&&(f=f.parentNode);var p=n.startContainer,m=n.endContainer,h=n.startOffset,N=n.endOffset,E=n.collapsed,b=e.nodeAtOffset(p,h),S=e.nodeAtOffset(m,N),T=t.isAtEnd(t.raw(p,h)),y=t.isAtEnd(t.raw(m,N)),A=e.childAndParentsUntilNode(b,f),_=e.childAndParentsUntilNode(S,f),x=g(b,T,a,l),R=g(S,y,u,l);v(A,T,o,i,x,a,c),v(_,y,o,s,R,u,c);var C=r.last(A),w=r.last(_);if(x=g(b,T,d,l),e.walkUntilNode(f.firstChild,i,C,c),C){var O=C.nextSibling;C===w?E||l(C,c):(x(C,c),e.walkUntilNode(O,d,w,c),w&&(O=w.nextSibling,R(w,c))),w&&e.walk(O,u,c)}}function E(e,n,t,r,o,i){N(e,n,t,o,o,t,r,o,i)}function b(n,t,r,o,i,a,s){var u=n.commonAncestorContainer;E(n,o,s,i,a,r);var l=e.childAndParentsUntilInclNode(u,t);v(l,!1,o,s,i,s,null),i(t)}function S(n,t,o,i,u,l){function d(e){f=f||!s.isUnrenderedWhitespace(e)&&!t(e)}function c(e){return p!==e&&u(e)||i(e)||l(e)}var f=null;if(E(n,a.noop,d,a.noop,a.noop),f)return null;var p=n.commonAncestorContainer;e.isTextNode(p)&&(p=p.parentNode);var m=e.childAndParentsUntilIncl(p,c),h=r.last(m);return u(h)?(v(m,!1,a.noop,d,a.noop,d),f?u(p)?p:null:h):u(p)?p:null}function T(n,t){var o=n.commonAncestorContainer,i=t.isUpperBoundary,a=t.getOverride,s=t.getInheritableOverride,u=t.pushDownOverride,l=t.hasContext,d=t.hasInheritableContext,c=t.setContext,f=t.clearOverride,p=t.isObstruction,m=t.isReusable,h=t.isContextOverride,v=t.isClearable,g=t.clearOverrideRec||function(n){e.walkRec(n,f)},N=null,T=null,y=!1,A=!1,_=e.childAndParentsUntilIncl(o,function(n){return!n.parentNode||e.Nodes.DOCUMENT===n.parentNode.nodeType||d(n)});if(_.forEach(function(e){A=A||i(e);var n=s(e);null==n||h(n)||(N=e,y=y||A||!v(e),null==T&&(T=n))}),null==T&&(T=s(o)),d(r.last(_))&&!y)if(N){var x=N;b(n,x,T,a,f,g,u)}else E(n,a,u,f,g);else{var R=function(e,n){c(e,n,y)},C=S(n,l,a,i,m,p);C?R(C):E(n,a,u,f,R)}}function y(e,n,t){e.node!==n||e.atEnd||(e.node=t)}function A(t,r,o,i){return c.allowsNesting(r.nodeName,t.nodeName)?(r.parentNode&&n.removeShallowPreservingCursors(r,[o,i]),y(o,t,r),y(i,t,r),e.wrap(t,r),!0):!1}function _(n,t,r){e.insert(n,t,r)}function x(e,r,o){var i=l(e);n.splitTextContainers(i);var a=d.cursorFromBoundaryPoint(i.startContainer,i.startOffset),u=d.cursorFromBoundaryPoint(i.endContainer,i.endOffset);!1!==o&&q(i,s.isUnrenderedWhitespace,s.isUnrenderedWhitespace);var c=d.cursorFromBoundaryPoint(i.startContainer,i.startOffset),f=d.cursorFromBoundaryPoint(i.endContainer,i.endOffset),p=r(i,c,f);p&&p.postprocess(),d.setToRange(i,c,f),n.joinTextNodeAdjustRange(a.node,i),n.joinTextNodeAdjustRange(u.node,i),p&&p.postprocessTextNodes(i);var m=t.fromRange(i);return t.setRange(e,m[0],m[1]),m}function R(n,t,r,o){if(!e.isElementNode(n)||!o(n))return null;var i=e.nextWhile(n.firstChild,r);
if(!i)return null;var a=e.nextWhile(i.nextSibling,r);return a?null:t(i)?i:R(i,t,r,o)}function C(e,n,t,r,o,i){function a(e){return!n(e)&&t(e)}if(n(e))return e;var s=R(e,n,a,r);return s&&A(e,s,o,i)?s:null}function w(n,t,r,o,i,a,s,u){var l=n.previousSibling;if(l&&o(l)&&o(n))_(n,l,!0,s,u),i(n);else if(r(n))a(n);else{var d=t(n.ownerDocument);A(n,d,s,u)?i(n):e.walk(n.firstChild,function(e){w(e,t,r,o,i,a,s,u)})}}function O(t,o,i,u){function l(e){_(e)&&(O(e),B(e)&&(e.previousSibling&&P.push(e.previousSibling),e.nextSibling&&P.push(e.nextSibling),n.removeShallowPreservingCursors(e,[o,i])))}function d(e,n){var t=I(e,n),r=":"+e,o=k[r]=k[r]||[];return o.push(t),D.push([t,e]),t}function c(e){var n=e.cloneNode(!1);return O(n),B(n)}function f(e,n){if(!L(n))return!1;var t=":"+e,o=k[t]||[];return r.contains(o,n)?!0:_(n)&&!x(n,e)?!1:c(n)}function p(e,n){w(e,a.partial(d,n),L,a.partial(f,n),l,a.partial(R,n),o,i)}function m(e){y(e)||l(e)}function h(e){l(e)}function v(n){e.walkRec(n,h)}function g(e,n){null==n||_(e)||A(n)||p(e,n)}function N(n,r){A(r)||(e.walk(n.firstChild,v),p(n,t))}function E(e,n,t){function r(e){return x(e,n)}var u=t?e.nextSibling:e.previousSibling;if(u&&(u=C(u,r,s.isUnrenderedWhitespace,s.hasInlineStyle,o,i))){var c=a.partial(f,n),p=a.partial(d,n),m=a.partial(R,n),h=t?u:e;w(h,p,L,c,l,m,o,i)}}function b(e,n){E(e,n,!0),E(e,n,!1)}function S(){D.forEach(function(e){b(e[0],e[1])})}function T(e){P.forEach(function(t){n.joinTextNodeAdjustRange(t,e)})}var y=u.hasContext,A=u.isContextOverride,_=u.hasSomeContextValue,x=u.hasContextValue,R=u.addContextValue,O=u.removeContext,I=u.createWrapper,L=u.isReusable,B=u.isPrunable,k={},D=[],P=[];return{hasContext:y,isReusable:L,clearOverride:m,isClearable:c,pushDownOverride:g,setContext:N,isContextOverride:A,postprocess:S,postprocessTextNodes:T,hasInheritableContext:u.hasInheritableContext,isObstruction:u.isObstruction,getOverride:u.getOverride,getInheritableOverride:u.getInheritableOverride,isUpperBoundary:u.isUpperBoundary}}function I(n){return"BODY"===n.nodeName||s.hasBlockStyle(n)||e.isEditingHost(n)}function L(e,n){return e===n}function B(n,t){return e.isElementNode(n)?e.getStyle(n,t):null}function k(n,t,u,l,d){function c(e){return C&&C.normalize[e]&&(e=C.normalize[e]),e}function f(e){if(r.contains(x,e.nodeName))return C.value;var t=B(e,n);return i.isEmpty(t)?null:t}function p(t){if(r.contains(x,t.nodeName))return C.value;var o=e.getComputedStyle(t,n);return i.isEmpty(o)?null:o}function m(e){return _(c(e),t)}function h(e){return m(e)}function v(e){return r.contains(x,e.nodeName)?!0:!i.isEmpty(B(e,n))}function g(e,t){return t=c(t),r.contains(x,e.nodeName)&&_(C.value,t)?!0:_(B(e,n),t)}function N(e){return!R&&r.contains(x,e.nodeName)?!0:m(B(e,n))}function E(t){return!R&&r.contains(x,t.nodeName)?!0:R&&"BODY"===t.nodeName?!0:m(R&&s.isStyleInherited(n)?B(t,n):e.getComputedStyle(t,n))}function b(t,o){t=c(t),r.contains(x,o.nodeName)&&_(C.value,t)||_(c(e.getComputedStyle(o,n)),t)||e.setStyle(o,n,t)}function S(t){e.removeStyle(t,n)}function T(e){return r.contains(x,e.nodeName)?!0:"SPAN"===e.nodeName}function y(n){return T(n)&&!e.hasAttrs(n)}function A(t,r){if(t=c(t),C&&_(C.value,t))return r.createElement(C.name);var o=r.createElement("SPAN");return e.setStyle(o,n,t),o}var _=d.isStyleEqual||L,x=[],R=!1,C=fn[n];C&&(x=C.nodes,n=C.style,R=!t,t=R?C.normal:C.value);var w=o.merge({getOverride:f,getInheritableOverride:p,hasContext:N,hasInheritableContext:E,isContextOverride:h,hasSomeContextValue:v,hasContextValue:g,addContextValue:b,removeContext:S,isPrunable:y,isStyleEqual:_,createWrapper:A,isReusable:T,isObstruction:a.complement(s.hasInlineStyle),isUpperBoundary:I},d);return O(t,u,l,w)}function D(n,t,r,i,u){function l(e,t){return t.createElement(n)}function d(e){return n===e.nodeName||null}function c(e){return t?!1:n===e.nodeName}function f(e){return t&&"BODY"===e.nodeName?!0:c(e)}function p(e){return t?!1:null!=e}function m(t){return t.nodeName===n&&!e.hasAttrs(t)}function h(e){return m(e)}function v(e){return e.nodeName===n}n=n.toUpperCase();var g=o.merge({getOverride:d,getInheritableOverride:d,hasContext:c,hasInheritableContext:f,isContextOverride:p,hasSomeContextValue:v,hasContextValue:v,addContextValue:a.noop,removeContext:a.noop,createWrapper:l,isReusable:m,isPrunable:h,isObstruction:a.complement(s.hasInlineStyle),isUpperBoundary:I},u);return O(n,r,i,g)}function P(e,n,r,o,i){i=i||{};var a=t.range(n,r);return a.collapsed?[n,r]:x(a,function(n,t,r){var a=D(e,o,t,r,i);return T(n,a),a})}function H(e,n,r,o,i){var a=t.range(e,n);return a.collapsed?[e,n]:x(a,function(e,n,t){var a=k(r,o,n,t,i||{});return T(e,a),a})}function M(e,n,r,o){var i=F(e),a=i===!1?[n,r]:H(n,r,i,o);if(t.equals(a[0],a[1]))return a;var s=t.nodeAfter(a[0]),u=t.nodeBefore(a[1]);return n=s?t.normalize(t.fromStartOfNode(s)):a[0],r=u?t.normalize(t.fromEndOfNode(u)):a[1],[n,r]}function F(e){for(var n in fn)if(-1!==fn[n].nodes.indexOf(e))return n;return!1}function U(e,n,t,r){t=t||a.returnFalse,r=r||a.returnFalse,e.prevWhile(function(e){var n=e.prevSibling();return n?r(n):!t(e.parent())}),n.nextWhile(function(e){return e.atEnd?!t(e.parent()):r(e.node)})}function W(e,n,t,r){t=t||a.returnFalse,r=r||a.returnFalse,e.nextWhile(function(e){return!e.equals(n)&&(e.atEnd?!t(e.parent()):r(e.node))}),n.prevWhile(function(n){var o=n.prevSibling();return!e.equals(n)&&(o?r(o):!t(n.parent()))})}function G(e,n,t,r,o){var i=e.equals(n);W(e,n,t,o),U(e,n,r,o),i&&n.setFrom(e)}function z(n,t,r,o,i,a,s,u){var l=d.cursorFromBoundaryPoint(t,r);if(u&&e.isTextNode(t)&&r>0&&r<t.length&&l.next()){if(!s(l))return n;l.prev()}for(var c=d.cursorFromBoundaryPoint(o,i),f=!1;!l.equals(c)&&s(l)&&(u?l.prev():l.next());)f=!0;return f&&a(n,l),n}function V(e,n,t){if(n=n||a.returnFalse,t=t||a.returnFalse,e.collapsed)return e;var r=e.startContainer,o=e.startOffset,i=e.endContainer,s=e.endOffset;return z(e,r,o,i,s,d.setRangeStart,n,!1),r=e.startContainer,o=e.startOffset,z(e,i,s,r,o,d.setRangeEnd,t,!0),e}function q(e,n,t){return n=n||a.returnFalse,t=t||a.returnFalse,V(e,function(e){return e.atEnd||n(e.node)},function(e){return!e.prevSibling()||t(e.prevSibling())}),e}function Y(n,t,r,o,i,s){function u(e,n){return n||s.until(e)}function l(n,t){if(!t){var a=n.parentNode;d&&a.previousSibling===d||(d=s.clone(a),i.push(a),e.insert(d,a,!1),r.node!==a||r.atEnd||(r.node=d),o.node===a&&(o.node=d)),_(n,d,!0,r,o)}}var d=null,c=e.childAndParentsUntilIncl(n,s.below),f=c.pop();return f&&s.below(f)&&v(c,t,u,l,a.noop,a.noop),f}function K(e){if(u.skipUnrenderedToStartOfLine(e))return!0;if(!u.skipUnrenderedToEndOfLine(e))return!1;if("BR"===e.node.nodeName){e.skipNext();var n=e.clone();u.skipUnrenderedToEndOfLine(n)&&n.atEnd&&e.setFrom(n)}return!0}function j(r,o,i,a){var s=a.normalizeRange?o:o.clone(),u=a.normalizeRange?i:i.clone();K(s),K(u),d.setToRange(r,s,u);var l=[],c=e.nodeAtOffset(r.startContainer,r.startOffset),f=e.nodeAtOffset(r.endContainer,r.endOffset),p=t.isAtEnd(t.raw(r.startContainer,r.startOffset)),m=t.isAtEnd(t.raw(r.endContainer,r.endOffset)),h=Y(c,p,o,i,l,a),v=Y(f,m,o,i,l,a);l.forEach(function(e){!e.firstChild&&e.parentNode&&n.removeShallowPreservingCursors(e,[o,i])}),a.normalizeRange&&G(o,i,null,function(e){return e===h||e===v})}function X(n,t){return t=t||{},t=o.merge({clone:e.cloneShallow,until:a.returnFalse,below:e.isEditingHost,normalizeRange:!0},t),x(n,function(e,n,r){return j(e,n,r,t),null})}function Z(e,r){var o=t.range(e,r);return x(o,function(e,r,o){var i=function(t){n.removePreservingRange(t,e)};return N(e,a.noop,a.noop,i,i,a.noop,a.noop,i,null),{postprocessTextNodes:a.noop,postprocess:function(){var n=s.removeBreak(t.fromRangeStart(e),t.fromRangeEnd(e))[0],i=d.createFromBoundary(t.container(n),t.offset(n));r.setFrom(i),o.setFrom(i)}}},!1)}function Q(e,n){var t="BR"===n?s.insertLineBreak:s.insertBreak;return e=t(e,n),[e,e]}function $(e,r,o){var i=t.range(e,r);X(i,{below:function(e){return c.allowsNesting(e.nodeName,o.nodeName)}});var a=n.insertNodeAtBoundary(o,t.fromRangeStart(i));return t.setRange(i,a,t.create(t.container(a),t.offset(a)+1)),t.fromRangeStart(i)}function J(){throw"Not implemented"}function en(){throw"Not implemented"}function nn(){throw"Not implemented"}function tn(){throw"Not implemented"}function rn(n,t){return e.upWhile(n,function(n){return!(t(n)||n.parentNode&&e.isEditingHost(n.parentNode))})}function on(n,r,o){var i,a,u;if(s.isBoundariesEqual(n,r)){if(i=t.nextNode(r),e.isEditingHost(i)&&(i=t.prevNode(n)),e.isEditingHost(i))return[n,r];a=u=o(i)?i:rn(i,o)}else a=rn(t.nextNode(n),o),u=rn(t.prevNode(r),o);return[t.fromFrontOfNode(a),t.fromBehindOfNode(u)]}function an(n,t){var o=null;t.forEach(function(t){if(!s.isUnrendered(t)||o){if(c.allowsNesting(n,t.nodeName))return o||(o=t.ownerDocument.createElement(n),e.insert(o,t)),e.move([t],o);if(o=null,!s.isVoidType(t)){var i=e.children(t),u=i.map(function(e){return e.nodeName}),l=u.length===u.filter(a.partial(c.allowsNesting,n)).length,d=c.allowsNesting(t.parentNode.nodeName,n);if(l&&d&&!s.isGroupContainer(t)&&!s.isGroupedElement(t))return e.replaceShallow(t,t.ownerDocument.createElement(n));var f=r.someIndex(i,s.isRendered);f>-1&&an(n,i.slice(f))}}})}function sn(e,n,r){var o=on(n,r,s.hasLinebreakingStyle);return o=s.walkBetween(o[0],o[1],a.partial(an,e)),n=t.fromStartOfNode(t.nextNode(o[0])),r=t.fromEndOfNode(t.prevNode(o[1])),[s.expandForward(n),s.expandBackward(r)]}function un(e,n,t){var r,o={nodeName:t};return"a"===t.toLowerCase()?r=p.create("",e,n):s.isTextLevelSemanticNode(o)?r=M(t,e,n,!0):s.isListContainer(o)?r=f.toggle(t,e,n):s.isBlockNode(o)&&(r=sn(t,e,n)),r}function ln(e,n,t){return M(t,e,n,!1)}function dn(e,n,r){var o=m.nodeToState[e];if(!o)return[n,r];var i=t.nextNode(s.expandForward(n)),a=t.prevNode(s.expandBackward(r)),u=m.harvest(i).concat(m.harvest(a)),l=-1<m.indexOf(u,o),d=l?ln:un;return d(n,r,e)}function cn(e,n,t){var r={nodeName:t};return s.isTextLevelSemanticNode(r)?dn(t,e,n):[e,n]}var fn={underline:{name:"U",nodes:["U"],style:"text-decoration",value:"underline",normal:"none",normalize:{}},bold:{name:"B",nodes:["B","STRONG"],style:"font-weight",value:"bold",normal:"normal",normalize:{700:"bold",400:"normal"}},italic:{name:"I",nodes:["I","EM"],style:"font-style",value:"italic",normal:"normal",normalize:{}}};return fn.emphasis=o.merge(fn.italic,{name:"EM"}),fn.strong=o.merge(fn.bold,{name:"STRONG"}),fn.bold=fn.bold,fn.italic=fn.italic,fn.underline=fn.underline,{format:un,unformat:ln,toggle:cn,style:H,className:J,attribute:en,cut:nn,copy:tn,breakline:Q,insert:$,wrap:P,split:X,remove:Z,trimClosingOpening:q}}),define("aloha/keys",["./maps","./strings","./boundaries"],function(e){function n(e){var n=[];return e.altKey&&a.alt!==e.which&&n.push("alt"),e.ctrlKey&&a.ctrl!==e.which&&n.push("ctrl"),e.metaKey&&n.push("meta"),e.shiftKey&&a.shift!==e.which&&n.push("shift"),n.join("+")}function t(e){var n=r(e.nativeEvent);return e.meta=n.meta,e.keycode=n.keycode,e}function r(e){return{meta:n(e),keycode:e.which,key:i[e.which],chr:String.fromCharCode(e.which).toLowerCase()}}function o(e,n,t){var r=46>=n||n>=91?i[n]||n:String.fromCharCode(n).toLowerCase(),o=e?e+"+"+r:r;return t[o]?t[o]:null}var i={8:"backspace",9:"tab",12:"f1",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",23:"end",24:"home",27:"escape",32:"space",33:"pageUp",34:"pageDown",37:"left",38:"up",39:"right",40:"down",46:"delete",65:"selectAll",66:"bold",73:"italic",85:"underline",90:"undo",91:"meta"},a={};e.forEach(i,function(e,n){a[e]=n});var s={37:"left",38:"up",39:"right",40:"down"},u={keyup:!0,keydown:!0,keypress:!0};return{CODES:a,EVENTS:u,ARROWS:s,handleKeys:t,shortcutHandler:o,parseKeys:r}}),define("aloha/mouse",["./boundaries"],function(){function e(e){return"mousedown"===e.type&&(e.selection.formatting=[],e.selection.overrides=[]),e}var n={mouseup:!0,mousedown:!0,mousemove:!0,dblclick:!0,dragstart:!0,dragover:!0,dragend:!0};return{handleMouse:e,EVENTS:n}}),define("aloha/traversing",["./dom","./html","./arrays","./strings","./boundaries"],function(e,n,t,r,o){function i(e){if(o.isNodeBoundary(e))return e;var t=n.nextSignificantOffset(e),r=o.container(e);return-1===t?o.fromEndOfNode(r):o.create(r,t)}function a(e){var t=n.next(e,"char");if(t&&o.isTextBoundary(t)){var r=o.container(t),i=o.offset(t);return r.data.substr(i-1,1)}return""}function s(e,t){var o=n.prev(e,t);return"word"===t&&r.WORD_BOUNDARY.test(a(o,"char"))?s(o,t):o}function u(e,t){return"word"===t&&r.WORD_BOUNDARY.test(a(e,"char"))?u(n.next(e,"char"),t):n.next(e,t)}function l(e,n){return[s(e,"word")||e,u(n,"word")||n]}function d(r,i){var a=o.commonContainer(r,i),s=e.childAndParentsUntilIncl(a,function(t){return n.hasLinebreakingStyle(t)||e.isEditingHost(t)}),l=t.last(s),d=e.nodeLength(l);return[o.create(l,0),u(o.create(l,d))]}function c(e,n,t){switch(t){case"word":return l(e,n);case"block":return d(e,n);default:throw'"'+t+"\"? what's that?"}}return{expand:c,next:u,prev:s,backward:n.stepBackward,forward:n.stepForward,isAtStart:n.isAtStart,isAtEnd:n.isAtEnd,isBoundaryEqual:n.isBoundaryEqual,envelopeInvisibleCharacters:i}}),define("aloha/carets",["./dom","./html","./maps","./traversing","./boundaries"],function(e,n,t,r,o){function i(n){if(!n["!aloha-br-style-fix"]){var t=n.createElement("style"),r=n.createTextNode('.aloha-editable br,.aloha-editable br:after{content:"\\A";white-space:pre-line;}');e.append(r,t),e.append(t,n.head),n["!aloha-br-style-fix"]=!0}}function a(t){if(o.isTextBoundary(t))return t;if(o.isAtStart(t))return t;if(n.isRendered(o.nodeBefore(t)))return t;var r=e.clone(o.container(t),!0),i=o.offset(t)-1;return e.remove(r.childNodes[i]),o.create(r,i)}function s(e){var t=e.cloneRange(),r=a(o.fromRangeStart(t)),i=o.fromRangeEnd(t);return o.isAtStart(r)?null:n.hasLinebreakingStyle(o.prevNode(r))?null:o.range(l(r),i)}function u(e){var t=o.fromRangeStart(e),r=o.fromRangeEnd(e);return o.isAtEnd(r)?null:n.hasLinebreakingStyle(o.nextNode(r))?null:n.isAtEnd(t)?null:o.range(t,d(r))}function l(e){var t=r.prev(e,"char");return t?t:n.hasLinebreakingStyle(o.prevNode(e))?e:l(r.prev(e,"boundary"))}function d(e){var t=r.next(e,"char");return t?t:n.hasLinebreakingStyle(o.nextNode(e))?e:d(r.next(e,"boundary"))}function c(e){var n=e.getClientRects()[0]||e.getBoundingClientRect();return{top:n.top,left:n.left,width:n.width,height:n.height}}function f(n,r){var o=r.querySelector(".aloha-caret-box-hint");return o||(o=r.createElement("div")),t.extend(o.style,{top:n.top+"px",left:n.left+"px",height:n.height+"px",width:n.width+"px",position:"absolute",background:"red",opacity:.2}),e.addClass(o,"aloha-caret-box-hint","aloha-ephemera"),e.append(o,r.body),o}function p(n){var t=n.querySelector(".aloha-caret-box-hint");return t&&e.remove(t),t||null}function m(e){var n,t=u(e);return t&&(n=c(t),n.width>0)?n:(t=s(e),t?(n=c(t),n.left+=n.width,n):c(e))}function h(n){var t=m(n),r=n.commonAncestorContainer.ownerDocument,a=e.documentWindow(r),s=a.pageYOffset-r.body.clientTop,u=a.pageXOffset-r.body.clientLeft;if(i(r),t.width>0)return{top:t.top+s,left:t.left+u,width:t.width,height:t.height};var l=o.fromRangeStart(n),d=o.nodeAfter(l)||o.nodeBefore(l);if(d&&!e.isTextNode(d)&&(t=c(d)))return{top:t.top+s,left:t.left+u,width:t.width,height:t.height};var f=e.scrollTop(r),p=e.scrollLeft(r);return d=o.container(l),{top:d.offsetTop-f+s,left:d.offsetLeft-p+u,width:d.offsetWidth,height:parseInt(e.getComputedStyle(d,"line-height"),10)}}return{box:h,showHint:f,hideHint:p}}),define("aloha/animation",["./functions"],function(e){function n(e,n,t,r){return t+(r-t)*e}function t(e,n,t,r,o){return r*((n=n/o-1)*n*n*n*n+1)+t}function r(e,n,t,r,o){return(n/=o/2)<1?r/2*n*n*n*n*n+t:r/2*((n-=2)*n*n*n*n+2)+t}function o(e){var n=(new Date).getTime();e.starttime||(e.starttime=n);var t=n-e.starttime,r=Math.min(1,t/e.duration),o=e.easing(r,t,0,1,e.duration),i=e.interval(e.start+e.delta*o,r);return i?1:r}function i(n,r,i,s,u){var l={start:n,delta:r-n,duration:s||1,interval:u||e.noop,easing:i||t};return function d(){o(l)<1&&a(d)}(),l}var a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};return{step:o,animate:i,easeLinear:n,easeOutQuint:t,easeInOutQuint:r,requestAnimationFrame:a}}),define("aloha/selections",["./dom","./keys","./maps","./html","./mouse","./events","./arrays","./ranges","./carets","./browsers","./overrides","./animation","./boundaries","./traversing","./functions"],function(e,n,t,r,o,i,a,s,u,l,d,c,f,p,m){function h(n){var t=n.querySelectorAll("div.aloha-caret"),r=[];return[].forEach.call(t,function(n){"block"===e.getStyle(n,"display")&&(r.push(n),e.setStyle(n,"display","none"))}),r}function v(n){n.forEach(function(n){e.setStyle(n,"display","block")})}function g(e,n){var r=u.box(f.range(n,n));t.extend(e.style,{top:r.top+"px",left:r.left+"px",height:r.height+"px",width:"2px",display:"block"})}function N(e){var n={};return n.padding=e.bold?"1.5px":"0px",n[l.VENDOR_PREFIX+"transform"]=e.italic?"rotate(16deg)":"",n.background=e.color||"black",n}function E(n,t){var r=f.container(n),o=f.container(t),i=f.offset(n),a=f.offset(t);return r===o&&i>a||e.followedBy(o,r)}function b(e,n,t){var r=f.fromPosition(e.left,e.top-n,t);return r&&f.range(r[0],r[1])}function S(e,n,t){var r=f.fromPosition(e.left,e.top+e.height+n,t);return r&&f.range(r[0],r[1])}function T(e,n,t){var r,o;return"start"===t?(r=e[0],o=n[1]):(r=n[0],o=e[1]),E(r,o)?{boundaries:[o,r],focus:"start"===t?"end":"start"}:{boundaries:[r,o],focus:t}}function y(e,n,t,o){var a;"up"===e?(a=f.create(n.editable.elem,0),a=r.expandForward(a)):(a=f.fromEndOfNode(n.editable.elem),a=r.expandBackward(a));var s=[a,a];return i.hasKeyModifier(n,"shift")?T(s,t,o):{boundaries:s,focus:o}}function A(n,t,r,o){var a=r["start"===o?0:1],l=f.document(a),d=e.documentWindow(l),c=d.pageYOffset-l.body.clientTop,p=d.pageXOffset-l.body.clientLeft,m=f.range(a,a),h=u.box(m);h.top-=c,h.left-=p;for(var v=h.height/2,g=v,N="up"===n?b:S,E=N(h,g,l);E&&s.equals(E,m);)g+=v,E=N(h,g,l);return E?i.hasKeyModifier(t,"shift")?T(f.fromRange(E),r,o):{boundaries:f.fromRange(E),focus:o}:{boundaries:r,focus:o}}function _(n,t,o,a){var s=i.hasKeyModifier(t,"shift"),u=o[0],l=o[1],d=f.equals(u,l);(d||!s)&&(a="left"===n?"start":"end");var c="start"===a?u:p.envelopeInvisibleCharacters(l);if(d||s){var m=i.hasKeyModifier(t,"ctrl")||i.hasKeyModifier(t,"alt")?"word":"visual",h="left"===n?p.prev(c,m):p.next(c,m);e.isEditingHost(f.container(h))&&(f.isAtStart(c)?h=r.expandForward(c):f.isAtEnd(c)&&(h=r.expandBackward(c))),h&&(c=h)}return s?{boundaries:"start"===a?[c,l]:[u,c],focus:a}:{boundaries:[c,c],focus:a}}function x(n,t,r){var o=f.range(t[0],t[1]),i=a.last(o.getClientRects()),u=n.editable.elem.offsetLeft+n.editable.elem.clientWidth,l=i?i.top:e.absoluteTop(f.container(t[0])),d=s.fromPosition(u,l,f.document(t[0]));return{boundaries:f.fromRange(d),focus:r}}function R(e,n,t){return e.nativeEvent.preventDefault(),{boundaries:n,focus:t}}function C(e,n,t){return{boundaries:n,focus:t}}function w(e,t,r){var o=n.shortcutHandler(e.meta,e.keycode,q);return o?(i.preventDefault(e.nativeEvent),o(e,t,r)):C(e,t,r)}function O(e,n){return{boundaries:p.expand(n[0],n[1],"word"),focus:"end"}}function I(e,n){return{boundaries:p.expand(n[0],n[1],"block"),focus:"end"}}function L(e,n,t,r){return T(n,r,t)}function B(e,n,t,r,o){if(!o)return{boundaries:n,focus:t};var i=n[0],a=r["start"===t?1:0];return E(i,a)?{boundaries:[a,i],focus:"end"}:{boundaries:[i,a],focus:"start"}}function k(e,n){return{boundaries:n,focus:"end"}}function D(e,n,t){return{boundaries:n,focus:t}}function P(e,n){return{boundaries:n,focus:"end"}}function H(n){function t(r,o,i){c.animate(r,o,c.easeLinear,i,function(r,o){return s?(e.setStyle(n,"opacity",r),void(1>o||(0===r?a.push(setTimeout(function(){t(0,1,100)},300)):1===r&&a.push(setTimeout(function(){t(1,0,100)},500))))):!0})}function r(){s=!1,e.setStyle(n,"opacity",1),a.forEach(clearTimeout),a=[]}function o(){r(),s=!0,a.push(setTimeout(function(){t(1,0,100)},500))}function i(){r(),a.push(setTimeout(o,50))}var a=[],s=!0;return{start:i,stop:r}}function M(n){var r=n.createElement("div");return t.extend(r.style,{cursor:"text",color:"#000",zIndex:"9999",display:"none",position:"absolute"}),e.addClass(r,"aloha-caret","aloha-ephemera"),e.insert(r,n.body,!0),{blinking:H(r),focus:"end",boundaries:null,event:null,dragging:null,multiclick:null,clickTimer:0,lastMouseEvent:"",caret:r,formatting:[],overrides:[]}}function F(n){var t=u.box(f.range(n,n)),r=f.document(n),o=e.documentWindow(r),i=o.pageYOffset-r.body.clientTop,a=o.pageXOffset-r.body.clientLeft,s=o.innerHeight,l=o.innerWidth,d=t.height,c=t.top,p=t.left,m=0,h=0;i>c?m=c-d:c>i+s&&(m=c-s+d+d),a>p?h=p-d:p>a+l&&(h=p-l+d+d),(m||h)&&o.scrollTo(h||a,m||i)}function U(n,r){var o=d.joinToSet(r.formatting,d.harvest(n),r.overrides),i=t.merge(t.mapTuples(o));return i.color||(i.color=e.getComputedStyle(e.isTextNode(n)?n.parentNode:n,"color")),i}function W(e){if(!Y[e.type])return e;var n=e.selection,t=Y[e.type](e,n.boundaries,n.focus,n.previousBoundaries,i.hasKeyModifier(e,"shift"));return n.focus=t.focus,n.boundaries=t.boundaries,e}function G(e){return"keypress"===e.type?!0:"paste"===e.type?!0:n.ARROWS[e.keycode]?!0:n.CODES.pageDown===e.keycode||n.CODES.pageUp===e.keycode?!0:n.CODES.undo!==e.keycode||"meta"!==e.meta&&"ctrl"!==e.meta&&"shift"!==e.meta?!1:!0}function z(n){var t=n.selection;if(!n.preventSelection&&!t.dragging){var r=n.type;if("mouseup"===r||"click"===r||"dblclick"===r)return void e.setStyle(t.caret,"display","block");t=V(t,t.boundaries[0],t.boundaries[1],t.focus);var o="start"===t.focus?t.boundaries[0]:t.boundaries[1];return G(n)&&F(o),t}}function V(n,r,o,i){var a="start"===i?r:o,s=f.container(a);return e.isEditableNode(s)?(g(n.caret,a),t.extend(n.caret.style,N(U(s,n))),f.select(r,o),n.blinking.start(),t.merge(n,{boundaries:[r,o],focus:i})):(e.setStyle(n.caret,"display","none"),a)}var q={};q.up=m.partial(A,"up"),q.down=m.partial(A,"down"),q.left=q["alt+left"]=q["shift+left"]=q["ctrl+left"]=m.partial(_,"left"),q.right=q["alt+right"]=q["shift+right"]=q["ctrl+right"]=m.partial(_,"right"),q.pageUp=q["meta+up"]=m.partial(y,"up"),q.pageDown=q["meta+down"]=m.partial(y,"down"),q.end=q["meta+right"]=x,q.home=q["meta+left"]=R;var Y={keydown:w,keypress:C,"aloha.dblclick":O,"aloha.tplclick":I,"aloha.mouseup":L,mouseup:L,mousedown:B,dragover:k,drop:k,resize:D,paste:P};return{show:g,select:V,focus:F,update:z,handleSelections:W,Context:M,hideCarets:h,unhideCarets:v}}),define("aloha/dragdrop",["./dom","./maps","./events","./editing","./boundaries","./selections"],function(e,n,t,r,o,i){function a(e){return n.merge({},h,e)}function s(n){if(!e.isElementNode(n))return!1;var t=n.getAttribute("draggable");return"false"===t?!1:"true"===t?!0:"IMG"===n.nodeName?!0:"A"===n.nodeName&&n.getAttribute("href")}function u(n,t,o){var i=o.previousSibling,a=r.insert(n,t,o);return i&&i.nextSibling&&e.merge(i,i.nextSibling),[a,a]}function l(e){e.nativeEvent.dataTransfer.setData(e.dnd.data[0],e.dnd.data[1])}function d(e,n,t){var r=i.hideCarets(t),a=o.fromPosition(e,n,t);return i.unhideCarets(r),a}function c(e){var n=e.nativeEvent;e.selection.boundaries=d(n.clientX+m,n.clientY+m,n.target.ownerDocument),t.preventDefault(n)}function f(e){var n=e.nativeEvent;e.selection.boundaries=d(n.clientX+m+8,n.clientY+m,n.target.ownerDocument),e.selection.boundaries&&(e.selection.boundaries=u(e.selection.boundaries[0],e.selection.boundaries[1],e.dnd.element)),t.stopPropagation(n),t.preventDefault(n)}function p(e){return e.dnd&&v[e.type]&&v[e.type](e),e}var m=-10,h={dropEffect:"none",element:null,target:null,data:["text/plain",""]},v={dragstart:l,dragover:c,drop:f};return{handleDragDrop:p,Context:a,isDraggable:s}}),define("aloha/undo",["./arrays","./maps","./dom","./mutation","./boundaries","./functions","./ranges","./content","./traversing"],function(e,n,t,r,o){function i(e,n){if(e!==n)throw Error("assertion error "+e+" !== "+n)}function a(e,n){if(e===n)throw Error("assertion error "+e+" === "+n)}function s(e){i(e,!1)}function u(e){i(e,!0)}function l(){throw Error()}function d(e){return[e.parentNode,t.nodeIndex(e)]}function c(e){return t.nodeAtOffset(e[0],e[1])}function f(e){return e=o.normalize(e),o.isNodeBoundary(e)?o.isAtStart(e)?null:t.nthChild(e[0],e[1]-1):e[0]}function p(e){return e=o.normalize(e),o.isNodeBoundary(e)?o.isAtEnd(e)?null:t.nthChild(e[0],e[1]):e[0].nextSibling}function m(e){e=o.normalize(e);var n=f(e),r=0;for(o.isNodeBoundary(e)||(r+=e[1],n=n.previousSibling);n&&t.isTextNode(n);)r+=t.nodeLength(n),n=n.previousSibling;return r}function h(e,t){t=n.merge({maxCombineChars:20,maxHistory:1e3},t);var r={elem:e,observer:null,stack:[],frame:null,opts:t,history:[],historyIndex:0};return r.observer=!t.noMutationObserver&&window.MutationObserver?on():an(),r}function v(e,n,t){return{changes:n,meta:e,selection:t}}function g(n,t){return e.equal(n,t,e.equal)}function N(e,n,t){e.push([t,n])}function E(e,n){for(var r=[];n&&e!==n;){var o=n.parentNode;if(!o)return[];N(r,o.nodeName,t.normalizedNodeIndex(n)),n=o}return r.reverse(),r}function b(n,r){for(var s=0;s<r.length-1;s++){var l=r[s];i(l[1],n.nodeName),n=t.normalizedNthChild(n,l[0])}var d=e.last(r),c=d[0];if(n=t.nextWhile(n,t.isEmptyTextNode),i(d[1],n.nodeName),t.isTextNode(n)){for(a(c,0);c>t.nodeLength(n);)u(t.isTextNode(n)),c-=t.nodeLength(n),n=n.nextSibling;t.isTextNode(n)||(i(c,0),n=n.parentNode,c=t.nodeIndex(n))}else c=t.realFromNormalizedIndex(n,c);return o.normalize([n,c])}function S(e,n){var r=E(e,n),o=t.normalizedNumChildren(n);return N(r,n.nodeName,o),r}function T(e,n){n=o.normalize(n);var r,i=m(n);if(i){var a=f(n);a=t.prevWhile(a,t.isEmptyTextNode),r=E(e,a),N(r,"#text",i)}else r=o.isAtEnd(n)?S(e,n[0]):E(e,p(n));return r}function y(e,n){n=o.normalize(n);var r=p(n);m(n)&&(r=t.nextWhile(r,t.isTextNode));var i;return i=r?E(e,r):S(e,n[0])}function A(e,n){return T(e,d(n))}function _(e,n){if(!n)return null;var t=T(e,o.fromRangeStart(n)),r=T(e,o.fromRangeEnd(n));return t&&r?{start:t,end:r}:null}function x(e,n){if(n.opts.noObserve)e.observer.discardChanges();else{var t=e.observer.takeChanges();t.length&&n.records.push({changes:t})}}function R(e,n,t,r){(r.opts.partitionRecords&&!r.opts.noObserve||!!t.opts.noObserve!=!!r.opts.noObserve)&&x(e,n)}function C(e){e.frame&&(e.observer.disconnect(),e.frame=null)}function w(e,t){t=t||{};var r=e.frame,o=e.observer,i=e.elem,a=t.noObserve||r&&r.opts.noObserve,s={opts:n.merge(t,{noObserve:a}),records:[],oldRange:_(i,t.oldRange),newRange:null};r?(R(e,r,s,r),e.stack.push(r)):o.observeAll(i),e.frame=s}function O(e,n){var t=e.frame,r=e.stack.pop();r?R(e,t,t,r):(x(e,t),C(e));var o=t.opts.noObserve;return s(!(o||!n||!n.changes)),o&&n&&n.changes&&n.changes.length&&t.records.push({changes:n.changes}),t.newRange=_(e.elem,n&&n.newRange),r&&(r.records.push({frame:t}),e.frame=r),t}function I(e,n,t){w(e,n);var r;return r=t(),O(e,r)}function L(e,t,r){var o=I(e,n.merge(t,{noObserve:!0}),r),i=e.frame;return i&&i.records.pop(),o}function B(e,n,t){return{type:e,path:n,content:t}}function k(e,n){return B("insert",e,n)}function D(e,n){return B("delete",e,n)}function P(e,r,o){var i=[];return n.forEach(o,function(e){var n=e.name,o=e.ns;i.push({name:n,ns:o,oldValue:e.oldValue,newValue:t.getAttrNS(r,o,n)})}),{type:"update-attr",path:e,attrs:i}}function H(e,n){return{type:"update-range",oldRange:e,newRange:n}}function M(e,n,t){return{type:An,node:e,target:n,prevSibling:t,contained:[],updateAttr:null,updateText:null}}function F(e,n,t){return{type:_n,records:e,target:n,prevSibling:t}}function U(e){return{type:bn,node:e,contained:[]}}function W(e){return{type:Sn,node:e,attrs:{}}}function G(e,n){return{type:Tn,node:e,oldValue:n}}function z(e,n,r,o){e.forEach(function(e){var i=e.node,a=t.ensureExpandoId(i),u=e.type;if(An===u){var d=e.prevSibling,c=e.target,f=d?d:c,p=d?r:o,m=t.ensureExpandoId(f),h=p[m]=p[m]||[];n[a]?delete n[a]:h.push(e);var v=r[a];if(v){if(delete r[a],!h.length&&v.length){var g=v[0];g.prevSibling=d,g.target=c}p[m]=h.concat(v)}}else bn===u?(s(!!n[a]),n[a]=e):l()})}function V(e){return _n===e.type?e.records:[e]}function q(e,n){var r=n.prevSibling,o=n.target,i=e.node;return r?r===i||t.contains(r,i)?!0:!t.followedBy(r,i)&&!t.contains(i,r):o===i||t.contains(o,i)?!1:!t.followedBy(o,i)&&!t.contains(i,o)}function Y(e,n){return t.followedBy(e.node,n.node)}function K(e,n){var r=n.prevSibling,o=n.target;return r?t.contains(r,e)?!0:t.contains(e,r)?!1:t.followedBy(e,r):e===o?!1:t.contains(o,e)||t.contains(e,o)?!1:t.followedBy(e,o)}function j(e,n){var r=e.prevSibling,o=n.prevSibling,i=e.target,a=n.target;return r?K(r,n):o?!K(o,e):t.followedBy(i,a)}function X(e,n){var t,r=yn&e.type,o=yn&n.type;return r&&o?t=j(e,n):r||o?!r&&o?t=q(e,n):r&&!o&&(t=!q(n,e)):t=Y(e,n),t?-1:1}function Z(e){e.sort(X),e.forEach(function(e){V(e).forEach(function(e){e.contained&&yn&e.type&&Z(e.contained)})})}function Q(e,n){var r={};n.forEach(function(e){V(e).forEach(function(e){var n=e.type;if(n&yn||n===bn){var o=t.ensureExpandoId(e.node),i=r[o]||[];i.push(e),r[o]=i}})});var o=t.ensureExpandoId(e);s(!!r[o]);var i=U(e);return r[o]=[i],n.forEach(function(e){var n=An&e.type?e.target:e.node.parentNode,o=t.upWhile(n,function(e){return!r[t.ensureExpandoId(e)]});if(o){var i=r[t.ensureExpandoId(o)];i.forEach(function(n){n.contained.push(e)})}}),i.contained}function $(e,r,o,i){function a(e){var n=t.ensureExpandoId(e.node);An===e.type&&(e.updateAttr=o[n],e.updateText=i[n]),delete o[n],delete i[n]}var s={},u={},l={};z(r,l,s,u);var d=n.vals(s).concat(n.vals(u));d=d.filter(function(e){return e.length});var c=d.map(function(e){var n=e[0];return e.forEach(a),F(e,n.target,n.prevSibling)}),f=n.vals(l);f.forEach(a);var p=Q(e,c.concat(f).concat(n.vals(o)).concat(n.vals(i)));return Z(p),p}function J(e,n,r){var o,i,a=n.prevSibling;if(a){var s=t.nodeIndex(a)+1;i=[a.parentNode,s],o=r?y(e,i):T(e,i)}else{var u=n.target;i=[u,0],o=r?y(e,i):T(e,i)}return o}function en(e){var r,o=e.node;if(t.isTextNode(o)){var i=e.updateText;r=i?o.ownerDocument.createTextNode(i.oldValue):t.clone(o)}else{r=t.clone(o);var a=e.updateAttr;a&&n.forEach(a.attrs,function(e){t.setAttrNS(r,e.ns,e.name,e.oldValue)})}return r}function nn(e,n,r,o){var i=null,a=null;o.forEach(function(o){var s,u,d=o.type;if(_n===d){a=null,s=e.concat(J(n,o));var c=e.concat(J(n,o,!0)),f=null;o.records.forEach(function(e){var n=e.contained;n.length&&(nn(c,e.node,r,n),f=null);var t=en(e);f?f.push(t):(f=[t],r.push(D(s,f)))})}else bn===d?(u=o.node,s=e.concat(A(n,u)),a&&a===u.previousSibling?i.push(t.clone(u)):(i=[t.clone(u)],r.push(k(s,i))),a=u):Sn===d?(a=null,u=o.node,s=e.concat(A(n,u)),r.push(P(s,u,o.attrs))):Tn===d?(a=null,u=o.node,s=e.concat(A(n,u)),r.push(D(s,[u.ownerDocument.createTextNode(o.oldValue)])),r.push(k(s,[t.clone(u)]))):l()})}function tn(n,r){var o={},i={},a=[];r.forEach(function(n){var r,s=n.target,u=n.oldValue,d=n.type;if("attributes"===d){var c=n.attributeName,f=n.attributeNamespace;r=t.ensureExpandoId(s);var p=o[r]=o[r]||W(s,{}),m=p.attrs,h={oldValue:u,name:c,ns:f},v=c+" "+f;m[v]=m[v]||h}else if("characterData"===d)r=t.ensureExpandoId(s),i[r]=i[r]||G(s,u);else if("childList"===d){var g=n.previousSibling;e.coerce(n.removedNodes).forEach(function(e){a.push(M(e,s,g))}),e.coerce(n.addedNodes).forEach(function(e){a.push(U(e))})}else l()});var s=$(n,a,o,i),u=[],d=[];return nn(d,n,u,s),u}function rn(e,n){var r=[];N(r,n.nodeName,0);var o=[];return o.push(D(r,t.children(e))),o.push(k(r,t.children(n))),o}function on(){function e(e){var n={childList:!0,attributes:!0,characterData:!0,subtree:!0,attributeOldValue:!0,characterDataOldValue:!0};i.observe(e,n),r=e}function n(){var e=o.concat(i.takeRecords());return o.length=0,tn(r,e)}function t(){r=null,o.length=0,i.disconnect(),i=null}var r=null,o=[],i=new MutationObserver(function(e){o=o.concat(e)});return{observeAll:e,takeChanges:n,discardChanges:n,disconnect:t}}function an(){function e(e){i=e,a=t.clone(e)}function n(){if(t.isEqualNode(a,i))return[];var e=a,n=t.clone(i);return a=n,rn(e,n)}function r(){a=t.clone(i)}function o(){i=null,a=null}var i=null,a=null;
return{observeAll:e,takeChanges:n,discardChanges:r,disconnect:o}}function sn(e,n,a,s,u){var d,m,h,v=n.type;if("update-attr"===v)d=b(e,n.path),m=p(d),n.attrs.forEach(function(e){t.setAttrNS(m,e.ns,e.name,e.newValue)});else if("update-range"===v){var g=n.newRange;if(a&&g){var N=b(e,g.start),E=b(e,g.end);o.setRange(a,N,E)}}else"insert"===v?(d=b(e,n.path),n.content.forEach(function(e){var n=t.clone(e);t.isTextNode(n)&&u.push(n),d=r.insertNodeAtBoundary(n,d,!0,s)})):"delete"===v?(d=b(e,n.path),d=r.splitBoundary(d,s),m=c(d),h=m.parentNode,n.content.forEach(function(e){var n;if(t.isTextNode(e))for(var o=t.nodeLength(e);o;){i(m.nodeName,e.nodeName);var a=t.nodeLength(m);if(o>=a)n=m.nextSibling,r.removePreservingRanges(m,s),o-=a,m=n;else{d=r.splitBoundary([m,o],s);var l=f(d),c=p(d);r.removePreservingRanges(l,s),o=0,u.push(c),m=c}}else n=m.nextSibling,i(m.nodeName,e.nodeName),r.removePreservingRanges(m,s),m=n})):l()}function un(e,n,t){var o=[];n.forEach(function(n){sn(e,n,null,t,o)}),o.forEach(function(e){r.joinTextNode(e,t)})}function ln(e,n,t,r){un(e,n.changes,r),t&&n.selection&&sn(e,n.selection,t,r,[])}function dn(e){var t,r=e.type;return"update-attr"===r?t=n.merge(e,{attrs:e.attrs.map(function(e){return n.merge(e,{oldValue:e.newValue,newValue:e.oldValue})})}):"update-range"===r?t=n.merge(e,{oldRange:e.newRange,newRange:e.oldRange}):"insert"===r?t=n.merge(e,{type:"delete"}):"delete"===r?t=n.merge(e,{type:"insert"}):l(),t}function cn(e){var n=e.changes.slice(0).reverse().map(dn);return v(e.meta,n,dn(e.selection))}function fn(e,n){var t=[];return n.records.forEach(function(n){var r,o=n.frame;r=o?fn(e,o):n.changes,t=t.concat(r)}),t}function pn(e,n,t){var r=H(n.oldRange,n.newRange);return v(n.opts.meta,t,r)}function mn(e,n){var t=fn(e,n);return pn(e,n,t)}function hn(e,n){var t=[];return n.records.forEach(function(r){var o,i=r.frame;if(i){var a=fn(e,i);o=pn(e,i,a)}else o=pn(e,n,r.changes);t.push(o)}),t}function vn(n,r,o){var i=n.changes,a=r.changes;if(!i.length||!a.length)return null;var s=n.meta&&n.meta.type,u=r.meta&&r.meta.type;if("typing"!==s&&"enter"!==s||"typing"!==u)return null;var l=i[0],d=a[0],c=l.path,f=d.path,p=e.last(c),m=e.last(f);if(p&&"#text"!==p[1]&&(p=["#text",0],c=c.concat([p])),"insert"!==l.type||l.type!==d.type||"#text"!==p[1]||p[1]!==m[1]||1!==l.content.length||1!==d.content.length||!t.isTextNode(l.content[0])||!t.isTextNode(d.content[0])||o.maxCombineChars<=t.nodeLength(l.content[0])||p[0]+t.nodeLength(l.content[0])!==m[0]||!g(c.slice(0,c.length-1),f.slice(0,f.length-1)))return null;var h=t.clone(l.content[0]);h.insertData(t.nodeLength(h),d.content[0].data);var N=k(c,[h]),E=n.selection.oldRange,b=r.selection.newRange,S=H(E,b);return v(n.meta,[N],S)}function gn(n){s(!!n.stack.length);var t=n.history,r=n.historyIndex,o=n.frame;x(n,o);var i=hn(n,o);if(i.length){t.length=r;var a=e.last(t);if(1===i.length&&a&&!n.interrupted){var u=vn(a,i[0],n.opts);u&&(t.pop(),i=[u])}n.interrupted=!1,t=t.concat(i);var l=n.opts.maxHistory;t.length>l&&(t=t.slice(t.length-l,t.length)),o.records=[],n.history=t,n.historyIndex=t.length}}function Nn(e,n,t){gn(e);var r=e.history,o=e.historyIndex;if(o){o-=1;var i=r[o],a=cn(i);L(e,{meta:{type:"undo"}},function(){ln(e.elem,a,n,t)}),e.historyIndex=o}}function En(e,n,t){gn(e);var r=e.history,o=e.historyIndex;if(o!==r.length){var i=r[o];o+=1,L(e,{meta:{type:"redo"}},function(){ln(e.elem,i,n,t)}),e.historyIndex=o}}var bn=0,Sn=1,Tn=2,yn=4,An=yn,_n=yn+1;return{Context:h,enter:w,close:C,leave:O,capture:I,pathFromBoundary:T,changeSetFromFrame:mn,inverseChangeSet:cn,applyChangeSet:ln,advanceHistory:gn,makeInsertChange:k,undo:Nn,redo:En}}),define("aloha/editables",["./dom","./maps","./undo","./content","./boundaries"],function(e,n,t,r,o){function i(n,t){return n.editables[e.ensureExpandoId(t)]}function a(n,t){var r=o.container(t),a=e.upWhile(r,function(t){return!n.editables[e.ensureExpandoId(t)]});return a&&i(n,a)}function s(n){e.addClass(n,"aloha-editable"),e.getStyle(n,"min-height")||e.setStyle(n,"min-height","1em");var r=t.Context(n),o=e.ensureExpandoId(n),i={id:o,elem:n,undoContext:r};return i}function u(e,n){delete e.editables[n.id]}function l(e,n){e.editables[n.id]=n}function d(e){t.close(e.undoContext)}function c(r,o,i){var a=s(o);return e.setStyle(o,"cursor","text"),a.settings=n.merge({},p,i),a.settings.disallowedNodes=n.fillKeys({},a.settings.disallowedNodes,!0),l(r,a),t.enter(a.undoContext,{meta:{type:"external"},partitionRecords:!0}),a}function f(e,n){var t=i(e,n);return d(t),u(e,t),t}var p={defaultBlock:"p",allowedStyles:r.allowedStyles(),allowedAttributes:r.allowedAttributes(),disallowedNodes:r.disallowedNodes(),nodeTranslations:r.nodeTranslations()};return{Editable:s,fromElem:i,fromBoundary:a,assocIntoEditor:l,dissocFromEditor:u,close:d,create:c,destroy:f}}),define("aloha/blocks",["./dom","./events","./dragdrop","./browsers","./editables"],function(e,n,t,r){function o(e){return t.Context({dropEffect:"copy",element:e.cloneNode(!0),target:e,data:["text/html",e.outerHTML]})}function i(e){return t.Context({dropEffect:"move",element:e,target:e,data:["text/html",e.outerHTML]})}function a(n){return"IMG"===n.nativeEvent.target.nodeName||e.hasClass(n.nativeEvent.target,n.editable.settings.BLOCK_CLASS)}function s(n){var t=n.editable.elem.querySelectorAll(".aloha-block,img");[].forEach.call(t,function(n){n.setAttribute("contentEditable","false"),e.setStyle(n,"cursor",r.VENDOR_PREFIX+"grab")})}function u(e){var r=e.nativeEvent.target;a(e)&&t.isDraggable(r)&&(e.dnd=n.hasKeyModifier(e,"ctrl")?o(r):i(r))}function l(n){a(n)&&p.forEach(function(t){e.setStyle(n.dnd.target,t[0],t[1]),e.setStyle(n.dnd.element,t[0],t[1])})}function d(n){a(n)&&p.forEach(function(t){e.setStyle(n.dnd.target,t[0],""),e.setStyle(n.dnd.element,t[0],"")})}function c(){}function f(e){return m[e.type]&&m[e.type](e),e}var p=[[r.VENDOR_PREFIX+"transition",r.VENDOR_PREFIX+"transform 0.2s ease-out"],[r.VENDOR_PREFIX+"transform","scale(0.9)"],["opacity","0.5"]],m={aloha:s,mousedown:u,dragstart:l,dragend:d,dragover:c};return{handleBlocks:f}}),define("aloha/colors",[],function(){function e(e){return"string"==typeof e[0]?"#"+e.join(""):4===e.length?"rgba("+e.join(",")+")":"rgb("+e.join(",")+")"}function n(e,n){return i(e)===i(n)}function t(e){var n,t,r;return 4===e.length?(n=e.substr(1,1),t=e.substr(2,1),r=e.substr(3,1),n+=n,t+=t,r+=r):(n=e.substr(1,2),t=e.substr(3,2),r=e.substr(5,2)),[n,t,r]}function r(e){return e.reduce(function(e,n){var t=parseInt(n,10).toString(16);return e.concat(1===t.length?t+t:t)},[])}function o(e){return t(e).reduce(function(e,n){return e.concat(parseInt(n,16))},[])}function i(e){var n=e.match(u);switch(n&&n[1]){case"#":return"#"+t(n[0]).join("");case"rgb":case"rgba":return"#"+r(n[2].split(l)).join("")}}function a(e){var n=e.match(u);switch(n&&n[1]){case"#":return o(n[0]);case"rgb":case"rgba":return n[2].split(l).reduce(function(e,n){return e.concat(parseInt(n,10))},[])}}function s(e,n,t){var r=n[0]-e[0],o=n[1]-e[1],i=n[2]-e[2];return[e[0]+Math.round(r*t),e[1]+Math.round(o*t),e[2]+Math.round(i*t)]}var u=/^(#|rgba?|hsl)\(?([^\(\)]+)/i,l=/\s*,\s*/;return{hex:i,rgb:a,cross:s,equals:n,serialize:e}}),define("aloha/image/image-selection",["../boundaries"],function(e){function n(e){return"IMG"===e.nodeName}function t(t){for(var r=[],o=e.nextNode(t[0]),i=e.prevNode(t[1]),a=t[0];o&&o!==i;)n(o)&&r.push(o),a=e.next(a),o=e.container(a);return n(i)&&r.push(i),r}return{imagesFromBoundaries:t}}),define("aloha/mutation-trees",["./dom","./paths","./arrays","./record","./boromir","./boundaries","./functions"],function(e,n,t,r,o,i,a){function s(){var e=document.createElement("code");e.innerHTML="|";var n=o(e);return n.isMarker=!0,n}function u(e){return!0===e.isMarker}function l(e,n){var t=document,r=o(t.createElement("q")).children(n);return r.isFragmentedText=!0,r.original=e,r}function d(e){return"Q"===e.name()}function c(n){return d(n)?l(n.original,n.children):o(e.cloneShallow(n.domNode()))}function f(e,n){if(0===n.length)return[[],[]];var t,r=n[0],o=n.slice(1);if(0===o.length){if(p(e)){var i=e.text();return[i.substr(0,r),i.substr(r)]}return r=v(e,r),t=e.children(),[t.slice(0,r),t.slice(r)]}r=v(e,r),t=e.children();var a=t[r],s=c(a),u=c(a),l=f(a,o);return p(a)?(s=s.text(l[0]),u=u.text(l[1])):(s=s.children(l[0]),u=u.children(l[1])),[t.slice(0,r).concat(s),[u].concat(t.slice(r+1))]}function p(e){return"#text"===e.name()}function m(e,n,t,r){if(p(t)){var o=t.text();return[c(t).text(o.substr(0,e))].concat(r||[]).concat(c(t).text(o.substr(e+n)))}var i=t.children();return i.slice(0,e).concat(r||[]).concat(i.slice(e+n))}function h(e,n){for(var t,r,o=e.children(),i=o.length,a=n,s=0;i>s;)if(r=o[s],u(r))s++;else{if(t=a-r.text().length,0===t)return[s+1];if(0>t)return[s,a];s++,a=t}throw"Text offset out of bounds"}function v(e,n){if(p(e))return n;var t=e.children(),r=t.length;if(n>=r)return n;for(var o=0,i=0;r>i;){if(!u(t[i])){if(o===n)return i;o++}i++}return i}function g(e,n,t){if(p(e))return m(n,0,e,t);if(d(e)){var r=h(e,n);if(n=r[0],2===r.length){var o=e.children()[n],i=m(r[1],0,o,t);return e.children(m(n,1,e,i))}}else n=v(e,n);return e.children(m(n,0,e,t))}function N(e,n,t){var r=n.slice(1),o=n[0];if(0===r.length)return t(e,o);o=v(e,o);var i=e.children()[o],a=N(i,r,t),s=m(o,1,e,a);return e.children(s)}function E(e,n){var t=g(e,n,s());return p(e)?l(e,t):e}function b(e,n){return N(e,n,E)}function S(e,n){for(var t,r=e.length,o=0,i=0,a=0;r>a;){if(o===n)return i;t=e[a],u(t)||(o+=t.text().length),i++}}function T(e,n){var t=n.reduce(function(e,n){return e.concat(n.text())},[]).join("");console.log(t);var r=document;return e.original&&e.original.text()===t?e.original:o(r.createTextNode(t)).text(t)}function y(e,n){if(d(e)){n=S(e.children(),n);var t=m(n,1,e);if(t.length>0&&!t.some(u))return T(e,t)}return e.children(m(n,1,e))}function A(e,n){var t=n.slice(1),r=n[0];if(0===t.length)return y(e,r);var o=e.children()[r],i=A(o,t),a=m(r,1,e,i);return e.children(a)}function _(e,n,t){if(n=n||[],t=t||[],p(e))return n;var r=0,o=0,i=e.children(),a=d(e);return i.reduce(function(e,n,i){if(u(n)){var s;return a?s=r:(s=i-o,o++),e.concat([t.concat(s)])}return a&&(r+=n.text().length),_(n,e,t.concat(i-o))},n)}function x(e){var n=_(e);return e=n.reduce(A,e),[e.updateDom(),n]}function R(e,n){var t;for(t=0;t<e.length;t++)if(n[t]!==e[t])return[];return n.slice(t)}function C(e,t){var r=e.ownerDocument.body,s=n.fromBoundary(r,i.fromFrontOfNode(e)),u=(t||[]).map(a.partial(n.fromBoundary,r)),l=u.map(a.partial(R,s)).filter(function(e){return e.length>0});return l.reduce(b,o(e))}function w(e,n){var t=f(e,n);return[e.children(t[0].concat(t[1])),[t[0].length-t[0].filter(u).length]]}function O(e,n,t){if(0===t.length)return e;"map"in t||(t=[t]);var r=t.map(function(e){return e instanceof o?e:o(e)});return N(e,n,function(e,n){return g(e,n,r)})}function I(){throw"Not implemented"}function L(){throw"Not implemented"}function B(){throw"Not implemented"}function k(e){return _(e).reduce(A,e)}return{create:C,split:w,insert:O,wrap:I,remove:L,reduce:B,paths:_,removePaths:k,update:x}}),define("aloha/transform/utils",["../dom","../functions","../html","../arrays","../content"],function(e,n,t,r,o){function i(e,n){return e[n.nodeName]}function a(n,t,o){var i,a,s=[],u=n.length;for(a=0;u>a;a++){for(i=[];u>a&&t(n[a]);)i.push(n[a]),a++;i.length>0&&(s.push(i[0].ownerDocument.createElement(o)),e.move(i,r.last(s))),u>a&&s.push(n[a])}return s}function s(n){return t.isRendered(n)?!e.isElementNode(n)||"none"!==e.getStyle(n,"display"):!1}function u(e,t,r,o){var a=t.filter(n.partial(n.complement(i),e.disallowedNodes)),u=a.filter(s);return u.reduce(function(n,t){return r(e,t).forEach(function(t){n=n.concat(o(e,t,r))}),n},[])}function l(n){return n.reduce(function(n,r){var o=e.children(r);1===o.length&&t.hasLinebreakingStyle(o[0])&&(t.isGroupedElement(r)?t.isGroupContainer(o[0])||e.removeShallow(o[0]):!t.isGroupContainer(r)&&t.hasLinebreakingStyle(r)&&(r=o[0]));var i=e.cloneShallow(r);return e.move(l(e.children(r)),i),n.concat(i)},[])}function d(n,r,o){return o(n,r).reduce(function(r,c){if(i(n.disallowedNodes,c)||!s(c))return r;var f=u(n,e.children(c),o,d);"DIV"===c.nodeName&&(f=a(f,t.isInlineNode,n.defaultBlock));var p=e.cloneShallow(c);return e.move(l(f),p),r.concat(p)},[])}function c(n,t){var r=n.ownerDocument.createElement(t);return e.move(e.children(e.clone(n)),r),r}function f(n,t,r){var o=t.ownerDocument.createDocumentFragment();return e.move(d(n,t,r),o),o}function p(e){e=e.replace(/\n/g," "),e=e.replace(/<iframe.*?<\/iframe>/g,"");var n=/<body.*?>/i.exec(e),t=/<\/body.*?>/i.exec(e);if(n&&t){var r=e.indexOf(n[0])+n[0].length,o=e.indexOf(t[0]);return e.slice(r,o)}return e}var m={defaultBlock:"p",allowedStyles:o.allowedStyles(),allowedAttributes:o.allowedAttributes(),disallowedNodes:o.disallowedNodes(),nodeTranslations:o.nodeTranslations()};return{DEFAULT_RULES:m,normalize:f,extract:p,rewrap:c}}),define("aloha/transform/html",["../dom","../arrays","../maps","../functions","../html","../content","./utils"],function(e,n,t,r,o,i,a){function s(n){var t,r=e.children(n),o=e.getStyle(n,"color")||e.getAttr(n,"color"),i=e.getStyle(n,"font-size")||v[e.getAttr(n,"size")],a=e.getStyle(n,"font-family")||e.getAttr(n,"face");return 1===r.length&&e.isElementNode(r[0])?t=r[0]:(t=n.ownerDocument.createElement("span"),e.move(r,t)),o&&e.setStyle(t,"color",o),i&&e.setStyle(t,"font-size",i),a&&e.setStyle(t,"font-family",a),t}function u(e){return e}function l(n){var t=e.getAttr(n,"width"),r=e.getAttr(n,"height");return t&&e.setStyle(n,"width",t),r&&e.setStyle(n,"height",r),n}function d(e,n){return(e["*"]||[]).concat(e[n]||[])}function c(o,i){var a=d(o,i.nodeName),s=t.keys(e.attrs(i)),u=n.intersect(a,s),l=n.difference(s,u);l.forEach(r.partial(e.removeAttr,i))}function f(r,o){var i=d(r,o.nodeName);if(!n.contains(i,"*")){var a=i.reduce(function(n,t){return n[t]=e.getStyle(o,t),n},{});e.removeAttr(o,"style"),t.forEach(a,function(n,t){n&&e.setStyle(o,t,n)})}}function p(n){if(e.hasAttrs(n))return n;var t=n.ownerDocument.createDocumentFragment();return e.move(e.children(n),t),t}function m(n,t){if(t=e.clone(t),e.isTextNode(t))return[t];var r;switch(t.nodeName){case"IMG":r=l(t);break;case"FONT":r=t;do r=s(r);while("FONT"===r.nodeName);break;case"CENTER":r=u(t);break;default:r=t}if(e.isFragmentNode(r))return[r];c(n.allowedAttributes,r),f(n.allowedStyles,r),"SPAN"===r.nodeName&&(r=p(r));var o,a=e.children(r);for(o=0;o<a.length;o++)if(!i.allowsNesting(r.nodeName,a[o].nodeName))return a;return[r]}function h(n,t,r){r||(r=a.DEFAULT_RULES);var i=t.createDocumentFragment();return e.move(o.parse(a.extract(n),t),i),e.outerHtml(a.normalize(r,i,m))}var v={1:"0.63em",2:"0.82em",3:"1em",4:"1.13em",5:"1.5em",6:"2em",7:"3em"};return{transform:h}}),define("aloha/transform/plain",[],function(){function e(e){var n=e.split(/\n/).reduce(function(e,n){return e.concat("<p>",n.trim()||"<br>","</p>")},[]);return n.join("")}return{transform:e}}),define("aloha/transform/ms-word/lists",["../../dom","../../misc","../../arrays","../../functions"],function(e,n,t,r){function o(n){if(!n.firstChild)return null;var t=N.exec(e.text(n.firstChild));return t?(t=/(\w+)/i.exec(t[0]),t?t[1]:null):null}function i(e){var n=o(e);if(!n)return{};var t,r;return/\d+/.test(n)?(t=n,r="1"):r=/i/i.test(n)?/I/.test(n)?"I":"i":/[A-Z]/.test(n)?"A":"a",{start:t,type:r}}function a(n){if(!n.firstChild)return!1;var t=e.getStyle(n.firstChild,"fontFamily");return"Wingdings"===t||"Symbol"===t?!1:null!==o(n)}function s(n){return"SPAN"===n.nodeName&&E.test(e.getAttr(n,"style"))?!0:!e.isTextNode(n)&&s(n.firstChild)}function u(n){return"P"!==n.nodeName?!1:e.hasClass(n,"MsoListParagraph")||e.hasClass(n,"MsoListParagraphCxSpFirst")||e.hasClass(n,"MsoListParagraphCxSpMiddle")||e.hasClass(n,"MsoListParagraphCxSpLast")}function l(n){return"P"===n.nodeName&&e.hasClass(n,"MsoListParagraphCxSpFirst")}function d(n){return"P"===n.nodeName&&e.hasClass(n,"MsoListParagraph")}function c(n){return"P"===n.nodeName&&e.hasClass(n,"MsoListParagraphCxSpLast")}function f(e){return e.firstChild?s(e.firstChild):!1}function p(t){var r=a(t)?"ol":"ul",o=t.ownerDocument.createElement(r);if("ul"===r)return o;var s=i(t);return n.defined(s.start)&&e.setAttr(o,"start",s.start),n.defined(s.type)&&e.setAttr(o,"type",s.type),o}function m(n){var t=b.exec(e.getAttr(n,"style"));return t&&t[1]?parseInt(t[1],10):1}function h(n,t){var r=p(n.node),o=n.items.reduce(function(r,o){var i=o.reduce(function(e,n){return e.concat(n[t]?h(n,t):n)},[]),a=n.node.ownerDocument.createElement("li");return e.copy(i,a),r.concat(a)},[]);return e.move(o,r),r}function v(n,o){var i,a,l,d,c,p,v,g,N="_aloha"+(new Date).getTime();for(i=0;i<n.length;i++){if(d=o(n[i]),g=m(d),c||(p=c={parent:null,level:1,node:d,items:[]},c[N]=!0),g>c.level)for(a=c.level;g>a;a++)c={parent:c,level:a+1,node:d,items:[]},c[N]=!0,v=t.last(c.parent.items),v||(v=[],c.parent.items.push(v)),v.push(c);if(g<c.level)for(a=g,l=c.level;l>a&&c.parent;a++)c=c.parent;u(d)&&f(d)?c.items.push(e.children(d).filter(r.complement(s))):(v=t.last(c.items),v||(v=[],c.items.push(v)),v.push(d))}return p&&h(p,N)}function g(n){var r,o,i,a,s,u=e.children(n),f=[],p=u.length;for(r=0;p>r;r++)a=u[r],d(a)?f.push(v([a],g)):l(a)?(s=e.nodeAndNextSiblings(a,c),i=t.last(s).nextSibling,i&&s.push(i),o=v(s,g),o&&(f.push(o),r+=s.length-1)):f.push(g(a));var m=e.clone(n,!1);return e.move(f,m),m}var N=new RegExp("^\\s*((?:[0-9]{1,3}|[a-zA-Z]{1,5})+[\\.\\)])+\\s*$"),E=/mso-list:\s*Ignore/i,b=/mso-list:.*?level(\d+)/i;return{transform:g}}),define("aloha/transform/ms-word/tables",["../../dom"],function(e){function n(n){var t=[];return n.forEach(function(n){if("TD"===n.nodeName){var r=e.children(n);n=n.ownerDocument.createElement("th"),e.copy(r,n)}return t.push(n)}),t}function t(n){return"TR"===n.nodeName&&o.test(e.getAttr(n,"style"))}function r(o){var i,a,s,u=e.children(o),l=[];for(s=0;s<u.length;s++)i=r(u[s]),t(i)&&(i=e.clone(i),a=e.children(i),a.forEach(e.remove),e.move(n(a),i)),l.push(i);var d=e.clone(o,!1);return e.move(l,d),d}var o=/mso-yfti-irow:\-1;/;return{transform:r}}),define("aloha/transform/ms-word/toc",["../../functions","../../dom","../../arrays","../utils"],function(e,n,t,r){function o(e){var t=d.exec(n.getAttr(e,"class"));return t&&t[1]?parseInt(t[1],10):null}function i(e){return"P"===e.nodeName&&n.hasClass(e,"MsoTocHeading")}function a(e){if(!n.isElementNode(e))return!1;var t=d.exec(n.getAttr(e,"class"));return t?t.length>0:!1}function s(e,t){var r=e.node.ownerDocument.createElement("ul"),o=e.items.reduce(function(r,o){var i=o.reduce(function(e,n){return e.concat(n[t]?s(n,t):n)},[]),a=e.node.ownerDocument.createElement("li");return n.copy(i,a),r.concat(a)},[]);return n.move(o,r),r}function u(e,r){var i,a,u,l,d,c,f,p,m="_aloha"+(new Date).getTime();for(i=0;i<e.length;i++){if(l=r(e[i]),p=o(l),d){if(p>d.level)for(a=d.level;p>a;a++)d={parent:d,level:a+1,node:l,items:[]},d[m]=!0,f=t.last(d.parent.items),f||(f=[],d.parent.items.push(f)),f.push(d);else if(p<d.level)for(a=p,u=d.level;u>a&&d.parent;a++)d=d.parent}else c=d={parent:null,level:1,node:l,items:[]},d[m]=!0;d.items.push(n.children(l))}return c&&s(c,m)}function l(o){var s,d,c,f,p=e.complement(a),m=n.children(o),h=[],v=m.length;for(s=0;v>s;s++)c=m[s],i(c)?h.push(r.rewrap(c,"h1")):a(c)?(f=t.split(n.nodeAndNextSiblings(c),p)[0],d=u(f,l),d&&(h.push(d),s+=f.length-1)):h.push(l(c));var g=n.clone(o,!1);return n.move(h,g),g}var d=/MsoToc(\d+)/;return{transform:l}}),define("aloha/transform/ms-word",["../dom","../html","../arrays","./ms-word/lists","./ms-word/tables","./ms-word/toc","./utils"],function(e,n,t,r,o,i,a){function s(n){return n.nodeType===e.Nodes.COMMENT||f.test(n.nodeName)}function u(e){var n=e.nodeName.match(p);return n?n[1]:null}function l(n,t){if(s(t))return[];if(e.isTextNode(t))return[e.clone(t)];if(e.hasClass(t,"MsoTitle"))return[a.rewrap(t,"h1")];if(e.hasClass(t,"MsoSubtitle"))return[a.rewrap(t,"h2")];var r=u(t);return r?[a.rewrap(t,r)]:[e.clone(t)]}function d(t,r){var o=r.createElement("div");return e.move(n.parse(t,r),o),null!==o.querySelector('[style*="mso-"],[class^="Mso"]')}function c(t,s,u){u||(u=a.DEFAULT_RULES);var d=n.parse(a.extract(t),s),c=s.createElement("div");e.move(d,c);var f=a.normalize(u,c,l)||c;f=r.transform(f),f=i.transform(f),f=o.transform(f);var p=e.children(f);return 0===p.length?"":p[0].innerHTML}var f=/xml|v\:\w+/i,p=/o\:(\w+)/i;return{transform:c,isMSWordContent:d}}),define("aloha/transform",["./transform/html","./transform/plain","./transform/ms-word"],function(e,n,t){return{html:e.transform,plain:n.transform,msword:t.transform}}),define("aloha/paste",["./dom","./html","./undo","./paths","./arrays","./events","./content","./editing","./mutation","./mutation-trees","./boundaries","./functions","./transform","./transform/ms-word"],function(e,n,t,r,o,i,a,s,u,l,d,c,f,p){function m(e,n){return o.contains(e.clipboardData.types,n)}function h(e,n){return e.clipboardData.getData(n)}function v(t,o,i){var a=d.document(t),u=s.remove(t,o),c=n.parse(i,a);if(0===c.length)return u;var f=a.createElement("div");e.setAttr(f,"contentEditable",!0),e.move(c,f);var p=c[0];if(e.isTextNode(p)||n.isVoidType(p)||n.isGroupContainer(p)||(c=e.children(p).concat(c.slice(1))),0===c.length)return u;var m=u[0],h=e.editingHost(d.container(m)),v=l.create(h,u);return c.forEach(function(e){var n=r.fromBoundary(h,m),t=l.split(v,n,u);v=t[0],n=t[1],v=l.insert(v,n,e,u),m=r.toBoundary(h,n)}),v.updateDom(),u}function g(e,n,t){if(m(e,E.html)){var r=h(e,E.html);return p.isMSWordContent(r,n)?f.html(f.msword(r,n),n,t):f.html(r,n,t)}return m(e,E.plain)?f.plain(h(e,E.plain),n):""}function N(e){if("paste"!==e.type||"undefined"!=typeof e.nativeEvent.clipboardData)return e;i.suppress(e.nativeEvent);var n=g(e.nativeEvent,e.nativeEvent.target.ownerDocument,e.editable.settings);return n?(t.capture(e.editable.undoContext,{meta:{type:"paste"}},function(){e.selection.boundaries=v(e.selection.boundaries[0],e.selection.boundaries[1],n)}),e):e}var E={plain:"text/plain",html:"text/html"};return{handlePaste:N}}),define("aloha/image",["./boundaries","./dom","./image/image-selection","./paste"],function(e,n,t,r){function o(e,t){Object.keys(t).forEach(function(r){n.setAttr(e,r,t[r])})}function i(e,n){var t=n.createElement("img");return o(t,e),t}function a(e,n){var t=e.commonAncestorContainer.ownerDocument,o=i(n,t),a=t.createElement("p");a.appendChild(o);var s=t.createDocumentFragment();s.appendChild(a),r.insertIntoDomFromRange(e,s,{},t)}function s(n,t){var r=e.get(t);r&&a(e.range(r[0],r[1]),n)}function u(n,r){var i=e.fromRange(n),a=t.imagesFromBoundaries(i);a.forEach(function(e){o(e,r)})}function l(n,t){var r=e.get(t);r&&u(e.range(r[0],r[1]),n)}return{insert:s,insertFromRange:a,setAttributesFromRange:u,setAttributes:l}}),define("aloha/markers",["./dom","./misc","./mutation","./arrays","./strings","./ranges","./paths","./boundaries"],function(e,n,t,r,o,i,a,s){function u(n,r){var o=s.container(n),i=s.container(r),a=o.ownerDocument,u=a.createTextNode(e.isTextNode(i)?"]▓":"}▓"),l=a.createTextNode(e.isTextNode(o)?"▓[":"▓{"),d=s.range(n,r);return n=t.splitBoundary(s.fromRangeStart(d),[d]),r=t.splitBoundary(s.fromRangeEnd(d)),e.insert(u,s.nextNode(r),s.isAtEnd(r)),e.insert(l,s.nextNode(n),s.isAtEnd(n)),[n,r]}function l(n){var r=s.container(n),o=r.ownerDocument.createTextNode(s.isTextBoundary(n)?"▓":"█");return n=t.splitBoundary(n),e.insert(o,s.nextNode(n),s.isAtEnd(n)),n}function d(n){function t(n,t){var r;if(0===s){if(r=0,"["!==n&&"{"!==n)throw"end marker before start marker"}else{if(1!==s)throw"Too many markers";if(r=1,"]"!==n&&"}"!==n)throw"start marker before end marker"}if(s+=1,"["===n||"]"===n){var o=t.previousSibling;return o&&e.isTextNode(o)||(o=t.ownerDocument.createTextNode(""),t.parentNode.insertBefore(o,t)),u[r]=[o,o.length],!1}return u[r]=[t.parentNode,e.nodeIndex(t)],!0}function i(n){if(e.isTextNode(n)){var i=n.nodeValue,s=o.splitIncl(i,/[\[\{\}\]]/g);if(r.contains(a,s[0])||!(s.length<2)){var u=!1;s.forEach(function(o,i){u=u||0===i,r.contains(a,o)?u=t(o,n):!u&&n.previousSibling&&e.isTextNode(n.previousSibling)?n.previousSibling.insertData(n.previousSibling.length,o):n.parentNode.insertBefore(n.ownerDocument.createTextNode(o),n)}),n.parentNode.removeChild(n)}}}var a=["[","{","}","]"],s=0,u=[];if(e.walkRec(n,i),2!==s)throw"Missing one or both markers";return u}function c(n,t){var r=!t;t=t||n;var o,i,d=s.commonContainer(n,t),c=e.Nodes.DOCUMENT===d.nodeType?d:d.ownerDocument,f=a.fromBoundary(d,n),p=a.fromBoundary(d,t);if(d.parentNode)i=a.fromBoundary(d.parentNode,s.fromFrontOfNode(d)),o=s.container(a.toBoundary(d.parentNode.cloneNode(!0),i));else{o=d.cloneNode(!0);var m=c.createDocumentFragment(),h=c.createDocumentFragment();e.append(o,h),e.append(h,m),i=[]}if(f=i.concat(f),p=i.concat(p),r?l(a.toBoundary(o,f)):u(a.toBoundary(o,f),a.toBoundary(o,p)),e.Nodes.DOCUMENT_FRAGMENT!==o.nodeType)return o.outerHTML;var v=c.createElement("div");return e.append(o,v),v.innerHTML}function f(e){return[s.raw(e.startContainer,e.startOffset),s.raw(e.endContainer,e.endOffset)]}function p(e){if(n.defined(e.length))return"string"==typeof e[0].nodeName?c(e):c(e[0],e[1]);var t=f(e);return c(t[0],t[1])}return{hint:p,insert:u,extract:d}}),define("aloha/metaview",["./dom"],function(e){function n(n){var t=n.createElement("style");e.setAttr(t,"id","metaview"),e.append(t,n.head),e.append(n.createTextNode(r),t)}function t(t,r){t.ownerDocument.querySelector("style#metaview")||n(t.ownerDocument),r=r||{},r.outline?e.addClass(t,o):e.removeClass(t,o),r.tagname?e.addClass(t,i):e.removeClass(t,i),r.padding?e.addClass(t,a):e.removeClass(t,a)}var r='.✪{outline:5px solid #fce05e;}.✪ td,.✪ th,.✪ b,.✪ i,.✪ u,.✪ p,.✪ ul,.✪ ol,.✪ li,.✪ h1,.✪ h2,.✪ h3,.✪ h4,.✪ h5,.✪ h6,.✪ div,.✪ span{border:1px solid rgba(0,0,0,0.1)}.✪ p,.✪ ul,.✪ ol,.✪ h1,.✪ h2,.✪ h3,.✪ h4,.✪ h5,.✪ h6,.✪ div{border-width:2px}.✪ b{border-color:#f47d43}.✪ i{border-color:#82b5e0}.✪ u{border-color:#bb94b7}.✪ span{border-color:#bb94b7}.✪ code{border-color:#999}.✪ pre{border-color:#999}.✪ ul,.✪ ol{border-color:#91c9cf}.✪ p{border-color:#bdd74b}.✪ h1,.✪ h2,.✪ h3,.✪ h4,.✪ h5,.✪ h6{border-color:#f47d43}.✪✪ td,.✪✪ th,.✪✪ b,.✪✪ i,.✪✪ u,.✪✪ span,.✪✪ pre,.✪✪ code,.✪✪ ul,.✪✪ ol,.✪✪ li,.✪✪ h1,.✪✪ h2,.✪✪ h3,.✪✪ h4,.✪✪ h5,.✪✪ h6,.✪✪ p,.✪✪ div{position:relative}.✪✪ td::before,.✪✪ th::before,.✪✪ b::before,.✪✪ i::before,.✪✪ u::before,.✪✪ p::before,.✪✪ ul::before,.✪✪ ol::before,.✪✪ li::before,.✪✪ h1::before,.✪✪ h2::before,.✪✪ h3::before,.✪✪ h4::before,.✪✪ h5::before,.✪✪ h6::before,.✪✪ div::before,.✪✪ span::before,.✪✪ pre::before,.✪✪ code::before{position:absolute;top:-2px;left:-2px;line-height:8px;font-size:8px;font-weight:bold;font-style:normal;letter-spacing:0.5px;background:#fff;color:#111;opacity:0.5;}.✪✪ td::before{content:"TD"}.✪✪ th::before{content:"TH"}.✪✪ b::before{content:"B"}.✪✪ i::before{content:"I"}.✪✪ u::before{content:"U"}.✪✪ p::before{content:"P"}.✪✪ ul::before{content:"UL"}.✪✪ ol::before{content:"OL"}.✪✪ li::before{content:"LI"}.✪✪ h1::before{content:"H1"}.✪✪ h2::before{content:"H2"}.✪✪ h3::before{content:"H3"}.✪✪ h4::before{content:"H4"}.✪✪ h5::before{content:"H5"}.✪✪ h6::before{content:"H6"}.✪✪ div::before{content:"DIV"}.✪✪ pre::before{content:"PRE"}.✪✪ span::before{content:"SPAN"}.✪✪ code::before{content:"CODE"}.✪✪✪{padding:10px}.✪✪✪ td,.✪✪✪ th,.✪✪✪ b,.✪✪✪ i,.✪✪✪ u,.✪✪✪ p,.✪✪✪ /*xul,.✪✪✪ ol,.✪✪✪*/ li,.✪✪✪ h1,.✪✪✪ h2,.✪✪✪ h3,.✪✪✪ h4,.✪✪✪ h5,.✪✪✪ h6,.✪✪✪ div,.✪✪✪ span{padding:2px 4px;margin:2px;}',o="✪",i="✪✪",a="✪✪✪";return{toggle:t}}),define("aloha/selection-change",["./functions","./arrays","./boundaries","./browsers","./events"],function(e,n,t,r,o){function i(n,t){var i=n.type;r.mozilla&&"mouseup"===i&&o.nextTick(e.partial(t,n))}function a(e,r,o){function a(s){var u=e();u&&!n.equal(r,u,t.equals)?(r=u,o(u,s)):i(s,a)}return a}function s(e,n,t){o.add(e,"selectionchange",n,!0),o.add(e,"keyup",n,!0),o.add(e,"mouseup",n,!0),o.add(e,"touchend",n,!0),o.add(e,"keypress",n,!0),r.webkit||r.msie||!t||o.add(e,"mousemove",n,!0)}function u(e,n,t){o.remove(e,"selectionchange",n,!0),o.remove(e,"keyup",n,!0),o.remove(e,"mouseup",n,!0),o.remove(e,"touchend",n,!0),o.remove(e,"keypress",n,!0),r.webkit||r.msie||!t||o.remove(e,"mousemove",n,!0)}return{handler:a,addHandler:s,removeHandler:u}}),define("aloha/searching",["./dom","./boundaries","./functions"],function(e,n){function t(e){return e.reduce(function(e,n){return e.concat(n.data)},[]).join("")}function r(t,r){for(var o,i=0,a=0;a<t.length;a++){if(o=t[a],i+e.nodeLength(o)>=r)return n.create(o,r-i);i+=o.length}return null}function o(n,t){return t(n,function(n){return!e.isTextNode(n)||e.isEditingHost(n)})}function i(i,a){var s,u=n.nodeBefore(i);u?s=e.nodeLength(u):(u=n.container(i),s=n.offset(i));var l=u;do{if(e.isTextNode(l)){var d=o(l,e.nodeAndPrevSiblings).reverse(),c=t(d),f=c.search(a);if(f>-1){if(u!==l||s>f)return r(d,f);if(f=c.substr(0,s).search(a),f>-1)return r(d,f)}}l=e.backward(l)}while(l&&!e.isEditingHost(l));return null}function a(i,a){var s,u=n.nodeAfter(i);u?s=0:(u=n.container(i),s=n.offset(i));var l=u;do{if(e.isTextNode(l)){var d=o(l,e.nodeAndNextSiblings),c=t(d);l===u&&(c=c.substr(s));var f=c.search(a);if(f>-1)return r(d,s+f)}l=e.forward(l)}while(l&&!e.isEditingHost(l));return null}function s(e,n,t){return"backward"===t?i(e,n):a(e,n)}function u(e,n){return i(e,new RegExp(n+"(?!.*"+n+")"))}function l(e,n){return a(e,new RegExp(n))}return{search:s,forward:l,backward:u}}),define("aloha/typing",["./dom","./keys","./html","./undo","./lists","./events","./arrays","./editing","./strings","./metaview","./mutation","./selections","./traversing","./boundaries","./overrides","./functions"],function(e,n,t,r,o,i,a,s,u,l,d,c,f,p,m,h){function v(e,n,t){var o=p.range(n.selection.boundaries[0],n.selection.boundaries[1]);r.capture(n.editable.undoContext,{meta:{type:e},oldRange:o},function(){return o=t(),{newRange:o}})}function g(n){function r(e){n=d.removeNode(e,n)}for(var o=0;o<n.length;o++)e.climbUntil(p.container(n[o]),r,t.isRendered);return n}function N(e,n){var r=n.selection,o=r.boundaries[0],i=r.boundaries[1];p.equals(o,i)&&(e?i=f.next(i):o=f.prev(o));var a=s.remove(o,f.envelopeInvisibleCharacters(i));return r.formatting=m.joinToSet(r.formatting,m.harvest(p.container(a[0]))),a=g(a),t.prop(p.commonContainer(a[0],a[1])),a}function E(e,n){var r=n.selection,o=r.boundaries;if(!t.isBoundariesEqual(o[0],o[1]))return s.toggle(o[0],o[1],e);var i=m.nodeToState[e];if(!i)return o;var a=m.joinToSet(r.formatting,m.harvest(p.container(o[0])),r.overrides);return r.overrides=m.toggle(a,i,!0),r.boundaries}function b(e,n){e||(n.selection.formatting=m.joinToSet(n.selection.formatting,m.harvest(p.container(n.selection.boundaries[0]))));var t=n.meta.indexOf("shift")>-1?"BR":n.editable.settings.defaultBlock;return s.breakline(n.selection.boundaries[1],t)}function S(e){var n=p.container(e).data,t=p.offset(e);return u.WHITE_SPACE.test(n.substr(t-1,1))}function T(e){var n=p.container(e).data,t=p.offset(e);return u.WHITE_SPACE.test(n.substr(t,1))}function y(n){if(p.isTextBoundary(n))return S(n)||T(n)?" ":" ";var r=p.container(n),o=e.backwardPreorderBacktraceUntil(r,function(n){return e.isTextNode(n)||e.isEditingHost(n)||t.hasLinebreakingStyle(n)});return e.isElementNode(o)?" ":S(p.fromEndOfNode(o))?" ":(o=e.forwardPreorderBacktraceUntil(r,function(n){return e.isTextNode(n)||e.isEditingHost(n)||t.hasLinebreakingStyle(n)}),e.isElementNode(o)?" ":T(p.fromStartOfNode(o))?" ":" ")}function A(e){var n=e.selection.boundaries,t=n[0],r=n[1];return o.isIndentationRange(t,r)?o.indent(t,r):(p.equals(t,r)||(e.selection.boundaries=N(!1,e)),_(e))}function _(n){var o=n.editable,i=n.selection,a=String.fromCharCode(n.keycode),s=i.boundaries[0];if("	"===a)a="        ";else if(" "===a){var u=e.getComputedStyle(e.upWhile(p.container(s),e.isTextNode),"white-space");t.isWhiteSpacePreserveStyle(u)||(a=y(s))}s=m.consume(s,m.joinToSet(i.formatting,i.overrides)),i.overrides=[],i.formatting=[];var l=p.range(s,s),c=r.pathFromBoundary(o.elem,s),f=[o.elem.ownerDocument.createTextNode(a)],h=r.makeInsertChange(c,f);return r.capture(o.undoContext,{noObserve:!0},function(){return d.insertTextAtBoundary(a,s,!0,[l]),{changes:[h]}
}),p.fromRange(l)}function x(e,n){var t=p.range(n.selection.boundaries[0],n.selection.boundaries[1]);return e(n.editable.undoContext,t,[t]),p.fromRange(t)}function R(n){var t=e.editingHost(p.commonContainer(n.selection.boundaries[0],n.selection.boundaries[1]));return t?[p.create(t,0),p.fromEndOfNode(t)]:n.selection.boundaries}function C(e){return"keypress"===e.type&&"alt"!==e.meta&&"ctrl"!==e.meta&&!u.isControlCharacter(String.fromCharCode(e.keycode))}function w(e){return n.shortcutHandler(e.meta,e.keycode,V[e.type]||[])||C(e)&&V.keypress.input}function O(e){var n=e.selection,r=n.boundaries[0],o=n.boundaries[1],a=w(e);return a?(a.preventDefault&&i.preventDefault(e.nativeEvent),a.clearOverrides&&(n.overrides=[],n.formatting=[]),a.mutate&&(a.undo?v(a.undo,e,function(){a.removeContent&&!p.equals(r,o)&&(n.boundaries=N(!1,e)),n.boundaries=a.mutate(e),t.prop(p.commonContainer(n.boundaries[0],n.boundaries[1]))}):n.boundaries=a.mutate(e)),e):e}var I={clearOverrides:!0,preventDefault:!0,undo:"delete",mutate:h.partial(N,!1)},L={clearOverrides:!0,preventDefault:!0,undo:"delete",mutate:h.partial(N,!0)},B={removeContent:!0,preventDefault:!0,undo:"enter",mutate:h.partial(b,!1)},k={removeContent:!0,preventDefault:!0,undo:"enter",mutate:h.partial(b,!0)},D={preventDefault:!0,undo:"bold",mutate:h.partial(E,"B")},P={preventDefault:!0,undo:"italic",mutate:h.partial(E,"I")},H={preventDefault:!0,undo:"underline",mutate:h.partial(E,"U")},M={removeContent:!0,preventDefault:!0,undo:"typing",mutate:_},F={preventDefault:!0,undo:"indent",mutate:A},U={preventDefault:!0,clearOverrides:!0,mutate:R},W={clearOverrides:!0,preventDefault:!0,mutate:h.partial(x,r.undo)},G={preventDefault:!0,clearOverrides:!0,mutate:h.partial(x,r.redo)},z={breakBlock:B,breakLine:k,deleteBackward:I,deleteForward:L,formatBold:D,formatItalic:P,inputText:M,redo:G,undo:W},V={keydown:{},keypress:{},keyup:{}};return V.keydown.up=V.keydown.down=V.keydown.left=V.keydown.right={clearOverrides:!0},V.keydown["delete"]=L,V.keydown.backspace=I,V.keydown.enter=B,V.keydown["shift+enter"]=k,V.keydown["ctrl+b"]=V.keydown["meta+b"]=D,V.keydown["ctrl+i"]=V.keydown["meta+i"]=P,V.keydown["ctrl+u"]=V.keydown["meta+u"]=H,V.keydown["ctrl+a"]=V.keydown["meta+a"]=U,V.keydown["ctrl+z"]=V.keydown["meta+z"]=W,V.keydown["ctrl+shift+z"]=V.keydown["meta+shift+z"]=G,V.keydown.tab=F,V.keypress.input=M,V.keydown["ctrl+0"]={mutate:function(e){return e.editable&&l.toggle(e.editable.elem),e.selection.boundaries}},V.keydown["ctrl+1"]={mutate:function(e){return e.editable&&l.toggle(e.editable.elem,{outline:!0,tagname:!0}),e.selection.boundaries}},V.keydown["ctrl+2"]={mutate:function(e){return e.editable&&l.toggle(e.editable.elem,{outline:!0,tagname:!0,padding:!0}),e.selection.boundaries}},{handleTyping:O,actions:z}}),define("aloha/api",["./arrays","./blocks","./boromir","./boundaries","./browsers","./carets","./colors","./content","./dom","./dragdrop","./editables","./editing","./events","./functions","./html","./image","./keys","./links","./lists","./maps","./markers","./metaview","./mouse","./overrides","./paste","./paths","./record","./selection-change","./selections","./searching","./strings","./transform","./traversing","./typing","./undo","./mutation-trees","./zippers"],function(e,n,t,r,o,i,a,s,u,l,d,c,f,p,m,h,v,g,N,E,b,S,T,y,A,_,x,R,C,w,O,I,L,B,k,D,P){var H={};return H.Boromir=t,H.Record=x,H.arrays={},H.arrays.contains=e.contains,H.arrays.difference=e.difference,H.arrays.equal=e.equal,H.arrays.intersect=e.intersect,H.arrays.last=e.last,H.arrays.coerce=e.coerce,H.arrays.mapcat=e.mapcat,H.arrays.partition=e.partition,H.arrays.some=e.some,H.arrays.someIndex=e.someIndex,H.arrays.split=e.split,H.arrays.unique=e.unique,H.arrays.refill=e.refill,H.blocks={},H.blocks.read=n.read,H.blocks.write=n.write,H.blocks.handleBlocks=n.handleBlocks,H.boundaries={},H.boundaries.get=r.get,H.boundaries.select=r.select,H.boundaries.raw=r.raw,H.boundaries.create=r.create,H.boundaries.normalize=r.normalize,H.boundaries.equals=r.equals,H.boundaries.container=r.container,H.boundaries.offset=r.offset,H.boundaries.document=r.document,H.boundaries.fromRange=r.fromRange,H.boundaries.fromRanges=r.fromRanges,H.boundaries.fromRangeStart=r.fromRangeStart,H.boundaries.fromRangeEnd=r.fromRangeEnd,H.boundaries.fromFrontOfNode=r.fromFrontOfNode,H.boundaries.fromBehindOfNode=r.fromBehindOfNode,H.boundaries.fromStartOfNode=r.fromStartOfNode,H.boundaries.fromEndOfNode=r.fromEndOfNode,H.boundaries.fromPosition=r.fromPosition,H.boundaries.setRange=r.setRange,H.boundaries.setRanges=r.setRanges,H.boundaries.setRangeStart=r.setRangeStart,H.boundaries.setRangeEnd=r.setRangeEnd,H.boundaries.isAtStart=r.isAtStart,H.boundaries.isAtEnd=r.isAtEnd,H.boundaries.isTextBoundary=r.isTextBoundary,H.boundaries.isNodeBoundary=r.isNodeBoundary,H.boundaries.next=r.next,H.boundaries.prev=r.prev,H.boundaries.jumpOver=r.jumpOver,H.boundaries.nextWhile=r.nextWhile,H.boundaries.prevWhile=r.prevWhile,H.boundaries.stepWhile=r.stepWhile,H.boundaries.walkWhile=r.walkWhile,H.boundaries.nextNode=r.nextNode,H.boundaries.prevNode=r.prevNode,H.boundaries.nodeAfter=r.nodeAfter,H.boundaries.nodeBefore=r.nodeBefore,H.boundaries.commonContainer=r.commonContainer,H.boundaries.range=r.range,H.markers={},H.markers.hint=b.hint,H.markers.insert=b.insert,H.markers.extract=b.extract,H.browsers={},H.browsers.chrome=o.chrome,H.browsers.webkit=o.webkit,H.browsers.safari=o.safari,H.browsers.vendor=o.vendor,H.browsers.version=o.version,H.browsers.VENDOR_PREFIX=o.VENDOR_PREFIX,H.colors={},H.colors.hex=a.hex,H.colors.rgb=a.rgb,H.colors.cross=a.cross,H.colors.equals=a.equals,H.colors.serialize=a.serialize,H.content={},H.content.allowsNesting=s.allowsNesting,H.content.allowedStyles=s.allowedStyles,H.content.allowedAttributes=s.allowedAttributes,H.content.disallowedNodes=s.disallowedNodes,H.content.nodeTranslations=s.nodeTranslations,H.dom={},H.dom.Nodes=u.Nodes,H.dom.offset=u.offset,H.dom.cloneShallow=u.cloneShallow,H.dom.clone=u.clone,H.dom.text=u.text,H.dom.children=u.children,H.dom.nthChild=u.nthChild,H.dom.numChildren=u.numChildren,H.dom.nodeIndex=u.nodeIndex,H.dom.nodeLength=u.nodeLength,H.dom.hasChildren=u.hasChildren,H.dom.nodeAtOffset=u.nodeAtOffset,H.dom.normalizedNthChild=u.normalizedNthChild,H.dom.normalizedNodeIndex=u.normalizedNodeIndex,H.dom.realFromNormalizedIndex=u.realFromNormalizedIndex,H.dom.normalizedNumChildren=u.normalizedNumChildren,H.dom.isTextNode=u.isTextNode,H.dom.isElementNode=u.isElementNode,H.dom.isFragmentNode=u.isFragmentNode,H.dom.isEmptyTextNode=u.isEmptyTextNode,H.dom.isSameNode=u.isSameNode,H.dom.equals=u.equals,H.dom.contains=u.contains,H.dom.followedBy=u.followedBy,H.dom.hasText=u.hasText,H.dom.outerHtml=u.outerHtml,H.dom.append=u.append,H.dom.merge=u.merge,H.dom.moveNextAll=u.moveNextAll,H.dom.moveBefore=u.moveBefore,H.dom.moveAfter=u.moveAfter,H.dom.move=u.move,H.dom.copy=u.copy,H.dom.wrap=u.wrap,H.dom.wrapWith=u.wrapWith,H.dom.insert=u.insert,H.dom.insertAfter=u.insertAfter,H.dom.replace=u.replace,H.dom.replaceShallow=u.replaceShallow,H.dom.remove=u.remove,H.dom.removeShallow=u.removeShallow,H.dom.removeChildren=u.removeChildren,H.dom.addClass=u.addClass,H.dom.removeClass=u.removeClass,H.dom.hasClass=u.hasClass,H.dom.attrNames=u.attrNames,H.dom.hasAttrs=u.hasAttrs,H.dom.attrs=u.attrs,H.dom.setAttr=u.setAttr,H.dom.setAttrNS=u.setAttrNS,H.dom.getAttr=u.getAttr,H.dom.getAttrNS=u.getAttrNS,H.dom.removeAttr=u.removeAttr,H.dom.removeAttrNS=u.removeAttrNS,H.dom.removeAttrs=u.removeAttrs,H.dom.removeStyle=u.removeStyle,H.dom.setStyle=u.setStyle,H.dom.getStyle=u.getStyle,H.dom.getComputedStyle=u.getComputedStyle,H.dom.getComputedStyles=u.getComputedStyles,H.dom.query=u.query,H.dom.nextNonAncestor=u.nextNonAncestor,H.dom.nextWhile=u.nextWhile,H.dom.nextUntil=u.nextUntil,H.dom.nextSibling=u.nextSibling,H.dom.nextSiblings=u.nextSiblings,H.dom.prevWhile=u.prevWhile,H.dom.prevUntil=u.prevUntil,H.dom.prevSibling=u.prevSibling,H.dom.prevSiblings=u.prevSiblings,H.dom.nodeAndNextSiblings=u.nodeAndNextSiblings,H.dom.nodeAndPrevSiblings=u.nodeAndPrevSiblings,H.dom.walk=u.walk,H.dom.walkRec=u.walkRec,H.dom.walkUntilNode=u.walkUntilNode,H.dom.forward=u.forward,H.dom.backward=u.backward,H.dom.findForward=u.findForward,H.dom.findBackward=u.findBackward,H.dom.upWhile=u.upWhile,H.dom.climbUntil=u.climbUntil,H.dom.childAndParentsUntil=u.childAndParentsUntil,H.dom.childAndParentsUntilIncl=u.childAndParentsUntilIncl,H.dom.childAndParentsUntilNode=u.childAndParentsUntilNode,H.dom.childAndParentsUntilInclNode=u.childAndParentsUntilInclNode,H.dom.parentsUntil=u.parentsUntil,H.dom.parentsUntilIncl=u.parentsUntilIncl,H.dom.serialize=u.serialize,H.dom.enableSelection=u.enableSelection,H.dom.disableSelection=u.disableSelection,H.dom.isEditable=u.isEditable,H.dom.isEditableNode=u.isEditableNode,H.dom.isEditingHost=u.isEditingHost,H.dom.isContentEditable=u.isContentEditable,H.dom.documentWindow=u.documentWindow,H.dom.editingHost=u.editingHost,H.dom.editableParent=u.editableParent,H.dom.scrollTop=u.scrollTop,H.dom.scrollLeft=u.scrollLeft,H.dom.absoluteTop=u.absoluteTop,H.dom.absoluteLeft=u.absoluteLeft,H.dragdrop={},H.dragdrop.handleDragDrop=l.handleDragDrop,H.dragdrop.Context=l.Context,H.dragdrop.isDraggable=l.isDraggable,H.editables={},H.editables.Editable=d.Editable,H.editables.fromElem=d.fromElem,H.editables.fromBoundary=d.fromBoundary,H.editables.create=d.create,H.editables.destroy=d.destroy,H.editing={},H.editing.format=c.format,H.editing.unformat=c.unformat,H.editing.style=c.style,H.editing.remove=c.remove,H.editing.breakline=c.breakline,H.editing.insert=c.insert,H.editing.className=c.className,H.editing.attribute=c.attribute,H.editing.cut=c.cut,H.editing.copy=c.copy,H.editing.wrap=c.wrap,H.events={},H.events.add=f.add,H.events.remove=f.remove,H.events.setup=f.setup,H.events.hasKeyModifier=f.hasKeyModifier,H.events.dispatch=f.dispatch,H.events.nextTick=f.nextTick,H.events.preventDefault=f.preventDefault,H.events.stopPropagation=f.stopPropagation,H.events.suppress=f.suppress,H.fn={},H.fn.identity=p.identity,H.fn.noop=p.noop,H.fn.returnTrue=p.returnTrue,H.fn.returnFalse=p.returnFalse,H.fn.complement=p.complement,H.fn.partial=p.partial,H.fn.strictEquals=p.strictEquals,H.fn.comp=p.comp,H.fn.and=p.and,H.fn.constantly=p.constantly,H.fn.is=p.is,H.fn.isNou=p.isNou,H.fn.or=p.or,H.fn.and=p.and,H.fn.asMethod=p.asMethod,H.fn.extendType=p.extendType,H.html={},H.html.parse=m.parse,H.html.hasBlockStyle=m.hasBlockStyle,H.html.hasInlineStyle=m.hasInlineStyle,H.html.hasLinebreakingStyle=m.hasLinebreakingStyle,H.html.prop=m.prop,H.html.isVoidType=m.isVoidType,H.html.isRendered=m.isRendered,H.html.isUnrendered=m.isUnrendered,H.html.isBlockNode=m.isBlockNode,H.html.isInlineNode=m.isInlineNode,H.html.isListContainer=m.isListContainer,H.html.isTableContainer=m.isTableContainer,H.html.isGroupContainer=m.isGroupContainer,H.html.isGroupedElement=m.isGroupedElement,H.html.isListItem=m.isListItem,H.html.isHeading=m.isHeading,H.html.isTextLevelSemanticNode=m.isTextLevelSemanticNode,H.html.isVoidNode=m.isVoidNode,H.images={},H.images.insert=h.insert,H.images.setAttributes=h.setAttributes,H.keys={},H.keys.handleKeys=v.handleKeys,H.keys.parseKeys=v.parseKeys,H.keys.ARROWS=v.ARROWS,H.keys.CODES=v.CODES,H.keys.shortcutHandler=v.shortcutHandler,H.links={},H.links.create=g.create,H.links.remove=g.remove,H.links.handleLinks=g.handleLinks,H.lists={},H.lists.format=N.format,H.lists.unformat=N.unformat,H.lists.toggle=N.toggle,H.maps={},H.maps.isEmpty=E.isEmpty,H.maps.fillKeys=E.fillKeys,H.maps.keys=E.keys,H.maps.vals=E.vals,H.maps.selectVals=E.selectVals,H.maps.filter=E.filter,H.maps.forEach=E.forEach,H.maps.extend=E.extend,H.maps.merge=E.merge,H.maps.isMap=E.isMap,H.maps.clone=E.clone,H.maps.cloneSet=E.cloneSet,H.maps.cloneDelete=E.cloneDelete,H.maps.create=E.create,H.maps.mapTuples=E.mapTuples,H.metaview={},H.metaview.toggle=S.toggle,H.mouse={},H.mouse.handleMouse=T.handleMouse,H.mouse.EVENTS=T.EVENTS,H.overrides={},H.overrides.indexOf=y.indexOf,H.overrides.unique=y.unique,H.overrides.toggle=y.toggle,H.overrides.harvest=y.harvest,H.overrides.consume=y.consume,H.overrides.nodeToState=y.nodeToState,H.overrides.stateToNode=y.stateToNode,H.overrides.joinToSet=y.joinToSet,H.paste={},H.paste.handlePaste=A.handlePaste,H.paths={},H.paths.toBoundary=_.toBoundary,H.paths.fromBoundary=_.fromBoundary,H.carets={},H.carets.box=i.box,H.carets.showHint=i.showHint,H.carets.hideHint=i.hideHint,H.selectionchange={},H.selectionchange.handler=R.handler,H.selectionchange.addHandler=R.addHandler,H.selectionchange.removeHandler=R.removeHandler,H.selections={},H.selections.show=C.show,H.selections.focus=C.focus,H.selections.select=C.select,H.selections.handleSelections=C.handleSelections,H.selections.Context=C.Context,H.searching={},H.searching.search=w.search,H.searching.forward=w.forward,H.searching.backward=w.backward,H.strings={},H.strings.addToList=O.addToList,H.strings.removeFromList=O.removeFromList,H.strings.uniqueList=O.uniqueList,H.strings.words=O.words,H.strings.splitIncl=O.splitIncl,H.strings.dashesToCamelCase=O.dashesToCamelCase,H.strings.camelCaseToDashes=O.camelCaseToDashes,H.strings.isEmpty=O.isEmpty,H.strings.isControlCharacter=O.isControlCharacter,H.strings.CONTROL_CHARACTER=O.CONTROL_CHARACTER,H.strings.SPACE=O.SPACE,H.strings.NOT_SPACE=O.NOT_SPACE,H.strings.WHITE_SPACE=O.WHITE_SPACE,H.strings.WHITE_SPACES=O.WHITE_SPACES,H.strings.ZERO_WIDTH_SPACE=O.ZERO_WIDTH_SPACE,H.strings.NON_BREAKING_SPACE=O.NON_BREAKING_SPACE,H.strings.WORD_BOUNDARY=O.WORD_BOUNDARY,H.strings.WORD_BOUNDARY_FROM_END=O.WORD_BOUNDARY_FROM_END,H.strings.WORD_BREAKING_CHARACTER=O.WORD_BREAKING_CHARACTER,H.strings.TERMINAL_WHITE_SPACES=O.TERMINAL_WHITE_SPACES,H.strings.ZERO_WIDTH_CHARACTERS=O.ZERO_WIDTH_CHARACTERS,H.strings.WHITE_SPACE_CHARACTERS=O.WHITE_SPACE_CHARACTERS,H.strings.WORD_BREAKING_CHARACTERS=O.WORD_BREAKING_CHARACTERS,H.strings.NON_BREAKING_SPACE_CHARACTERS=O.NON_BREAKING_SPACE_CHARACTERS,H.transform={},H.transform.html=I.html,H.transform.plain=I.plain,H.transform.msword=I.msword,H.traversing={},H.traversing.next=L.next,H.traversing.prev=L.prev,H.traversing.expand=L.expand,H.traversing.isAtStart=L.isAtStart,H.traversing.isAtEnd=L.isAtEnd,H.traversing.isBoundariesEqual=L.isBoundariesEqual,H.typing={},H.typing.handleTyping=B.handleTyping,H.typing.actions=B.actions,H.undo={},H.undo.Context=k.Context,H.undo.enter=k.enter,H.undo.close=k.close,H.undo.leave=k.leave,H.undo.capture=k.capture,H.undo.undo=k.undo,H.undo.redo=k.redo,H.MutationTrees={},H.MutationTrees.create=D.create,H.MutationTrees.split=D.split,H.MutationTrees.insert=D.insert,H.MutationTrees.wrap=D.wrap,H.MutationTrees.remove=D.remove,H.MutationTrees.reduce=D.reduce,H.MutationTrees.paths=D.paths,H.MutationTrees.removePaths=D.removePaths,H.MutationTrees.update=D.update,H.zippers={},H.zippers.go=P.go,H.zippers.hint=P.hint,H.zippers.update=P.update,H.zippers.before=P.before,H.zippers.after=P.after,H.zippers.prev=P.prev,H.zippers.next=P.next,H.zippers.up=P.up,H.zippers.down=P.down,H.zippers.root=P.root,H.zippers.peek=P.peek,H.zippers.split=P.split,H.zippers.splice=P.splice,H.zippers.insert=P.insert,H.zippers.replace=P.replace,H.zippers.remove=P.remove,H.zippers.zipper=P.zipper,H.zippers.isAtStart=P.isAtStart,H.zippers.isAtEnd=P.isAtEnd,H.zippers.splitAt=P.splitAt,H.zippers.insertAt=P.insertAt,H.zippers.isMarker=P.isMarker,H.zippers.createMarker=P.createMarker,H}),define("aloha/autoformat",["./functions","./dom","./maps","./keys","./editing","./mutation","./searching","./traversing","./boundaries"],function(e,n,t,r,o,i,a,s,u){function l(e,n){var t=a.backward(e,"```");if(!t)return n;var r=o.remove(e,n)[1],i=a.backward(r,"```");if(!i)return r;var s=a.search(i,/[^`]|$/);if(!s)return r;var u=o.remove(i,s)[0];return o.wrap("code",u,r)[1]}function d(e,n,t){t=s.envelopeInvisibleCharacters(t);var r=o.remove(n,t)[0];return i.insertTextAtBoundary(e,r,!0)}function c(e){var t;return u.isTextBoundary(e)?(t=u.container(e),t.data.substr(u.offset(e),1)):(t=u.nextNode(e),n.isTextNode(t)?t.data.substr(0,1):"")}function f(e){if("keydown"!==e.type)return e;if(r.CODES.tab!==e.keycode&&r.CODES.space!==e.keycode&&r.CODES.enter!==e.keycode)return e;for(var n,t,o=e.selection.boundaries[0],i=s.prev(o,"visual"),a=i&&c(i),u=m;a&&u[a];)u=u[a],"function"==typeof u&&(n=u,t=i),i=s.prev(i,"visual"),a=i&&c(i);return n&&(o=n(t,o),e.selection.boundaries=[o,o]),e}var p={"```":l,"(:":e.partial(d,"☺"),":)":e.partial(d,"☺"),":(":e.partial(d,"☹"),"):":e.partial(d,"☹"),"<3":e.partial(d,"♥"),"--":e.partial(d,"—"),"-->":e.partial(d,"→"),"<--":e.partial(d,"←"),"==>":e.partial(d,"⇒"),"<==":e.partial(d,"⇐"),"|>":e.partial(d,"►"),"<|":e.partial(d,"◄")},m={};return t.forEach(p,function(e,n){var t=m,r=n.split("").reverse(),o=r.length-1;r.forEach(function(n,r){r===o?t[n]=e:t=t[n]?t[n]:t[n]={}})}),{handleAutoFormat:f}}),define("aloha",["./aloha/api","./aloha/dom","./aloha/links","./aloha/blocks","./aloha/dragdrop","./aloha/editables","./aloha/autoformat","./aloha/boundaries","./aloha/events","./aloha/functions","./aloha/keys","./aloha/maps","./aloha/mouse","./aloha/paste","./aloha/selections","./aloha/typing"],function(e,n,t,r,o,i,a,s,u,l,d,c,f,p,m,h){function v(e,n){if("mousedown"===e.type||"dbclick"===e.type||"aloha.dblclick"===e.type){var t=new Date,r=t-n.clickTimer,o=n.multiclick;if(n.multiclick=null,n.clickTimer=t,!(r>500)&&n.event&&n.event.clientX===e.clientX&&n.event.clientY===e.clientY)return x[o]?"aloha.tplclick":"aloha.dblclick"}}function g(e,n){if(n.dragging)return n.dragging;if("mousemove"!==e)return null;var t=n.lastMouseEvent;return"mousedown"===t||"aloha.dblclick"===t||"aloha.tplclick"===t?t:null}function N(e,t){var r=t.type,o=e.selecting,a=_[r],l=g(r,o),d=l&&l!==o.dragging,c=n.getStyle(o.caret,"display");if((a||d)&&n.setStyle(o.caret,"display","none"),d&&(o.dragging=l),"mousemove"===r)return null;"mouseup"===r&&o.dragging&&(r="aloha.mouseup",o.dragging=null),a&&(r=v(t,o)||r),x[r]&&(o.multiclick=r),A[r]&&(o.lastMouseEvent=r);var f=t.target.document||t.target.ownerDocument,p=a?s.fromPosition(t.clientX,t.clientY,f):s.get(f);if(n.setStyle(o.caret,"display",c),!p)return null;var m=s.commonContainer(p[0],p[1]);if(!n.isEditableNode(m))return"keydown"===r&&(n.isEditableNode(s.container(p[0]))||n.isEditableNode(s.container(p[1])))&&u.preventDefault(t),null;var h=i.fromBoundary(e,p[0]);return h?(o.overrides=e.selection?e.selection.overrides:[],o.previousBoundaries=o.boundaries,o.boundaries=p,o.event=t,{preventSelection:!1,type:r,nativeEvent:t,editable:h,selection:o,dnd:e.dnd}):null}function E(e){var n=N(E,e);if(n){n=l.comp.apply(E.stack,E.stack)(n);var t=m.update(n);t&&(E.selection=c.merge(t))}}function b(e,n){return i.create(E,e,n)}function S(e){return i.destroy(E,e)}var T=document,y=n.documentWindow(T),A={mousemove:!0,mousedown:!0,mouseup:!0,click:!0,dblclick:!0,"aloha.dblclick":!0,"aloha.tplclick":!0},_={mousedown:!0,mouseup:!0,click:!0,dblclick:!0,"aloha.dblclick":!0,"aloha.tplclick":!0},x={dblclick:!0,"aloha.dblclick":!0,"aloha.tplclick":!0};E.BLOCK_CLASS="aloha-block",E.CARET_CLASS="aloha-caret",E.dnd=o.Context(),E.selecting=m.Context(T),E.selection=E.selecting,E.editables={},E.stack=[m.handleSelections,t.handleLinks,h.handleTyping,a.handleAutoFormat,r.handleBlocks,o.handleDragDrop,p.handlePaste,d.handleKeys,f.handleMouse],u.setup(T,E),u.add(y,"resize",E),e.aloha=b,e.mahalo=S,e.editor=E,e.buildcommit="%buildcommit%",y.aloha=c.extend(b,e);var R="%c       _       _                      _ _ _\n  __ _%c| |%c ___ %c| |%c__   __ _    ___  __%c| (_) |%c_ ___  _ __   %cAloha! \n %c/ _` | |/ _ \\| '_ \\%c %c/ _` |%c  %c/ _ \\/ _` | | __/ _ \\| '__|%c  %cHelp us shape the future of content editing on the web! \n%c| (%c_%c| | | (%c_%c) | |%c %c| | (%c_%c| |%c %c|  __/ (%c_%c| | | %c||%c (%c_%c) | |%c     %cJoin the team at http://github.com/alohaeditor \n %c\\__,_|_|\\___/|_|%c %c|_|\\__,_|%c  %c\\___|\\__,_|_|\\__\\___/|_|%c.org %c♥",C="color: #f34;",w="color: #555;",O="color: #bbb;",I="color: #bbb; background: #f8f6f5;";return console.log(R,O,I,O,I,O,I,O,w,I,O,I,O,I,O,w,I,O,I,O,I,O,I,O,I,O,I,O,I,O,I,O,I,O,w,I,O,I,O,I,O,C),b});